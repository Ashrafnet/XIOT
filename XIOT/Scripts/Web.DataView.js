Type.registerNamespace("Web");Web.DataViewMode={View:"View",Lookup:"Lookup"};Web.DataViewSelectionMode={Single:"Single",Multiple:"Multiple"};Web.DynamicExpressionScope={Field:0,ViewRowStyle:1,CategoryVisibility:2,DataFieldVisibility:3,DefaultValues:4,ReadOnly:5};Web.AutoHideMode={Nothing:0,Self:1,Container:2};Web.DynamicExpressionType={RegularExpression:0,ClientScript:1,ServerExpression:2,CSharp:3,VisualBasic:4,Any:4};Web.DataViewAggregates=["None","Sum","Count","Avg","Max","Min"];Web.FieldSearchMode={Default:0,Required:1,Suggested:2,Allowed:3,Forbidden:4};Web.PageState={};Web.PageState._init=function(){if(!this._state){var a=$get("__COTSTATE");if(a!=null&&!String.isNullOrEmpty(a.value))this._state=Sys.Serialization.JavaScriptSerializer.deserialize(a.value);else this._state={}}};Web.PageState._save=function(){var a=$get("__COTSTATE");if(a!=null)a.value=Sys.Serialization.JavaScriptSerializer.serialize(this._state)};Web.PageState.read=function(a){this._init();return this._state[a]};Web.PageState.write=function(b,a){this._init();this._state[b]=a;this._save()};Sys.StringBuilder.prototype.appendFormat=function(){this.append(String._toFormattedString(false,arguments))};String.isNullOrEmpty=function(a){return a==null||a.length==0};String.isBlank=function(a){return a==null||typeof a=="string"&&a.match(Web.DataView._blankRegex)!=null};String._wordTrimRegex=/(\S{16})\S+/g;String._tagRegex=/<\/?\w.*?>/g;String.trimLongWords=function(a,f){if(a==null)return a;var e=this._wordTrimRegex;if(f!=null)e=new RegExp(String.format("(\\S{{{0}}})\\S+",f),"g");var h=a.replace(e,"$1...");if(a.match(String._tagRegex)){var d=new Sys.StringBuilder,g=String._tagRegex,b=g.exec(a),c=0;while(b){tag=b[0];b.index>0&&d.append(a.substring(c,b.index).replace(e,"$1..."));c=b.index+tag.length;d.append(tag);b=g.exec(a)}c<a.length&&d.append(a.substring(c));h=d.toString()}return h};String.htmlEncode=function(a){return typeof a=="string"&&a.match(Web.DataView._htmlTest)?a:Web.DataView.htmlEncode(a)};String.isJavaScriptNull=function(a){return a=="%js%null"||a=="null"};String.jsNull="%js%null";Web.DataView=function(c){var b=null,a=this;Web.DataView.initializeBase(a,[c]);a._controller=b;a._viewId=b;a._servicePath=b;a._baseUrl=b;a._pageIndex=-1;a._pageSize=Web.DataViewResources.Pager.PageSizes[0];a._sortExpression=b;a._filter=[];a._externalFilter=[];a._categories=b;a._fields=b;a._allFields=b;a._rows=b;a._totalRowCount=0;a._firstPageButtonIndex=0;a._pageCount=0;a._views=[];a._actionGroups=[];a._selectedKey=[];a._selectedKeyFilter=[];a._lastCommandName=b;a._lastViewId=b;a._lookupField=b;a._filterFields=b;a._filterSource=b;a._mode=Web.DataViewMode.View;a._lookupPostBackExpression=b;a._domFilterSource=b;a._selectedKeyList=[];a._pageSizes=Web.DataViewResources.Pager.PageSizes};Web.DataView.htmlEncode=function(a){if(a!=null&&typeof a!="string")a=a.toString();return a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a};Web.DataView.htmlAttributeEncode=function(a){return a!=null&&typeof a=="string"?a.replace(/\x27/g,"&#39;").replace(/\x22/g,"&quot;"):a};Web.DataView.isIE6=this._ie6=Sys.Browser.agent==Sys.Browser.InternetExplorer&&Sys.Browser.version<7;Web.DataView.prototype={get_controller:function(){return this._controller},set_controller:function(a){this._controller=a},get_viewId:function(){var a=this;if(!a._viewId&&a._views.length>0)a._viewId=a._views[0].Id;return a._viewId},set_viewId:function(a){this._viewId=a},get_newViewId:function(){return this._newViewId},set_newViewId:function(a){this._newViewId=a},get_servicePath:function(){return this._servicePath},set_servicePath:function(a){this._servicePath=this.resolveClientUrl(a);if(!Web.DataView._servicePath)Web.DataView._servicePath=a},get_baseUrl:function(){return this._baseUrl},set_baseUrl:function(a){if(a=="~")a="/";this._baseUrl=a;if(!Web.DataView._baseUrl)Web.DataView._baseUrl=a},get_siteUrl:function(){var b=this.get_servicePath(),a=b.match(/(^.+?\/)\w+\/\w+\.asmx/);return a?a[1]:""},resolveClientUrl:function(a){return a?a.replace(/~\x2f/g,this.get_baseUrl()):null},get_hideExternalFilterFields:function(){return this._hideExternalFilterFields!=false},set_hideExternalFilterFields:function(a){this._hideExternalFilterFields=a},get_backOnCancel:function(){return this._backOnCancel==true},set_backOnCancel:function(a){this._backOnCancel=a},get_confirmContext:function(){return this._confirmContext},set_confirmContext:function(a){this._confirmContext=a},get_startCommandName:function(){return this._startCommandName},set_startCommandName:function(a){this._startCommandName=a},get_startCommandArgument:function(){return this._startCommandArgument},set_startCommandArgument:function(a){this._startCommandArgument=a},get_exitModalStateCommands:function(){return this._exitModalStateCommands},set_exitModalStateCommands:function(a){this._exitModalStateCommands=a},get_showActionBar:function(){return this._showActionBar!=false},set_showActionBar:function(a){this._showActionBar=a},get_showSearchBar:function(){return this._showSearchBar==true&&!(__tf!=4)},set_showSearchBar:function(a){this._showSearchBar=a},get_searchOnStart:function(){return this._searchOnStart==true},set_searchOnStart:function(a){this._searchOnStart=a;a&&this.set_searchBarIsVisible(true)},get_searchBarIsVisible:function(){return this._searchBarIsVisible==true},set_searchBarIsVisible:function(a){this._searchBarIsVisible=a},get_showModalForms:function(){return this._showModalForms==true},set_showModalForms:function(a){this._showModalForms=a},get_showDescription:function(){return this._showDescription!=false},set_showDescription:function(a){this._showDescription=a},get_showFirstLetters:function(){return this._showFirstLetters==true},set_showFirstLetters:function(a){this._showFirstLetters=a},get_autoSelectFirstRow:function(){return this._autoSelectFirstRow==true},set_autoSelectFirstRow:function(a){this._autoSelectFirstRow=a},get_autoHighlightFirstRow:function(){return this._autoHighlightFirstRow==true},set_autoHighlightFirstRow:function(a){this._autoHighlightFirstRow=a},get_refreshInterval:function(){return this._refreshInterval},set_refreshInterval:function(a){this._refreshInterval=!(__tf!=4)?a:0},get_showViewSelector:function(){return this._showViewSelector!=false},set_showViewSelector:function(a){this._showViewSelector=a},get_showPager:function(){return this._showPager!=false},set_showPager:function(a){this._showPager=a},get_selectionMode:function(){return this._selectionMode},set_selectionMode:function(a){this._selectionMode=a},get_cookie:function(){return this._cookie},set_cookie:function(a){this._cookie=a},get_pageIndex:function(){return this._pageIndex},set_pageIndex:function(b){var a=this;a._pageIndex=b;if(b>=0){if(b>=a._firstPageButtonIndex+Web.DataViewResources.Pager.PageButtonCount)a._firstPageButtonIndex=b;else if(b<a._firstPageButtonIndex){a._firstPageButtonIndex-=Web.DataViewResources.Pager.PageButtonCount;if(b<a._firstPageButtonIndex)a._firstPageButtonIndex=b}if(a._firstPageButtonIndex<0)a._firstPageButtonIndex=0;if(a.get_pageCount()-a._firstPageButtonIndex<Web.DataViewResources.Pager.PageButtonCount)a._firstPageButtonIndex=a.get_pageCount()-Web.DataViewResources.Pager.PageButtonCount;if(a._firstPageButtonIndex<0)a._firstPageButtonIndex=0}if(b==-2)a._pageOffset=0},get_pageOffset:function(){return!this.get_isDataSheet()?0:this._pageOffset==null?0:this._pageOffset},set_pageOffset:function(a){this._pageOffset=a},get_categoryTabIndex:function(){return this._categoryTabIndex},set_categoryTabIndex:function(b){var a=this;if(b!=a._categoryTabIndex){a._categoryTabIndex=b;a._updateTabbedCategoryVisibility();if(b!=-1){if(a._modalPopup){a._resizeContainerBounds();a._modalPopup.show()}_body_performResize();if(a.get_isEditing()){a._focusedFieldName=null;a._focus()}}}},get_enabled:function(){return this._enabled==null?true:this._enabled},set_enabled:function(a){this._enabled=a},get_showInSummary:function(){return this._showInSummary},set_showInSummary:function(a){this._showInSummary=a},get_summaryFieldCount:function(){return this._summaryFieldCount},set_summaryFieldCount:function(a){this._summaryFieldCount=a},get_showLEVs:function(){return this._showLEVs},set_showLEVs:function(a){this._showLEVs=a},get_tag:function(){return this._tag},set_tag:function(a){this._tag=a},get_pageSize:function(){return this._pageSize},set_pageSize:function(b){var a=this;a._pageSize=b;a._pageOffset=0;delete a._viewColumnSettings;if(Array.indexOf(a._pageSizes,b)==-1){a._pageSizes=Array.clone(a._pageSizes);Array.insert(a._pageSizes,0,b)}a._fields!=null&&a.refreshData()},get_sortExpression:function(){return this._sortExpression},set_sortExpression:function(b){var c=" asc",a=this;if(!b||b.length==0)a._sortExpression=null;else{var d=b.match(/^(\w+)\s*((asc|desc)|$)/);if(d[2].length==0)if(String.isNullOrEmpty(a._sortExpression)||a._sortExpression.match(/^(\w+)\s*/)[1]!=d[1])a._sortExpression=b+c;else if(a._sortExpression.endsWith(c))a._sortExpression=b+" desc";else a._sortExpression=b+c;else a._sortExpression=b}},get_filterSource:function(){return this._filterSource},set_filterSource:function(a){this._filterSource=a},get_filterFields:function(){return this._filterFields},set_filterFields:function(a){this._filterFields=a},get_visibleWhen:function(){return this._visibleWhen},set_visibleWhen:function(a){this._visibleWhen=a},get_showQuickFind:function(){return this._showQuickFind!=false},get_quickFindText:function(){return String.isNullOrEmpty(this._quickFindText)?Web.DataViewResources.Grid.QuickFindText:this._quickFindText},set_quickFindText:function(a){this._quickFindText=a},get_quickFindElement:function(){return $get(this.get_id()+"_QuickFind")},set_showQuickFind:function(a){this._showQuickFind=a},get_showRowNumber:function(){return this._showRowNumber==true},set_showRowNumber:function(a){this._showRowNumber=a},get_filter:function(){var e="disableStartFilter",a=this;if(a.get_lookupField()==null&&(a.get_pageIndex()==-1&&!a._allFields||a._externalFilter.length>0&&a._filter.length==0)){if(a.get_domFilterSource()){a._externalFilter=[];for(var f=a.get_filterFields().split(Web.DataView._simpleListRegex),h=a.get_domFilterSource().value.split(Web.DataView._simpleListRegex),c=0;c<f.length;c++)Array.add(a._externalFilter,{Name:f[c],Value:h[c]})}else{var d=Web.DataView._commandLine.match(/\?([\s\S]+)/);if(d&&(a.get_filterSource()!="None"&&a.get_filterSource()==null)){a._externalFilter=[];var g=/(\w+)=([\S\s]*?)(&|$)/g,b=g.exec(d[1]);while(b){b[1]!="ReturnUrl"&&Array.add(a._externalFilter,{Name:b[1],Value:b[2].length==0?String.jsNull:decodeURIComponent(b[2])});b=g.exec(d[1])}}}a.applyExternalFilter(a.get_isModal())}else a.get_filterSource()=="Context"&&a._externalFilter.length>0&&a.applyExternalFilter(true);if(a._startupFilter){if(a.readContext(e)!=true){Array.addRange(a._filter,a._startupFilter);a.writeContext(e,true)}a._startupFilter=null}return a._filter},set_filter:function(a){this._filter=a},get_startupFilter:function(){return this._startupFilter},set_startupFilter:function(a){this._startupFilter=a},get_externalFilter:function(){return this._externalFilter},set_externalFilter:function(a){this._externalFilter=a?a:[]},get_ditto:function(){return this._ditto},set_ditto:function(a){this._ditto=a},get_modalAnchor:function(){return this._modalAnchor},set_modalAnchor:function(a){this._modalAnchor=a},get_description:function(){return this._description},set_description:function(a){this._description=a},get_isModal:function(){return this._modalPopup!=null},get_categories:function(){return this._categories},get_fields:function(){return this._fields},get_rows:function(){return this._rows},get_selectedRow:function(){return this._rows[this._selectedRowIndex!=null?this._selectedRowIndex:0]},get_pageCount:function(){return this._pageCount},get_aggregates:function(){return this._aggregates},get_views:function(){return this._views},get_actionGroups:function(h,g){var a=this;for(var f=[],b=0;b<a._actionGroups.length;b++)if(a._actionGroups[b].Scope==h){var d=a._actionGroups[b],c=g?d:null;if(!g)for(var e=0;e<d.Actions.length;e++)if(a._isActionAvailable(d.Actions[e])){c=a._actionGroups[b];break}c&&Array.add(f,c)}return f},get_actions:function(b){for(var a=0;a<this._actionGroups.length;a++)if(this._actionGroups[a].Scope==b)return this._actionGroups[a].Actions;return[]},get_selectedKey:function(){return this._selectedKey},set_selectedKey:function(a){this._selectedKey=a},get_selectedKeyFilter:function(){return this._selectedKeyFilter},set_selectedKeyFilter:function(a){this._selectedKeyFilter=a},_get_selectedValueElement:function(){return $get(String.format("{0}_{1}_SelectedValue",this.get_id(),this.get_controller()))},get_selectedValue:function(){var a=this.readContext("SelectedValue");if(a)return a;var b=this._get_selectedValueElement();return b?b.value:""},set_selectedValue:function(a){this.writeContext("SelectedValue",a.toString());var b=this._get_selectedValueElement();if(b)b.value=a!=null?a:""},get_keyRef:function(){var c=this.get_selectedKey();if(!c)return null;for(var b="",a=0;a<this._keyFields.length;a++){if(a>0)b+="&";b=String.format("{0}{1}={2}",b,this._keyFields[a].Name,c[a])}return b},get_showIcons:function(){return this._icons!=null&&this._lookupField==null||this.get_showRowNumber()},get_showMultipleSelection:function(){return this._selectionMode==Web.DataViewSelectionMode.Multiple&&this._hasKey()},get_sysColCount:function(){var a=0;if(this.get_showIcons())a++;if(this.get_showMultipleSelection())a++;if(this.get_isDataSheet())a++;return a},_createRowKey:function(c){for(var e=this._rows[c],a="",b=0;b<this._keyFields.length;b++){var d=this._keyFields[b];if(a.length>0)a+=",";a+=e[d.Index].toString()}return a},toggleSelectedRow:function(c){var i="MultiSelectedRow",h="Selected",a=this;for(var l=c!=null?c:0,m=c!=null?c:a._rows.length-1,n=$get(a.get_id()+"_ToggleButton"),f=l;f<=m;f++){var j=a._createRowKey(f),g=Array.indexOf(a._selectedKeyList,j);g!=-1&&Array.removeAt(a._selectedKeyList,g);var e=c==null?n.checked:g==-1;e&&Array.add(a._selectedKeyList,j);var d=$get(a.get_id()+"_CheckBox"+f);if(d){d.checked=e;if(e)Sys.UI.DomElement.addCssClass(d,h);else Sys.UI.DomElement.removeCssClass(d,h);var b=d;while(b&&b.tagName!="TR")b=b.parentNode;if(e)Sys.UI.DomElement.addCssClass(b,i);else Sys.UI.DomElement.removeCssClass(b,i)}}a.set_selectedValue(a._selectedKeyList.join(";"));var k=$get(a.get_id()+"$SelectionInfo");if(k)k.innerHTML=a._selectedKeyList.length==0?"":String.format(Web.DataViewResources.Pager.SelectionInfo,a._selectedKeyList.length);a.delayedRefresh()},delayedRefresh:function(c,b){var a=this;if(!b)b=1e3;if(c){delete a._delayedRefreshTimer;!(a._isBusy||Web.DataView._navigated||Sys.Application._disposing)&&a.refresh(true)}else{a._delayedRefreshTimer&&window.clearTimeout(a._delayedRefreshTimer);a._delayedRefreshTimer=window.setTimeout(String.format('var v=$find("{0}");if(v)v.delayedRefresh(true);',a.get_id()),b)}},get_view:function(b){var a=this;if(!b)b=a.get_viewId();if(!a._view||a._view.Id!=b)for(var c=0;c<a._views.length;c++)if(a._views[c].Id==b){a._view=a._views[c];break}return a._view},get_viewType:function(b){var a=this.get_view(b);if(this._viewTypes){var c=this._viewTypes[a?a.Id:b];if(c!=null)return c}return a?a.Type:null},get_isGrid:function(b){var a=this.get_viewType(b);return a=="Grid"||a=="DataSheet"||a=="Tree"},get_isForm:function(b){var a=this.get_viewType(b);return a=="Form"},get_isDataSheet:function(d){var a=this,b=a.get_viewType(d);if(__tf!=4)return false;if(a._viewTypes){var c=a._viewTypes[a.get_viewId()];if(c!=null)b=c}return b=="DataSheet"},get_isTree:function(b){var a=this.get_viewType(b);return a=="Tree"&&__tf==4},get_isChart:function(){return this.get_viewType()=="Chart"},get_lastViewId:function(){return this._lastViewId},set_lastViewId:function(a){this._lastViewId=a},get_lastCommandName:function(){return this._lastCommandName},set_lastCommandName:function(a){this._lastCommandName=a;this._lastCommandArgument=null;$closeHovers()},get_lastCommandArgument:function(){return this._lastCommandArgument},set_lastCommandArgument:function(a){this._lastCommandArgument=a},get_isEditing:function(){var a=this;return(a._lastCommandName=="New"||a._lastCommandName=="Edit"||a._lastCommandName=="BatchEdit"||a._lastCommandName=="Duplicate")&&a._editing==null||a._editing==true},get_isInserting:function(){return this._lastCommandName=="New"||this._lastCommandName=="Duplicate"},get_lookupField:function(){return this.get_mode()==Web.DataViewMode.View?this._lookupField:this._fields[0]},set_lookupField:function(a){this._lookupField=a},get_lookupContext:function(){var a=this.get_lookupField();return a?{FieldName:a.Name,Controller:a._dataView.get_controller(),View:a._dataView.get_viewId()}:null},get_mode:function(){return this._mode},set_mode:function(a){this._mode=a},get_lookupValue:function(){return this._lookupValue},set_lookupValue:function(a){this._lookupValue=a},get_lookupText:function(){return this._lookupText},set_lookupText:function(a){this._lookupText=a},get_lookupPostBackExpression:function(){return this._lookupPostBackExpression},set_lookupPostBackExpression:function(a){this._lookupPostBackExpression=a},get_domFilterSource:function(){return this._domFilterSource},set_domFilterSource:function(a){this._domFilterSource=a},get_showDetailsInListMode:function(){return this._showDetailsInListMode!=false},set_showDetailsInListMode:function(a){this._showDetailsInListMode=a},get_autoHide:function(){return!String.isNullOrEmpty(this.get_visibleWhen())?Web.AutoHideMode.Self:this._autoHide==null?Web.AutoHideMode.Nothing:this._autoHide},set_autoHide:function(a){this._autoHide=a},get_transaction:function(){return this._transaction},set_transaction:function(a){this._transaction=a},initialize:function(){var a=this;Web.DataView.callBaseMethod(a,"initialize");a._bodyKeydownHandler=Function.createDelegate(a,a._bodyKeydown);a._filterSourceSelectedHandler=Function.createDelegate(a,a._filterSourceSelected);a._quickFindHandlers={focus:a._quickFind_focus,blur:a._quickFind_blur,keydown:a._quickFind_keydown};a._checkMaxLengthHandler=function(c){var a=this,b=parseInt(a.getAttribute("maxlength"));if(a.value.length>b){a.value=a.value.substr(0,b);c.preventDefault();c.stopPropagation()}}},dispose:function(){var b=null,a=this;!Sys.Application._disposing&&a._detachBehaviors();a._wsRequest=b;a._stopInputListener();a._disposeModalPopup();a._disposeFieldFilter();a._disposeSearchBarExtenders();a._disposeImport();a._disposeFields();a._lookupField=b;a._parentDataView=b;a._bodyKeydownHandler=b;a._filterSourceSelectedHandler=b;a._restoreEmbeddedViews();delete a._container;Web.DataView.callBaseMethod(a,"dispose")},get_master:function(){var a=this.get_filterSource();return a?Web.DataView.find(a):null},updated:function(){var g="Supported",c=null,d=true,e=false,a=this;Web.DataView.callBaseMethod(a,"updated");a.get_servicePath().startsWith("http")&&a.set_baseUrl(a.get_siteUrl());var f=a.get_selectedValue();if(f.length>0){a.set_autoHighlightFirstRow(e);a.set_autoSelectFirstRow(e);if(a.get_selectionMode()==Web.DataViewSelectionMode.Multiple)a._selectedKeyList=f.split(";");else{a._selectedKey=f.split(",");a._pendingSelectedEvent=d}}if(a._container==c){a.get_element().innerHTML="";a._container=document.createElement("div");a.get_element().appendChild(a._container);Sys.UI.DomElement.addCssClass(a._container,"DataViewContainer");!a.get_showActionBar()&&Sys.UI.DomElement.addCssClass(a._container,"ActionBarHidden");!a.get_showDescription()&&Sys.UI.DomElement.addCssClass(a._container,"DescriptionHidden")}if(a.get_filterSource()&&a.get_filterSource()!="Context"){var b=a.get_master();if(b){a._hasParent=d;b.add_selected(a._filterSourceSelectedHandler);if(a.get_transaction()==g)if(!String.isNullOrEmpty(b.get_transaction())){a.set_transaction(b.get_transaction()!=g?b.get_transaction():c);a._forceVisible=a.get_transaction()&&b.get_isInserting()}if(b._pendingSelectedEvent){a._source=b;a._afterUpdateTimerId=window.setInterval(String.format('$find("{0}")._afterUpdate()',a.get_id()),250)}else if(!a._forceVisible)a._hidden=d}else{b=$get(a.get_filterSource());b&&$addHandler(b,"change",a._filterSourceSelectedHandler);a.set_domFilterSource(b)}a._externalFilter.length==0&&a._createExternalFilter();if(a._filter.length==0)!a._source&&a.applyExternalFilter()}a.get_transaction()==g&&a.set_transaction(c);a.get_modalAnchor()&&!a.get_isModal()&&a._initializeModalPopup();b!=c&&a.get_autoHide()!=Web.AutoHideMode.Nothing&&a._updateLayoutContainerVisibility(e);if(a.get_startCommandName()=="UseTransaction"){a._usesTransaction=d;a.set_startCommandName(c)}if(a.get_startCommandName()=="DetectTransaction")if(!a.get_transaction()){if(b&&Web.DataView.isInstanceOfType(b)){b.remove_selected(a._filterSourceSelectedHandler);window.clearInterval(a._afterUpdateTimerId)}return}else a.set_startCommandName(c);var h=Web.DataView.get_commandLine(),i=h.match(/_commandName=(.+?)&_commandArgument=(.*?)(&|$)/);if(i&&(String.isNullOrEmpty(a.get_startCommandName())||__designer())&&!a.get_filterSource()&&!a.get_isModal()){var j=h.match(/_controller=(\w+)/),k=h.match(/_view=(\w+)/);if((!j||j[1]==a.get_controller())&&(!k||k[1]==a.get_view())){a._trySecondCommand=!String.isNullOrEmpty(j[1]);a.set_startCommandName(i[1]);a.set_startCommandArgument(i[2]);if(!String.isNullOrEmpty(a._viewId))a._replaceTriggerViewId=a._viewId;a._skipTriggeredView=d}}if(a.get_startCommandName()){a.set_searchOnStart(e);a.set_lastCommandName(a.get_startCommandName());a.set_lastCommandArgument(a.get_startCommandArgument());a.get_startCommandName().match(/New|Edit|Select/)&&a.set_viewId(a.get_startCommandArgument());a.set_startCommandName(c);a.set_startCommandArgument(c);a._rows=[];a._loadPage()}else a.loadPage()},_afterUpdate:function(){var a=this;if(a._delayedLoading&&a._source._pendingSelectedEvent||a._source._isBusy)return;window.clearInterval(a._afterUpdateTimerId);var b=a._source;a._source=null;a._filterSourceSelected(b,Sys.EventArgs.Empty,true)},_updateLayoutContainerVisibility:function(c){var n="factory:hidden",g="none",m="factory:activator",h="factory:visibilityController",f=this;if(f._forceVisible)c=true;var a=f._element.parentNode;String.isNullOrEmpty(a.getAttribute(h))&&a.setAttribute(h,f.get_id());var d=!String.isNullOrEmpty(a.getAttribute(m))?a.getAttribute(m).match(/^\s*(\w+)\s*\|\s*(.+)\s*$/):null;if(f.get_autoHide()==Web.AutoHideMode.Self){f._element.style.display=c?"":g;var e=a.parentNode.childNodes[0];while(e.tagName!="DIV")e=e.nextSibling;if(d&&d[1]=="Tab"&&Sys.UI.DomElement.containsCssClass(e,"TabBar")){if(a.getAttribute(h)==f.get_id()){for(var j=-1,b=0;b<a.parentNode.childNodes.length;b++){var l=a.parentNode.childNodes[b];if(l.className&&Sys.UI.DomElement.containsCssClass(l,"TabBody"))j++;if(a==l)break}if(j!=-1){var i=e.getElementsByTagName("td"),o=i[j];o.style.display=c?"":g;if(!c&&Sys.UI.DomElement.containsCssClass(o,"Selected")){var r=e.getElementsByTagName("a");for(b=0;b<i.length;b++)if($common.getVisible(i[b])){$find(a.parentNode.id+"$ActivatorMenu").select(b,r[b]);break}}}}}else a.setAttribute(n,!c)}else{d&&d[1]=="SideBarTask"&&a.setAttribute(n,true);while(a){if(!String.isNullOrEmpty(a.getAttribute("factory:flow"))){a.style.display=c?"":g;break}a=a.parentNode}}var p=$get("PageContentSideBar");if(p&&d){var q=p.getElementsByTagName("a");for(b=0;b<q.length;b++){var k=q[b];if(Sys.UI.DomElement.containsCssClass(k.parentNode,"Task")&&k.innerHTML==d[2]){k.parentNode.style.display=c?"":g;break}}}Web.DataView._loaded&&_body_performResize()},loadPage:function(){var a=this,b=a.get_isDisplayed();a._showWait(!b);if(a.get_mode()!=Web.DataViewMode.View||(a.get_lookupField()||!(a._delayedLoading=!b)))!a._source&&a._loadPage();else if(!Array.contains(Web.DataView._delayedLoadingViews,a)){Array.add(Web.DataView._delayedLoadingViews,a);Web.DataView._startDelayedLoading()}},get_isDisplayed:function(){if(this._hidden)return false;var a=this.get_element().parentNode;while(a!=null){if(a.getAttribute&&a.tagName!="TABLE"&&a.getAttribute("factory:activator")&&!a._activated)return false;if(a.style&&a.style.display=="none")return false;a=a.parentNode}return true},goToPage:function(a,b){if(b)this._pageOffset=0;this.set_pageIndex(a);this._loadPage()},sort:function(b){var a=this;if(a.get_sortExpression()==b)b="";a.set_sortExpression(b);a.set_pageIndex(0);a._loadPage()},applyFilterByIndex:function(c,a){var b=this._allFields[c],d=this.findFieldUnderAlias(b);this.applyFilter(b,a>=0?"=":null,a>=0?d._listOfValues[a]:null)},findFieldUnderAlias:function(b){if(b.Hidden)for(var a=0;a<this._allFields.length;a++)if(this._allFields[a].AliasIndex==b.Index)return this._allFields[a];return b},removeFromFilterByIndex:function(a){field=this._allFields[a];this.removeFromFilter(field);this.refreshData()},removeFromFilter:function(b){for(var a=0;a<this._filter.length;a++)if(this._filter[a].match(/^(\w+):/)[1]==b.Name){Array.removeAt(this._filter,a);break}},clearFilter:function(){var a=this;for(var c=0;c<a._allFields.length;c++){var b=a._allFields[c],e=a.findFieldUnderAlias(b);a.filterOf(b)!=null&&!a.filterIsExternal(b.Name)&&a.removeFromFilter(b)}var d=a.get_quickFindElement();if(d!=null){d.value="";a.quickFind()}else a._executeQuickFind(null)},beginFilter:function(){this._filtering=true},endFilter:function(){this._filtering=false;this.refreshData()},applyFilter:function(b,c,d){var a=this;a.removeFromFilter(b);if(c==":")d&&Array.add(a._filter,b.Name+":"+d);else c&&Array.add(a._filter,b.Name+":"+c+a.convertFieldValueToString(b,d));var e=a._filter.length==1&&a._filter[0].match(/(\w+):/)[1]==b.Name;b=a.findFieldUnderAlias(b);for(i=0;i<a._allFields.length;i++)if(!e||a._allFields[i].Name!=b.Name)a._allFields[i]._listOfValues=null;a._filtering!=true&&a.refreshData();a._forgetSelectedRow(true)},applyExternalFilter:function(e){var a=this;if(!e)a._filter=[];a._selectedRowIndex=null;for(var d=0;d<a._externalFilter.length;d++){var c=a._externalFilter[d];if(e)for(var b=0;b<a._filter.length;b++)if(a._filter[b].startsWith(c.Name+":=")){Array.removeAt(a._filter,b);break}Array.add(a._filter,c.Name+":="+c.Value)}},applyFieldFilter:function(f,d,b,h){var a=this;if(f==null)f=a._filterFieldIndex;if(!d)d=a._filterFieldFunc;var c=a._allFields[f];a.removeFromFilter(c);var e=String.format("{0}:",c.Name,c.Type);if(b&&b[0]==Web.DataViewResources.HeaderFilter.EmptyValue)b[0]=String.jsNull;if(!b)e+=d+"$\0";else if(d=="$between")e+="$between$"+a.convertFieldValueToString(c,b[0])+"$and$"+a.convertFieldValueToString(c,b[1])+"\0";else for(var g=0;g<b.length;g++)e+=d+(d.startsWith("$")?"$":"")+a.convertFieldValueToString(c,b[g])+"\0";e.indexOf("\0")>0&&Array.add(a._filter,e);!h&&a.refreshData();a._forgetSelectedRow(true)},get_fieldFilter:function(e,d){for(var b=0;b<this._filter.length;b++){var c=this._filter[b].match(/(\w+):(\*|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*)/);if(c[1]==e.Name){if(d){var a=c[2];return a.startsWith("$")?a.substring(0,a.length-1):a}else return c[4];break}}return null},_createFieldInputExtender:function(c,a,f,g){var b=null,e=this,d=b;if(a.Type.startsWith("DateTime")){d=$create(AjaxControlToolkit.CalendarBehavior,{id:String.format("{0}_{1}Calendar{2}_{3}",e.get_id(),c,a.Index,g),button:f.nextSibling},b,b,f);d.set_format(a.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1])}else if(a.AllowQBE&&a.Type=="String"){d=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0}:{1},{2}",c,e.get_id(),a.Name),delimiterCharacters:";",id:String.format("{0}_{1}AutoComplete{2}_{3}",e.get_id(),c,a.Index,g),minimumPrefixLength:a.AutoCompletePrefixLength==0?1:a.AutoCompletePrefixLength,serviceMethod:"GetListOfValues",servicePath:e.get_servicePath(),useContextKey:true,enableCaching:c!="SearchBar",typeCssClass:c},b,b,f);d._updateClearButton()}return d},showFieldFilter:function(g,i,m){var a=this;if(!a._filterExtenders)a._filterExtenders=[];var c=a._allFields[g],b=a.get_fieldFilter(c);if(b){var j=b.match(/^([\s\S]*?)(\0|$)/);if(j)b=j[1]}b=b&&!String.isJavaScriptNull(b)?b.split(Web.DataView._listRegex):[""];a._filterFieldIndex=g;a._filterFieldFunc=i;a._filterElement=document.createElement("div");a._filterElement.id=a.get_id()+"$FieldFilter";a._filterElement.className="FieldFilter";var d=new Sys.StringBuilder,h=c.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;</a>':"";d.appendFormat('<div class="Field"><div class="Label"><span class="Name">{0}</span> <span class="Function">{1}</span></div><div class="Value"><input type="text" value="{2}"/>{3}</div></div>',c.HeaderText,m.toLowerCase(),Web.DataView.htmlAttributeEncode(c.format(a.convertStringToFieldValue(c,b[0]))),h);i=="$between"&&d.appendFormat('<div class="Field"><div class="Label"><span class="Function">{0}</span></div><div class="Value"><input type="text" value="{1}"/>{2}</div></div>',Web.DataViewResources.Data.Filters.Labels.And,Web.DataView.htmlAttributeEncode(b[1]?c.format(a.convertStringToFieldValue(c,b[1])):""),h);d.appendFormat('<div class="Buttons"><button onclick="$find(\'{0}\').closeFieldFilter(true)">{1}</button><button onclick="$find(\'{0}\').closeFieldFilter(false)">{2}</button></div>',a.get_id(),Web.DataViewResources.ModalPopup.OkButton,Web.DataViewResources.ModalPopup.CancelButton);a._filterElement.innerHTML=d.toString();a._appendModalPanel(a._filterElement);a._filterPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:a.get_id()+"$FilterPopup",PopupControlID:a._filterElement.id,DropShadow:true,BackgroundCssClass:"ModalBackground"},null,null,a._container.getElementsByTagName("a")[0]);for(var f=a._filterElement.getElementsByTagName("input"),e=0;e<f.length;e++){var l=f[e],k=a._createFieldInputExtender("Filter",c,l,e);k&&Array.add(a._filterExtenders,k)}a._saveTabIndexes();a._filterPopup.show();Sys.UI.DomElement.setFocus(f[0])},closeFieldFilter:function(f){var a=this,d=a._filterElement.getElementsByTagName("input"),e=[];if(f)for(var h=a._allFields[a._filterFieldIndex],c=0;c<d.length;c++){var b=d[c];if(String.isBlank(b.value)){alert(Web.DataViewResources.Validator.RequiredField);Sys.UI.DomElement.setFocus(b);return}else{a._formatSearchField(b,a._filterFieldIndex);var i={NewValue:b.value.trim()},g=a._validateFieldValueFormat(h,i);if(g){alert(g);Sys.UI.DomElement.setFocus(b);return}else Array.add(e,h.Type.startsWith("DateTime")?b.value.trim():i.NewValue)}}a._disposeFieldFilter();a._restoreTabIndexes();f&&a.applyFieldFilter(null,null,e)},_disposeSearchBarExtenders:function(){var a=this;if(a._searchBarExtenders){for(var b=0;b<a._searchBarExtenders.length;b++)a._searchBarExtenders[b].dispose();Array.clear(a._searchBarExtenders)}},_disposeFieldFilter:function(){var a=this;if(a._filterExtenders){for(var b=0;b<a._filterExtenders.length;b++)a._filterExtenders[b].dispose();Array.clear(a._filterExtenders)}if(a._filterElement){a._filterPopup.hide();a._filterPopup.dispose();a._filterPopup=null;a._filterElement.parentNode.removeChild(a._filterElement);delete a._filterElement}},_showSearchBarFilter:function(c,b){var a=this;a._searchBarVisibleIndex=b;if(c==-1){var d=a._get("$SearchBarValue$",b);d.value="";a._searchBarFuncChanged(b);a._searchBarVisibleIndex=null}else a.showCustomFilter(c)},_appendModalPanel:function(a){this.get_element().appendChild(a)},showCustomFilter:function(e){var a=this,d=a._allFields[e],c=a._customFilterPanel=document.createElement("div");a._appendModalPanel(c);c.className="CustomFilterDialog";c.id=a.get_id()+"_CustomFilterPanel";var b=new Sys.StringBuilder;b.appendFormat('<div><span class="Highlight">{0}</span> {1}:</div>',Web.DataView.htmlEncode(d.Label),Web.DataViewResources.Data.Filters.Labels.Includes);b.append('<table cellpadding="0" cellspacing="0">');b.appendFormat('<tr><td colspan="2"><div id="{0}$CustomFilterItemList${1}" class="CustomFilterItems">{2}</div></td></tr>',a.get_id(),e,Web.DataViewResources.Common.WaitHtml);b.appendFormat('<tr><td></td><td align="right"><button id="{0}Ok">{1}</button> <button id="{0}Cancel">{2}</button></td></tr>',a.get_id(),Web.DataViewResources.ModalPopup.OkButton,Web.DataViewResources.ModalPopup.CancelButton);b.append("</table>");c.innerHTML=b.toString();b.clear();a._customFilterField=d;a._customFilterModalPopupBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{OkControlID:a.get_id()+"Ok",CancelControlID:a.get_id()+"Cancel",OnOkScript:String.format('$find("{0}").applyCustomFilter()',a.get_id()),OnCancelScript:String.format('$find("{0}").closeCustomFilter()',a.get_id()),PopupControlID:c.id,DropShadow:true,BackgroundCssClass:"ModalBackground"},null,null,a._container.getElementsByTagName("a")[0]);a._customFilterModalPopupBehavior.show();$addHandler(document.body,"keydown",a._bodyKeydownHandler);var f=a.findFieldUnderAlias(d);a._loadFilterListOfValues(d.Name)},_loadFilterListOfValues:function(b){var a=this;a._busy(true);var c=a.get_lookupContext();a._invoke("GetListOfValues",a._createArgsForListOfValues(b),Function.createDelegate(a,a._onGetFilterListOfValuesComplete),{fieldName:b})},_renderFilterOption:function(f,b,a,e,d){var c=this._findItemByValue(b,a);if(c)a=c[1];f.appendFormat('<tr><td class="Input"><input type="checkbox" id="{0}$CustomFilterItem{1}${2}"{4}/></td><td class="Label"><label for="{0}$CustomFilterItem{1}${2}">{3}</label></td></tr>',this.get_id(),b.Index,e,a,d?' checked="checked"':"")},_onGetFilterListOfValuesComplete:function(e,t){var h=null,d=this;d._busy(false);var c=d.findField(t.fieldName);d.findFieldUnderAlias(c)._listOfValues=e;if(e[e.length-1]==h){Array.insert(e,0,e[e.length-1]);Array.removeAt(e,e.length-1)}var n=d._get("$CustomFilterItemList$",c.Index);if(!n)return;for(var p=d._searchBarVisibleIndex!=h?d._createSearchBarFilter(true):d._filter,l=h,a=0;a<p.length;a++){var g=p[a].match(Web.DataView._fieldFilterRegex);if(g[1]==c.Name){l=g[2];break}}var f=h,o="$in$";if(l){g=l.match(Web.DataView._filterRegex);if(g){if(g[1].match(/\$(in|notin|between)\$/)){o=g[1];f=g[3].split(Web.DataView._listRegex)}else f=[g[3]];for(a=0;a<f.length;a++){var b=f[a];if(String.isJavaScriptNull(b))f[a]=Web.DataViewResources.HeaderFilter.EmptyValue;else{b=d.convertStringToFieldValue(c,b);f[a]=c.format(b)}}}}var i=new Sys.StringBuilder;i.appendFormat('<table class="FilterItems" cellpadding="0" cellspacing="0"><tr><td><input type="CheckBox" onclick="$find(\'{0}\')._selectAllFilterItems({1})" id="{0}$CustomFilterItemList$SelectAll"/></td><td><label for="{0}$CustomFilterItemList$SelectAll">{2}</label></td></tr>',d.get_id(),c.Index,Web.DataViewResources.Data.Filters.Labels.SelectAll);var k=[],j=[],q=[],m=[];for(a=0;a<e.length;a++){b=e[a];var r=b;if(b==h)b=Web.DataViewResources.HeaderFilter.EmptyValue;else{b=Web.DataView.htmlEncode(c.format(b));if(b=="")b=Web.DataViewResources.HeaderFilter.BlankValue}var s=f&&(o=="$in$"&&Array.contains(f,b)||o=="$notin$"&&!Array.contains(f,b));if(s){Array.add(j,b);Array.add(k,r)}else{Array.add(m,b);Array.add(q,r)}}for(a=0;a<j.length;a++)d._renderFilterOption(i,c,j[a],a,true);for(a=0;a<m.length;a++)d._renderFilterOption(i,c,m[a],a+j.length,false);i.append("</table>");n.innerHTML=i.toString();Sys.UI.DomElement.setFocus(n.getElementsByTagName("input")[0]);if(k.length>0){c._listOfValues=[];Array.addRange(c._listOfValues,k);Array.addRange(c._listOfValues,q)}},_selectAllFilterItems:function(c){for(var d=this._get("$CustomFilterItemList$",c),a=d.getElementsByTagName("input"),b=1;b<a.length;b++)a[b].checked=a[0].checked},applyCustomFilter:function(){var d=null,a=this,h=a._customFilterField,g=a._searchBarVisibleIndex!=d?a._get("$SearchBarValue$",a._searchBarVisibleIndex):d,j=g?a._get("$SearchBarFunction$",a._searchBarVisibleIndex):d;a.removeFromFilter(h);for(var b=d,l=a._get("$CustomFilterItemList$",h.Index),e=l.getElementsByTagName("input"),i=a.findFieldUnderAlias(h),f=0,c=1;c<e.length;c++)if(e[c].checked){if(!b)b="";else b+="$or$";b+=a.convertFieldValueToString(h,i._listOfValues[c-1]);f++}if(b&&(f<=10||f!=e.length-1))if(f<=10||f<=(e.length-1)/2)if(g)j.value="$in,true";else Array.add(a._filter,String.format("{0}:$in${1}\0",a._customFilterField.Name,b));else{b=d;for(c=1;c<e.length;c++)if(!e[c].checked){if(!b)b="";else b+="$or$";b+=a.convertFieldValueToString(h,i._listOfValues[c-1])}if(g)j.value="$notin,true";else Array.add(a._filter,String.format("{0}:$notin${1}\0",a._customFilterField.Name,b))}else b=d;for(c=0;c<a._allFields.length;c++){var k=a._allFields[c];if(k!=i)k._listOfValues=d}if(g){g.value=b?b:"";a._searchBarFuncChanged(a._searchBarVisibleIndex)}else a.refreshData();a.closeCustomFilter();a._forgetSelectedRow(true)},closeCustomFilter:function(){var b=null,a=this;if(a._customFilterModalPopupBehavior){a._customFilterModalPopupBehavior.dispose();a._customFilterModalPopupBehavior=b;a._customFilterField=b}if(a._customFilterPanel){a._customFilterPanel.parentNode.removeChild(a._customFilterPanel);delete a._customFilterPanel}$removeHandler(document.body,"keydown",a._bodyKeydownHandler);a._customFilterField=b;a._searchBarVisibleIndex=b},convertFieldValueToString:function(b,a){if(typeof a=="string"&&(a.match(Web.DataView._listRegex)||a.startsWith("%js%")))return a;if(b.Type!="String"&&a!=null&&typeof a=="string")a=this.convertStringToFieldValue2(b,a);if(Date.isInstanceOfType(a))a=new Date(a-a.getTimezoneOffset()*60*1e3);return String.format("%js%{0}",Sys.Serialization.JavaScriptSerializer.serialize(a))},convertFieldValueToString2:function(c,a){var b=null;return c.Type.startsWith("DateTime")&&!String.isNullOrEmpty(c.DataFormatString)?a==b?b:String.localeFormat(c.DataFormatString,a):c.Type=="Boolean"?a==b?b:a.toString():a.toString()},convertStringToFieldValue:function(b,a){if(a!=null&&a.startsWith("%js%")){a=Sys.Serialization.JavaScriptSerializer.deserialize(a.substring(4));if(Date.isInstanceOfType(a))a=new Date(a.getTime()+a.getTimezoneOffset()*60*1e3);return a}else return this.convertStringToFieldValue2(b,a)},convertStringToFieldValue2:function(b,a){if(a==null)return a;switch(b.Type){case"DateTime":var c=b.DataFormatString&&b.DataFormatString.length?Date.parseLocale(a,b.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1]):Date.parse(a);if(!isNaN(c)&&c!=null)return c;break;case"SByte":case"Byte":case"Int16":case"Int32":case"UInt32":case"Int64":case"Single":case"Double":case"Decimal":case"Currency":var d=Number.parseLocale(a);if(!isNaN(d))return d}return a},goToView:function(b){var c=null,e="Form",a=this;if(!String.isNullOrEmpty(a._replaceTriggerViewId)&&a._replaceTriggerViewId==b){if(a._skipTriggeredView)a._skipTriggeredView=false;location.replace(location.href);return}var k=a.get_filter(),i=a.get_view().Group;if(b=="form")for(var d=0;d<a.get_views().length;d++)if(a.get_views()[d].Type==e){b=a.get_views()[d].Id;break}a._detachBehaviors();if(!a.get_isForm()){a._lastViewId=a.get_viewId();a._selectedRowIndex=0}var l=a.get_view().Id,g=l!=b;if(g){a._focusedFieldName=c;!a.get_isGrid()&&a.writeContext("vitals",c)}a.set_viewId(b);var j=a.get_view();if(j.Type!=e){a._lastViewId=b;a._restorePosition()}a.set_pageIndex(-1);var h=j.Type==e?a.get_selectedKeyFilter():!String.isNullOrEmpty(i)&&a.get_view().Group==i?k:[];if(a._requestedFilter){h=a._requestedFilter;a._requestedFilter=c}var f=c;if(a._requestedSortExpression){f=a._requestedSortExpression;a._requestedSortExpression=c}a.set_filter(h);a.set_sortExpression(f);a._loadPage();a._raiseSelectedDelayed=true;if(g)a._scrollIntoView=true},filterOf:function(b){for(var c=(!String.isNullOrEmpty(b.AliasName)?b.AliasName:b.Name)+":",a=0;a<this._filter.length;a++){var d=this._filter[a];if(d.startsWith(c)&&!d.match(":~"))return this._filter[a].substr(c.length)}return null},findField:function(c){for(var a=0;a<this._allFields.length;a++){var b=this._allFields[a];if(b.Name==c)return b}return null},findCategory:function(c){for(var a=0;a<this._categories.length;a++){var b=this._categories[a];if(b.HeaderText==c)return b}return null},_isInInstantDetailsMode:function(){return window.location.href.match(Web.DataView.DetailsRegex)},_closeInstantDetails:function(){if(this._isInInstantDetailsMode())if(Web.DataViewResources.Lookup.ShowDetailsInPopup){window.close();return true}return false},_confirm:function(d){var a=this,m=/(_(\w+))\s*=\s*(.+?)(\s*\r|;|\n|$)/gi,c=d.action.Confirmation,i=true,f=m.exec(c);if(f&&!(__tf!=4)){var l=null,o="",h="New",k="";while(f){var b=f[2],e=f[3];if(b=="controller")l=e;if(b=="view")o=e;if(b=="commandName")h=h;if(b=="commandArgument")k=e;if(b=="width")d.MaxWidth=e;if(b=="title")d.WindowTitle=e;f=m.exec(c)}for(var n=a._collectFieldValues(),p=d.Values=[],j=0;j<n.length;j++){var g=n[j];Array.add(p,{Name:"Context_"+g.Name,Value:g.Modified?g.NewValue:g.OldValue})}var q=Web.DataView.showModal(a,l,o,h,k,a.get_baseUrl(),a.get_servicePath(),[],{confirmContext:d,showSearchBar:a.get_showSearchBar()});i=false}else{c=a._parseLocation(c,a.get_currentRow(),a._collectFieldValues());if(!confirm(c))i=false}return i},executeAction:function(g,c,f,i,k){var e=null,b=this;if(b._isBusy)return;Web.DataView.hideMessage();var d=b.get_lookupField()?e:g=="ActionBar"?b.get_actionGroups(g)[i].Actions:b.get_actions(g);if(c<0&&d){for(var h=0;h<d.length;h++)if(b._isActionAvailable(d[h],f)){c=h;break}if(c<0)return}var a=d?d[c]:e;if(a&&!String.isNullOrEmpty(a.Confirmation)){b.get_isGrid()&&!b.get_isDataSheet()&&b.get_lastCommandName()!="BatchEdit"&&b.executeRowCommand(f,"Select");if(!k&&!b._confirm({action:a,scope:g,actionIndex:c,rowIndex:f,groupIndex:i}))return}var m=a?a.CommandName:"Select",l=a?a.CommandArgument:e,j=a?a.CausesValidation:true,n=a?a.Path:e;b.executeRowCommand(f,m,l,j,n)},executeRowCommand:function(c,d,b,e,f){var a=this;if(c!=null&&c>=0){a._selectedRowIndex=c;a._raiseSelectedDelayed=!(d=="Select"&&String.isNullOrEmpty(b));a._selectKeyByRowIndex(c)}a.executeCommand({commandName:d,commandArgument:b?b:"",path:f,causesValidation:e?true:false});if(d=="ClientScript")window.setTimeout(String.format('$find("{0}").refresh(true);',a.get_id()),10);else d=="Select"&&b==null&&!a.get_isGrid()&&a._render()},_get_dataRequestForm:function(){var b="_dataRequest_form",a=$get(b);if(!a){a=document.createElement("form");a.id=b;a.method="post";a.innerHTML='<input type="hidden" name="q" id="q"/><input type="hidden" name="aa" id="aa"/><input type="hidden" name="c" id="c"/><input type="hidden" name="a" id="a"/>';document.body.appendChild(a)}return a},_applySelectionFilter:function(b){var a=this;if(a.get_selectionMode()==Web.DataViewSelectionMode.Multiple&&a._selectedKeyList.length>0&&a._keyFields.length==1){b.Filter=Array.clone(b.Filter);Array.add(b.Filter,String.format("{0}:$in${1}",a._keyFields[0].Name,a._selectedKeyList.join("$or$")))}},get_appRootPath:function(){var a=this.get_servicePath();if(typeof __cothost!="undefined"){if(__cothost=="DotNetNuke"&&a.match(/DesktopModules\//i))return a.replace(/Service\.asmx$/i,"");if(__cothost=="SharePoint"&&a.match(/_layouts\//i))return a.replace(/Service\.asmx$/i,"")}return"~/"},executeReport:function(i){var a=this,b=a._createParams(true);b.Controller=a.get_controller();b.View=a.get_viewId();var c=a._get_dataRequestForm();c.target="";c.action=a.resolveClientUrl(a.get_appRootPath()+"Report.ashx");$get("c",c).value=i.commandName;var e=i.commandArgument;if(!String.isNullOrEmpty(e)){if(e.startsWith("_"))c.target=e;var h=e.split(Web.DataView._simpleListRegex);e=h[0];if(h.length==3){b.Controller=h[1];b.View=h[2]}}$get("a",c).value=e;if(b.Filter.length>0&&a.get_viewType()!="Form"){var g=new Sys.StringBuilder;a._renderFilterDetails(g,b.Filter);var f=a.get_master();if(f)for(var l=f.get_selectedRow(),j=0;j<f._allFields.length;j++){var d=f._allFields[j];if(d.ShowInSummary&&!d.OnDemand){d=f._allFields[d.AliasIndex];!g.isEmpty()&&g.append(" ");g.appendFormat("{0} {1} {2}.",d.HeaderText,Web.DataViewResources.Data.Filters.Labels.Equals,d.format(l[d.Index]))}}b.FilterDetails=g.toString().replace(/(<b class=\"String\">([\s\S]*?)<\/b>)/g,'"$2"').replace(/(&amp;)/g,"&").replace(/(<.+?>)|&nbsp;/g,"")}a._applySelectionFilter(b);$get("q",c).value=Sys.Serialization.JavaScriptSerializer.serialize(b);var k=a._createArguments(i);$get("aa",c).value=Web.DataView.htmlEncode(Sys.Serialization.JavaScriptSerializer.serialize(k));c.submit()},executeExport:function(a){var b=this,c=b._get_dataRequestForm();c.target=a.commandName=="ExportRss"?"_blank":"";c.action=b.resolveClientUrl(b.get_appRootPath()+"Export.ashx");var d=b._createParams(true);b._applySelectionFilter(d);a.Controller=b.get_controller();a.View=b.get_viewId();a.Filter=d.Filter;a.SortExpression=d.SortExpression;$get("c",c).value=a.commandName;$get("a",c).value=a.commandArgument;$get("q",c).value=Sys.Serialization.JavaScriptSerializer.serialize(a);c.submit()},_clearDynamicItems:function(){for(var a=0;a<this._allFields.length;a++){var b=this._allFields[a];if(b.DynamicItems)b.DynamicItems=null}},_copyLookupValues:function(i,b,d,f){if(String.isNullOrEmpty(b.Copy))return;var c=f?f:[],g=/(\w+)=(\w+)/g,a=g.exec(b.Copy);while(a){if(b._dataView.findField(a[1]))if(a[2]=="null")Array.add(c,{name:a[1],value:null});else if(i){var h=this.findField(a[2]);h&&Array.add(c,{name:a[1],value:i[h.Index]})}else if(d)for(var e=0;e<d.length;e++)if(d[e].Name==a[2]){Array.add(c,{name:a[1],value:d[e].NewValue});break}a=g.exec(b.Copy)}if(f)return;b._dataView.refresh(true,c);b._dataView._focus()},_copyExternalLookupValues:function(){var a=this;if(a.get_filterSource()&&a.get_filterSource()!="Context"){var b=a.get_master();if(b){for(var f=[],e=a.get_externalFilter(),d=0;d<e.length;d++){var c=a.findField(e[d].Name);c&&!String.isNullOrEmpty(c.Copy)&&b._copyLookupValues(b.get_currentRow(),c,null,f)}a._ditto=f}}},_processSelectedLookupValues:function(){var b=this,c=[],f=[],g=b.get_lookupField(),h=b.findField(g.ItemsDataValueField),i=b.findField(g.ItemsDataTextField),e=b.get_selectedRow();if(!h)for(var a=0;a<b._allFields.length;a++)b._allFields[a].IsPrimaryKey&&Array.add(c,e[b._allFields[a].Index]);else Array.add(c,e[h.Index]);if(!i){for(a=0;a<b.get_fields().length;a++){d=b.get_fields()[a];if(!d.Hidden&&d.Type=="String"){Array.add(f,e[d.AliasIndex]);break}}if(f.length==0)for(a=0;a<c.length;a++){var d=b.get_fields()[a];if(!d.Hidden){Array.add(f,e[d.AliasIndex]);break}}}else Array.add(f,e[i.Index]);b._copyLookupValues(e,g);g._dataView.changeLookupValue(g.Index,c.length==1?c[0]:c,f.join(";"))},_showModal:function(b){var c=null,a=this;a.set_lastCommandName(c);a.set_lastCommandArgument(c);a._render();if(b.commandName=="Duplicate")b.commandName="New";var d=Web.DataView.showModal(a,a.get_controller(),b.commandArgument,b.commandName,b.commandArgument,a.get_baseUrl(),a.get_servicePath(),a.get_hasParent()?a._externalFilter:c,{filter:a.get_selectedKeyFilter(),ditto:a.get_ditto(),lastViewId:a.get_lastViewId(),transaction:a.get_transaction(),filterSource:a.get_filterSource(),filterFields:a.get_filterFields(),showSearchBar:a.get_showSearchBar()});a.set_ditto(c);a._savePosition();if(!d.get_isInserting())d._position=a._position;a._restorePosition()},_savePosition:function(){var a=this;if(!a.get_isForm()&&a._selectedRowIndex!=null)a._position={index:a._pageSize*a._pageIndex+a._selectedRowIndex,count:a._totalRowCount,filter:a.get_filter(),sortExpression:a.get_sortExpression(),key:Array.clone(a._selectedKey),keyFilter:a._selectedKeyFilter,active:false}},_restorePosition:function(){var a=this;if(a._position){a._selectedKey=a._position.key;a._selectedKeyFilter=a._position.keyFilter;a._position=null}},_advance:function(b){var a=this;if(a._isBusy||!a._position||(b==-1&a._position.index==0||b==1&&a._position.index==a._position.count-1))return;a._position.index+=b;a._position.changing=true;a._position.changed=true;a._loadPage();a._position.changing=false},cancel:function(){var a=this;if(!a._closeInstantDetails())if(a.endModalState("Cancel"))return;else if(a.get_backOnCancel()||!String.isNullOrEmpty(a._replaceTriggerViewId)){a.goBack(false);window.setTimeout("location.replace(location.href)",500)}else{a.set_lastCommandName("Cancel");a._pendingSelectedEvent=true;if(a.get_isForm()||a.get_isInserting())a.goToView(a._lastViewId);else{a._clearDynamicItems();a._render();_body_performResize()}}},_actionConfirmed:function(g){var b=this,h=b._createArguments(g),i=b._validateFieldValues(h.Values,g.causesValidation==null||g.causesValidation);if(i){var a=b.get_confirmContext(),c=b.get_parentDataView();if(a&&c){var f=c._paramValues=h.Values,e=0;while(e<f.length){var d=f[e];d.ReadOnly=true;if(d.Name.match("PrimaryKey"))Array.removeAt(f,e);else{d.Name="Parameters_"+d.Name;e++}}c._confirmDataViewId=b.get_id();c.executeAction(a.scope,a.actionIndex,a.rowIndex,a.groupIndex,true)}}},executeCommand:function(b){var h="Grid",l="GridType",g="DataSheet",c=null,f="Duplicate",d="New",a=this;if(a._isBusy)return;switch(b.commandName){case"Select":case"":a.set_lastCommandName(b.commandName);a.set_lastCommandArgument(b.commandArgument);if(a.get_lookupField()&&b.commandArgument=="")a._processSelectedLookupValues();else if(!String.isBlank(b.commandArgument)){a._savePosition();if(a.get_showModalForms()&&a.get_isForm(b.commandArgument))a._showModal(b);else a.goToView(b.commandArgument)}else a._render();break;case"Edit":case"BatchEdit":case d:case f:a._allowModalAutoSize();a._fixHeightOfRow(false);if(b.commandName=="Edit")a._savePosition();else a._restorePosition();if(b.commandName==f){var s=a.get_selectedRow();if(s){var p=[];for(i=0;i<a._allFields.length;i++){var q=a._allFields[i];Array.add(p,{name:q.Name,value:s[q.Index]})}a._ditto=p}}var k=a._get_focusedCell();if(b.commandName==d||b.commandName==f){if(String.isNullOrEmpty(b.commandArgument))b.commandArgument=a.get_viewId();a._forgetSelectedRow(false,k);b.commandName==d&&a._copyExternalLookupValues()}a.set_lastCommandName(b.commandName);a.set_lastCommandArgument(b.commandArgument);a._clearDynamicItems();if(!String.isBlank(b.commandArgument))if(a.get_showModalForms()&&a.get_isForm(b.commandArgument)&&!a.get_isModal())a._showModal(b);else a.goToView(b.commandArgument);else{if(a.get_isModal())a._container.style.height="";a.get_isDataSheet()&&!a._pendingChars&&a._startInputListenerOnCell(a._selectedRowIndex,k==c?0:k.colIndex);a._render()}break;case"Navigate":a.navigate(b.commandArgument);break;case"Cancel":a.cancel();break;case"Confirm":a._actionConfirmed(b);break;case"Back":history.go(!String.isNullOrEmpty(b.commandArgument)?parseInt(b.commandArgument):-1);break;case"Report":case"ReportAsPdf":case"ReportAsImage":case"ReportAsExcel":case"ReportAsWord":a.executeReport(b);break;case"ExportCsv":case"ExportRowset":case"ExportRss":a.executeExport(b);break;case"_ViewDetails":a._viewDetails(b.commandArgument);break;case"ClientScript":Web.HoverMonitor._instance.close();eval(b.commandArgument);break;case"SelectModal":case"EditModal":a.set_lastCommandName(c);a.set_lastCommandArgument(c);a._render();var v=b.commandName.match(/^(\w+)Modal$/),e=b.commandArgument.split(","),t=e.length==1?a.get_controller():e[0],n=e.length==1?b.commandArgument:e[1],o=[];for(i=0;i<a.get_selectedKey().length;i++)Array.add(o,{Name:a._keyFields[i].Name,Value:a.get_selectedKey()[i]});var u=Web.DataView.showModal(a,t,n,v[1],n,a.get_baseUrl(),a.get_servicePath(),o);u._parentDataViewId=a.get_id();break;case"Import":a._showImport(b.commandArgument);break;case g:a.writeContext(l,g);a.changeViewType(g);a.refreshAndResize();break;case h:a.writeContext(l,h);a.changeViewType(h);a.refreshAndResize();break;case"Open":a.drillIn();break;case"Status":a._changeStatus(b);break;case"None":return;default:var j=c,r=b.commandArgument.match(/^view:(.+)$/);if(b.commandName=="Insert"&&r){j=r[1];Array.clear(a._selectedKey);a.updateSummary();a.set_lastCommandName(d);a.set_lastCommandArgument(j)}var m=a._createArguments(b,j);a._valid=a._validateFieldValues(m.Values,b.causesValidation==c||b.causesValidation);a._valid&&a._execute(m)}},_forgetSelectedRow:function(c,b){var a=this;if(!b)b=a._get_focusedCell();if(a.get_isDataSheet())if(b)b.colIndex=0;a._lastSelectedRowIndex=!a._ignoreSelectedKey&&a._selectedKey.length>0&&a._rowIsSelected(a._selectedRowIndex)?a._selectedRowIndex:-1;a._ignoreSelectedKey=false;Array.clear(a._selectedKey);a.updateSummary();c&&a.raiseSelected()},_changeStatus:function(c){var a=this;if(c.causesValidation){var e=a._collectFieldValues();if(c.values)e=Array.clone(c.values);if(!a._validateFieldValues(e,true))return}var d=a.findField("Status");if(!d)return;if(a.get_isEditing()){var b=a._get("_Item",d.Index);if(!b){b=document.createElement("input");b.type="hidden";b.id=String.format("{0}_Item{1}",a._id,d.Index);a._container.appendChild(b)}b.value=c.commandArgument}else{var f=a.get_selectedRow();f[d.Index]=c.commandArgument}a._updateVisibility()},_notifyDesigner:function(b){if(__designer()&&b){var a=this._lastArgs;window.external.ExplorerNodeChanged(this.get_controller(),this.get_viewId(),a.CommandName,a.CommandArgument,Sys.Serialization.JavaScriptSerializer.serialize(a.Values))}},goBack:function(b){Web.DataView._navigated=true;this._notifyDesigner(b);var a=location;if(a.href.match(/_explorerNode=/))a.replace(a.href);else history.go(-1)},get_path:function(){var b="TreePath",a=this.readContext(b);if(!a){a=[];Array.add(a,{text:Web.DataViewResources.Grid.RootNodeText,key:[],filter:[],quickFind:""});this.writeContext(b,a)}return a},drillIn:function(e){var a=this;if(!a.get_isTree())return;for(var d=0;d<a._allFields.length;d++){var f=a._allFields[d];if(f.ItemsDataController==a.get_controller()){var b=a.get_path();if(!b)b=[];if(e!=null){var c=b[e];while(b.length-1>e)Array.removeAt(b,b.length-1);a.set_selectedKeyFilter([]);a.set_quickFindText(c.quickFind);a.set_filter(c.filter);if(b.length==0){a.set_selectedKey([]);a.removeFromFilter(f);a.refreshData()}else{var h=c.key;a.applyFieldFilter(d,"=",h);a.set_selectedKey(h);a._syncKeyFilter()}a.raiseSelected()}else{var g=a._fields[0],i=g.format(a.get_selectedRow()[g.Index]);c=b[b.length-1];c.filter=a.get_filter();c.quickFind=a.get_quickFindText();Array.add(b,{text:i,key:a.get_selectedKey(),filter:[],quickFind:""});a.set_filter([]);a.set_quickFindText(null);a.applyFieldFilter(d,"=",a.get_selectedKey())}a.writeContext("TreePath",b);break}}},_viewDetails:function(i){var g="{0}&{1}={2}",a=this,b=a.findField(i);if(b){var f=b.Name;if(b.ItemsDataController==a.get_controller())for(var c=0;c<a._allFields.length;c++)if(a._allFields[c].IsPrimaryKey){f=a._allFields[c].Name;break}var d=String.format(g,b.ItemsDataController,!String.isNullOrEmpty(b.ItemsDataValueField)?b.ItemsDataValueField:f,a.get_selectedRow()[b.Index]),e=a.get_contextFilter(b);for(c=0;c<e.length;c++){var h=e[c];d=String.format(g,d,h.Name,h.Value)}d=a.resolveClientUrl(String.format("~/Details.{0}?l={1}",__designer()?"htm":"aspx",encodeURIComponent(d)));if(Web.DataViewResources.Lookup.ShowDetailsInPopup)a._navigate("_blank:"+d,"scrollbars=yes,height=100,resizable=yes");else window.location.href=d;Web.DataView._navigated=false}},changeViewType:function(b){var a=this;a.cancelDataSheet();if(!a._viewTypes)a._viewTypes=[];a._viewTypes[a.get_viewId()]=b},_parseLocation:function(a,h,g){var c=this;if(!h)h=c.get_selectedRow();if(!a)return null;a=c.resolveClientUrl(a);var f=/([\s\S]*?)\{(\w+)?\}/g,d="",e=-1,b=f.exec(a);while(b){d+=b[1];if(g&&c._lastArgs)for(var j=0;j<g.length;j++){var k=g[j];if(k.Name==b[2]){d+=c._lastArgs.CommandName.match(/Insert/i)?k.NewValue:k.OldValue;break}}else{var l=b[2].match(/^\d+$/)?c.get_fields()[parseInt(b[2])]:c.findField(b[2]);if(l){var i=h[l.Index];if(i!=null)d+=b.index==0?i:encodeURIComponent(i)}}e=f.lastIndex;b=f.exec(a)}if(e!=-1)a=d+(e<a.length?a.substr(e):"");if(a.startsWith("?"))a=location.pathname+a;return a},_showImport:function(c){var a=this;if(!c)c=a.get_viewId();a._importView=c;a._importElement=document.createElement("div");a._importElement.id=a.get_id()+"$Import";a._importElement.className="Import";var b=new Sys.StringBuilder,d=String.format("<a href=\"javascript:\" onclick=\"$find('{0}')._downloadImportTemplate('{1}');return false;\">{2}</a>",a.get_id(),c,Web.DataViewResources.Data.Import.DownloadTemplate);b.appendFormat('<div id="{0}$ImportStatus" class="Status"><span>{1}</span> {2}</div>',a.get_id(),Web.DataViewResources.Data.Import.UploadInstruction,d);b.appendFormat('<div id="{0}$ImportMap", class="Map" style="display:none"></div>',a.get_id());b.appendFormat('<iframe src="{1}?parentId={0}&controller={2}&view={3}" frameborder="0" scrolling="no" id="{0}$ImportFrame" class="Import"></iframe>',a.get_id(),a.resolveClientUrl(a.get_appRootPath()+"Import.ashx"),a.get_controller(),c);b.appendFormat('<div class="Email">{1}:<br/><input type="text" id="{0}$ImportEmail"/></div>',a.get_id(),Web.DataViewResources.Data.Import.Email);b.appendFormat('<div class="Buttons"><button id="{0}$StartImport" onclick="$find(\'{0}\')._startImportProcessing();return false;" style="display:none">{1}</button><button id="{0}$CancelImport" onclick="$find(\'{0}\')._closeImport();return false;">{2}</button></div>',a.get_id(),Web.DataViewResources.Data.Import.StartButton,Web.DataViewResources.ModalPopup.CancelButton);a._importElement.innerHTML=b.toLocaleString();a._appendModalPanel(a._importElement);a._importPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:a.get_id()+"$ImportPopup",PopupControlID:a._importElement.id,DropShadow:true,BackgroundCssClass:"ModalBackground"},null,null,a._container.getElementsByTagName("a")[0]);a._saveTabIndexes();a._importPopup.show()},_closeImport:function(){this._disposeImport();this._restoreTabIndexes()},_disposeImport:function(){var a=this;if(a._importElement){a._importPopup.hide();a._importPopup.dispose();a._importPopup=null;a._importElement.parentNode.removeChild(a._importElement);delete a._importElement}},_downloadImportTemplate:function(a){this.executeExport({commandName:"ExportTemplate",commandArgument:String.format("{0},{1}",this.get_controller(),a)})},_initImportUpload:function(a){var b=a.createElement("div");b.innerHTML=String.format('<form method="post" enctype="multipart/form-data"><input type="file" id="ImportFile" name="ImportFile" style="font-size:8.5pt;font-family:tahoma;padding:2px 0px 4px 0px;" onchange="parent.window.$find(\'{0}\')._startImportUpload(this.value);this.parentNode.submit()"/></form>',this.get_id());a.body.appendChild(b);Sys.UI.DomElement.setFocus(a.getElementById("ImportFile"))},_get_importStatus:function(){return $get(this.get_id()+"$ImportStatus")},_get_importFrame:function(){return $get(this.get_id()+"$ImportFrame")},_startImportUpload:function(c){var a=this,b=c.split(/\\/);a._importFileName=b[b.length-1];Sys.UI.DomElement.setVisible(a._get_importFrame(),false);Sys.UI.DomElement.addCssClass(a._get_importStatus(),"Wait");a._get_importStatus().innerHTML=Web.DataViewResources.Data.Import.Uploading},_finishImportUpload:function(c){var j="FileName",a=this;Sys.UI.DomElement.removeCssClass(a._get_importStatus(),"Wait");Sys.UI.DomElement.addCssClass(a._get_importStatus(),"Ready");var m=c.getElementById("Errors");if(m)a._get_importStatus().innerHTML=m.value;else{var o=c.getElementById(j),n=c.getElementById("NumberOfRecords"),g=c.getElementById("AvailableImportFields").value.trim().split(/\r?\n/),k=c.getElementById("FieldMap").value.trim().split(/\r?\n/);a._get_importStatus().innerHTML=String.format(Web.DataViewResources.Data.Import.MappingInstruction,n.value,a._importFileName);a._importFileName=c.getElementById(j).value;var i=$get(a.get_id()+"$StartImport");Sys.UI.DomElement.setVisible(i,true);Sys.UI.DomElement.setFocus(i);var b=new Sys.StringBuilder;b.append("<table>");for(var d=0;d<k.length;d++){var l=k[d].match(/^(.+?)=(.+?)?$/);b.appendFormat('<tr><td>{2}</td><td><select id="{0}$ImportField{1}"><option value="">{3}</option>',a.get_id(),d,Web.DataView.htmlEncode(l[1]),Web.DataViewResources.Data.Import.AutoDetect);for(var f=0;f<g.length;f++){var e=g[f].split("=");b.appendFormat('<option value="{0}"',e[0]);e[0]==l[2]&&b.append(' selected="selected"');b.appendFormat(">{0}</option>",Web.DataView.htmlEncode(e[1]))}b.append("</select></td></tr>")}b.append("</table>");var h=$get(a.get_id()+"$ImportMap");Sys.UI.DomElement.setVisible(h,true);h.innerHTML=b.toString()}a._importPopup.show();a._get_importFrame().parentNode.removeChild(a._get_importFrame())},_startImportProcessing:function(){var a=this,c=$get(a.get_id()+"$ImportEmail"),e=c.value.replace(/;/g,",");if(String.isBlank(e)&&!confirm(Web.DataViewResources.Data.Import.EmailNotSpecified)){Sys.UI.DomElement.setFocus(c);return}var b=new Sys.StringBuilder;b.appendFormat("{0};{1};{2};{3};",a._importFileName,a.get_controller(),a._importView,e);var f=0;while(true){var d=$get(a.get_id()+"$ImportField"+f);if(!d)break;b.append(d.value);b.append(";");f++}a.executeCommand({commandName:"ProcessImportFile",commandArgument:b.toString()});a._closeImport();alert(Web.DataViewResources.Data.Import.Processing);a.refresh()},navigate:function(b,d){var a=this;a.set_selectedValue(a.get_selectedKey());Web.HoverMonitor._instance.close();b=a._parseLocation(b,null,d);var c=null;for(i=0;i<a.get_views().length;i++)if(a.get_views()[i].Id==b){c=a.get_views()[i];break}if(c)a.goToView(b);else a._navigate(b)},_navigate:function(c,b){Web.DataView._navigated=true;var a=c.match(Web.DataView.LocationRegex);if(typeof __dauh!="undefined")if(a)this.encodePermalink(a[2],a[1],b);else this.encodePermalink(c);else if(a)window.open(a[2],a[1],b?b:"");else window.location.href=c},get_contextFilter:function(f){var c=[];if(!String.isNullOrEmpty(f.ContextFields)){var e=this._collectFieldValues(true),h=/(\w+)(=(.+?)){0,1}\s*(,|$)/g,b=h.exec(f.ContextFields);while(b){var j=!String.isNullOrEmpty(b[3])?b[3]:b[1],d=j.match(/^\'(.+)\'$/);if(d){for(var a=0;a<c.length;a++)if(c[a].Name==b[1]){c[a].Value+="\0="+d[1];d=null;break}d&&Array.add(c,{Name:b[1],Value:d[1]})}else{var i=this.findField(j);if(i)for(a=0;a<e.length;a++)if(e[a].Name==i.Name){var g=e[a],k=g.Modified?g.NewValue:g.OldValue;Array.add(c,{Name:b[1],Value:k});break}}b=h.exec(f.ContextFields)}}return c},showLookup:function(h){var f=true,c=null,b=this;if(!b.get_enabled())return;var a=b._allFields[h];if(!a._lookupModalBehavior){var i=$get(b.get_id()+"_Item"+a.Index+"_ShowLookupLink");if(i){var d=a._lookupModalPanel=document.createElement("div");b._appendModalPanel(d);d.className="ModalPanel";d.id=b.get_id()+"_ItemLookupPanel"+a.Index;d.innerHTML=String.format('<table style="width:100%;height:100%"><tr><td valign="middle" align="center"><table cellpadding="0" cellspacing="0"><tr><td class="ModalTop"><div style="height:1px;font-size:1px"></div></td><td><div style="height:1px;font-size:1px"></div></td></tr><tr><td align="left" valign="top" id="{0}_ItemLookupPlaceholder{1}"  class="ModalPlaceholder"></td><td class="RightSideShadow"></td></tr><tr><td colspan="2"><div class="BottomShadow"></div></td></tr></table></td></tr></table>',b.get_id(),a.Index);a._lookupModalBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{id:b.get_id()+"_ItemLookup"+a.Index,PopupControlID:d.id,BackgroundCssClass:"ModalBackground"},c,c,i)}}else a._lookupDataControllerBehavior._render();var e=b.get_contextFilter(a),g=f;if(!a._lookupDataControllerBehavior){g=false;a._lookupDataControllerBehavior=$create(Web.DataView,{id:b.get_id()+"_LookupView"+h,baseUrl:b.get_baseUrl(),pageSize:a.ItemsPageSize?a.ItemsPageSize:Web.DataViewResources.Pager.PageSizes[0],showFirstLetters:a.ItemsLetters,servicePath:b.get_servicePath(),controller:a.ItemsDataController,viewId:a.ItemsDataView,showActionBar:Web.DataViewResources.Lookup.ShowActionBar,lookupField:a,externalFilter:e,filterSource:e.length>0?"Context":c,showSearchBar:b.get_showSearchBar(),searchOnStart:b.get_showSearchBar()&&a.SearchOnStart,description:a.ItemsDescription},c,c,$get(b.get_id()+"_ItemLookupPlaceholder"+a.Index))}else if(e.length>0){a._lookupDataControllerBehavior.set_externalFilter(e);a._lookupDataControllerBehavior.goToPage(-1);g=f}b._saveTabIndexes();a._lookupModalBehavior.show();g&&a._lookupDataControllerBehavior._focusQuickFind(f);$addHandler(document.body,"keydown",a._lookupDataControllerBehavior._bodyKeydownHandler);a._lookupDataControllerBehavior._adjustLookupSize();b._lookupIsActive=f},changeLookupValue:function(d,h,f){var a=this,e=a._allFields[d];a._closeLookup(e);a._restoreTabIndexes();var c=a.get_id()+"_Item"+d,g=a.get_id()+"_Item"+e.AliasIndex;Sys.UI.DomElement.setVisible($get(c+"_ClearLookupLink"),true);var b=$get(c+"_ShowLookupLink");b.innerHTML=a.htmlEncode(e,f);Sys.UI.DomElement.setFocus(b);$get(c).value=h;if(c!=g)$get(g).value=f;while(b.tagName!="TABLE")b=b.parentNode;b.style.width="";a._updateLookupInfo(h,f);a._valueChanged(d);a._adjustModalHeight()},clearLookupValue:function(e){var g="_ShowLookupLink",a=this,c=a._allFields[e],b=a.get_id()+"_Item"+e,i=a.get_id()+"_Item"+c.AliasIndex;Sys.UI.DomElement.setVisible($get(b+"_ClearLookupLink"),false);$get(b+g).innerHTML=Web.DataViewResources.Lookup.SelectLink;$get(b).value="";$get(i).value="";if(!String.isNullOrEmpty(c.Copy)){var f=[],h=/(\w+)=(\w+)/g,d=h.exec(c.Copy);while(d){d[2]=="null"&&Array.add(f,{name:d[1],value:null});d=h.exec(c.Copy)}f.length>0&&a.refresh(true,f)}a._updateLookupInfo("",Web.DataViewResources.Lookup.SelectLink);$get(b+g).focus();a._valueChanged(e);a._adjustModalHeight()},_updateLookupInfo:function(d,e){var a=this,b=$get(a.get_id()+"_Text0");if(b){b.value=e;b.name=b.id;var c=$get(a.get_id()+"_Item0");c.value=d;c.name=c.id;if(a.get_lookupPostBackExpression()){var f=Sys.WebForms.PageRequestManager.getInstance();if(f)eval("Sys.WebForms.PageRequestManager.getInstance()._doPostBack"+a.get_lookupPostBackExpression().match(/\w+(.+)/)[1]);else eval(a.get_lookupPostBackExpression())}}},createNewLookupValue:function(d){var a=this,b=a._newLookupValueField=a._allFields[d],c=a._createNewView=Web.DataView.showModal(a,b.ItemsDataController,b.ItemsNewDataView,"New",b.ItemsNewDataView,a.get_baseUrl(),a.get_servicePath(),a.get_contextFilter(b));c._parentDataViewId=a.get_id();c.add_executed(Function.createDelegate(a,a._saveNewLookupValueCompleted));c.set_showSearchBar(a.get_showSearchBar());a._lookupIsActive=true},_saveNewLookupValueCompleted:function(a,b){var c=this;if(b.result.Errors.length>0)return;b.handled=true;Web.DataView.hideMessage();var f=null;if(b.result.Values.length==0)b.result.Values=a._lastArgs.Values;for(var d=0;d<b.result.Values.length;d++)if(b.result.Values[d].Name==a._keyFields[0].Name){f=b.result.Values[d].NewValue;break}var e=null;for(i=0;i<a._lastArgs.Values.length;i++)if(a._lastArgs.Values[i].Name==a._fields[0].Name){e=a._lastArgs.Values[i].NewValue;break}c._createNewView.endModalState("Cancel");c._copyLookupValues(null,c._newLookupValueField,a._lastArgs.Values);c.changeLookupValue(c._newLookupValueField.Index,f,e);c._lookupIsActive=false},hideLookup:function(b){var c=b?this._allFields[b]:this.get_lookupField(),a=this.get_lookupField()._dataView;a._closeLookup(c);a._restoreTabIndexes();$get(a.get_id()+"_Item"+c.Index+"_ShowLookupLink").focus()},closeLookupAndCreateNew:function(){this.hideLookup();var a=this.get_lookupField();a._dataView.createNewLookupValue(a.Index)},htmlEncode:function(c,a){var b=this._allFields[c.AliasIndex];return b.HtmlEncode?b.Type=="String"?Web.DataView.htmlEncode(a):a:a},filterIsExternal:function(d){var a=this;if(a._externalFilter.length==0)return false;for(var b=0;b<a._filter.length;b++){var f=a._filter[b].match(/(\w+):/)[1],e=false;if(!d||d==f)for(var c=0;c<a._externalFilter.length;c++)if(a._externalFilter[c].Name==f){e=true;break}if(!e)return false}return true},updateSummary:function(){var e=false,k="PageSummaryBox",g=null,a=this;if(!a.get_showInSummary())return;var b=g;if(!a._summaryId){var h=$getSideBar();if(!h)a._summaryId="";else{a._summaryId="PageSummary_"+a.get_id();b=$get(k);if(!b){b=document.createElement("div");b.id=k;b.className="TaskBox Summary";b.innerHTML=String.format('<div class="Inner"><div class="Summary">{0}</div></div>',Web.DataViewResources.Menu.Summary);h.insertBefore(b,h.childNodes[h._hasActivators?1:0]);b._numberOfVisibleSummaries=0}var c=$get(a._summaryId);if(!c){c=document.createElement("div");c.id=a._summaryId;b.childNodes[0].appendChild(c)}}}if(a._summaryId.length>0){if(!b)b=$get(k);if(!a._rows||a._rows.length==0){Sys.UI.DomElement.setVisible(b,e);return}var r=a.get_selectedRow();c=$get(a._summaryId);var d=new Sys.StringBuilder,p=a._lastCommandName,q=a.get_view().Type;a.get_view().Type="Grid";a._lastCommandName=g;var f=true;if(a._selectedKey.length>0)for(var n=true,m=0,l=0;l<a._allFields.length;l++){var i=a._allFields[l];if(i.ShowInSummary&&!i.Hidden){f=e;d.append('<div class="Field">');if(n)n=e;else d.append('<div class="Divider"></div>');d.appendFormat('<div class="Label">{0}</div>',String.trimLongWords(a._allFields[i.AliasIndex].Label));d.append('<div class="Value">');a._renderItem(d,i,r,e,e,e,e,true);d.append("</div></div>");m++;if(a.get_summaryFieldCount()>0&&m>=a.get_summaryFieldCount())break}}Sys.UI.DomElement.setVisible(c,!f);if(f&&a._summaryIsVisible)b._numberOfVisibleSummaries--;else if(!f&&!a._summaryIsVisible||!f&&a._summaryIsVisible==g)b._numberOfVisibleSummaries++;a._summaryIsVisible=!f;Sys.UI.DomElement.setVisible(b,b._numberOfVisibleSummaries>0);var o=d.toString();c.innerHTML=o;var j=a._lastArgs!=a._lastClearArgs&&a._lastArgs.CommandName=="Delete";if((!f||j)&&a.get_filterSource()==g&&typeof Web.Membership!="undefined"){if(j)a._lastClearArgs=a._lastArgs;Web.Membership._instance.addPermalink(String.format("{0}&_controller={1}&_commandName=Select&_commandArgument=editForm1",a.get_keyRef(),a.get_controller()),j?g:String.format('<div class="TaskBox" style="width:{2}px"><div class="Inner"><div class="Summary">{0}</div>{1}</div></div>',document.title,o,c.offsetWidth==0?135:c.offsetWidth))}d.clear();a._lastCommandName=p;a.get_view().Type=q}},get_hasDetails:function(){return this._hasDetails==true},get_hasParent:function(){return this._hasParent==true},get_usesTransaction:function(){return this._usesTransaction==true},get_inTransaction:function(){return this.get_transaction()!=null},add_selected:function(a){this._hasDetails=true;this.get_events().addHandler("selected",a)},remove_selected:function(a){this.get_events().removeHandler("selected",a)},raiseSelected:function(){var a=this;if(Web.DataView._navigated)return;var b=a.get_events().getHandler("selected");b&&b(a,Sys.EventArgs.Empty);a.get_selectionMode()!=Web.DataViewSelectionMode.Multiple&&a.set_selectedValue(a.get_selectedKey())},add_executed:function(a){this.get_events().addHandler("executed",a)},remove_executed:function(a){this.get_events().removeHandler("executed",a)},raiseExecuted:function(b){var a=this.get_events().getHandler("executed");a&&a(this,b)},_closeLookup:function(a){$closeHovers();if(a&&a._lookupModalBehavior){a._lookupModalBehavior.hide();$removeHandler(document.body,"keydown",a._lookupDataControllerBehavior._bodyKeydownHandler)}this._lookupIsActive=false;if(window.event){var b=new Sys.UI.DomEvent(event);b.stopPropagation();b.preventDefault()}},_collectFieldValues:function(s){var h=null,j="_Item",c=this;s=true;var k=[],q=c.get_selectedRow(),o=c.get_isInserting();if(!q&&!o)return k;for(var d=0;d<c._allFields.length;d++){var a=c._allFields[d],b=c._get(j,d);if(a.ReadOnly&&!s)b=h;else if(a.ItemsStyle=="RadioButtonList"){var e=0,g=$get(c.get_id()+j+d+"_"+e);while(g){if(g.checked){b=g;break}e++;g=$get(c.get_id()+j+d+"_"+e)}}else if(a.ItemsStyle=="CheckBoxList"&&b){e=0;g=$get(c.get_id()+j+d+"_"+e);if(g){b.value="";while(g){if(g.checked){if(b.value.length>0)b.value+=",";b.value+=g.value}e++;g=$get(c.get_id()+j+d+"_"+e)}}}if(a.Editor&&b){var w=$get(b.id+"$Frame"),t=Web.DataView.Editors[a.EditorId];if(t)b.value=t.GetValue()}var f=b?b.value:h;if(f)if(a.Type.startsWith("Date")){var i=Date.tryParseFuzzyDate(f,a.DataFormatString);if(i!=h&&b.type=="text")f=b.value=a.DateFmtStr?String.format(a.DateFmtStr,i):a.format(i)}else if(!String.isBlank(a.DataFormatString)&&a.isNumber()){var l=Number.tryParse(f);if(l!=h){if(a.DataFormatString.match(/\{0:p\}/i)&&l>1)l=l/100;f=b.value=a.format(l)}}if(a.TimeFmtStr){var p=c._get("_Item$Time",d);if(p){i=Date.tryParseFuzzyTime(p.value);if(i!=h){p.value=String.localeFormat(a.TimeFmtStr,i);f+=" "+p.value}}}if(!a.OnDemand&&(b||a.IsPrimaryKey||(!a.ReadOnly||s))){var u=true,r=false;if(c._lastCommandName=="BatchEdit"){var v=$get(String.format("{0}$BatchSelect{1}",c.get_id(),a.Index));r=a.TextMode==4||a.Hidden||a.ReadOnly;u=a.IsPrimaryKey||r||v&&v.checked}u&&Array.add(k,{Name:a.Name,OldValue:o?h:q[a.Index],NewValue:b&&f?a.Type=="Boolean"?f=="true":f:h,Modified:b!=h&&!(!o&&a.Type=="String"&&String.isNullOrEmpty(f)&&String.isNullOrEmpty(q[a.Index])),ReadOnly:a.ReadOnly&&!(a.IsPrimaryKey&&o)||r})}}for(d=0;d<c._externalFilter.length;d++){var n=c._externalFilter[d];for(e=0;e<k.length;e++){var m=k[e];if(m.Name.toLowerCase()==n.Name.toLowerCase()&&m.NewValue==h){m.NewValue=typeof n.Value=="string"?c.convertStringToFieldValue(c.findField(m.Name),n.Value):n.Value;m.Modified=true;break}}}return k},_enumerateExpressions:function(f,e,d){var c=[];if(this._expressions)for(var b=0;b<this._expressions.length;b++){var a=this._expressions[b];a.Scope==e&&(f==Web.DynamicExpressionType.Any||a.Type==Web.DynamicExpressionType.RegularExpression)&&a.Target==d&&Array.add(c,a)}return c},_prepareJavaScriptExpression:function(a){if(!a._variables){var c=[],g=/\[(\w+)\]/g,e=g.exec(a.Test);while(e){for(var b=e[1],f=false,d=0;d<c.length;d++)if(c[d].name==b){f=true;break}if(!f){var h=this.findField(b);h&&Array.add(c,{name:b,regex:new RegExp("\\["+b+"\\]","g"),replace:String.format("this._javaScriptRowValue({0})",h.Index)})}e=g.exec(a.Test)}a._variables=c}},_javaScriptRowValue:function(a){return this._javaScriptRow[a]},_evaluateJavaScriptExpressions:function(h,k,g){var c=null;for(var d=g?"":c,e=0;e<h.length;e++){var a=h[e];if(a.Type==Web.DynamicExpressionType.ClientScript){this._prepareJavaScriptExpression(a);var b=a._script;if(!b){b=a.Test;for(var f=0;f<a._variables.length;f++){var j=a._variables[f];b=b.replace(j.regex,j.replace)}a._script=b}if(b){this._javaScriptRow=k;try{var i=eval(b);if(g){if(i)if(d==c)d=a.Result;else d+=" "+a.Result}else return a.Result==c?i:a.Result}catch(l){}finally{this._javaScriptRow=c}}}}return d},_validateFieldValueFormat:function(d,a){var c=null;switch(d.Type){case"SByte":case"Byte":case"Int16":case"Int32":case"UInt32":case"Int64":case"Single":case"Double":case"Decimal":case"Currency":var b=a.NewValue;if(typeof b!="number")b=Number.tryParse(b);if(isNaN(b)||b==null)c=Web.DataViewResources.Validator.NumberIsExpected;else a.NewValue=b;break;case"Boolean":try{a.NewValue=String.isInstanceOfType(a.NewValue)?Boolean.parse(a.NewValue):a.NewValue}catch(e){c=Web.DataViewResources.Validator.BooleanIsExpected}break;case"DateTime":b=!String.isNullOrEmpty(d.DataFormatString)?Date.parseLocale(a.NewValue,d.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1]):Date.parse(a.NewValue);if(!b)c=Web.DataViewResources.Validator.DateIsExpected;else a.NewValue=b;if(!c&&a.NewValue!=null)a.NewValue=new Date(a.NewValue-a.NewValue.getTimezoneOffset()*60*1e3)}return c},_validateFieldValues:function(q,k){var c=null,o="DateTime",e=this;for(var g=true,l=new Sys.StringBuilder,m=0;m<q.length;m++){var a=q[m],b=e.findField(a.Name);if(!b)continue;if(b.Type==o&&a.OldValue!=c&&a.OldValue.getTimezoneOffset)a.OldValue=new Date(a.OldValue-a.OldValue.getTimezoneOffset()*60*1e3);var d=c;if(b.ReadOnly&&b.IsPrimaryKey){if(a.NewValue==c&&a.OldValue!=c)a.NewValue=a.OldValue}else if(a.Modified){if(!b.AllowNulls&&(!b.HasDefaultValue||Web.DataViewResources.Validator.EnforceRequiredFieldsWithDefaultValue))if(String.isBlank(a.NewValue)&&!b.Hidden&&!b.isReadOnly())d=Web.DataViewResources.Validator.RequiredField;if(!d&&String.isBlank(a.NewValue))a.NewValue=c;if(!d&&a.NewValue!=c&&!b.IsMirror&&(!b.Hidden||a.Modified)){var u=e._validateFieldValueFormat(b,a);if(!b.isReadOnly())d=u}if(!d)for(var p=e._enumerateExpressions(Web.DynamicExpressionType.RegularExpression,Web.DynamicExpressionScope.Field,a.Name),n=0;n<p.length;n++){var i=p[n],t=a.NewValue?a.NewValue:"";try{var r=new RegExp(i.Test),s=r.exec(t);if(i.Result.match(/\$(\d|\'\`)/)){if(s)a.NewValue=t.replace(r,i.Result)}else if(!s)d=d?(d+=i.Result):i.Result}catch(v){}}a.Modified=b.Type.startsWith(o)?(a.NewValue==c?c:a.NewValue.toString())!=(a.OldValue==c?c:a.OldValue.toString()):a.NewValue!=a.OldValue}var f=$get(e.get_id()+"_Item"+b.Index+"_Error");if(f&&k){Sys.UI.DomElement.setVisible(f,false);f.innerHTML=d;d!=c&&g&&e._showFieldError(b,d);var h=f.parentNode;while(h&&h.tagName!="BODY"){if(!$common.getVisible(h)){f=c;break}h=h.parentNode}}if(d&&k){if(g){var j=e._lastFocusedCell;if(j){e._focusCell(-1,-1,false);e._focusCell(j.rowIndex,j.colIndex,true);e._lastFocusedCell=c}e._focus(b.Name)}g=false;!f&&l.append(Web.DataView.formatMessage("Attention",b.Label+": "+d))}}if(!k)g=true;!g&&Web.DataView.showMessage(l.toString());l.clear();return g},_fieldIsInExternalFilter:function(a){return this._findExternalFilterItem(a)!=null},_findExternalFilterItem:function(c){for(var a=0;a<this._externalFilter.length;a++){var b=this._externalFilter[a];if(c.Name.toLowerCase()==b.Name.toLowerCase())return b}return null},_internalFocus:function(){var a=$get(this._focusId);if(a)try{a.value="";a.value=this._focusText;Sys.UI.DomElement.setCaretPosition(a,this._focusText.length)}catch(b){}},_showFieldError:function(g,d){var b="px",c=this,a=c._get("_Item",g.Index+"_Error");if(a){Sys.UI.DomElement.setVisible(a,d!=null);if(d){c._skipErrorReset=true;a.style.marginLeft="0px";a.style.marginTop="0px";a.innerHTML=String.format('{0} <a href="javascript:" onclick="Sys.UI.DomElement.setVisible(this.parentNode, false);$find(\'{2}\')._focus(\'{3}\');return false" class="Close" title="{1}"><span>&nbsp;</span></a>',d,Web.DataViewResources.ModalPopup.Close,c.get_id(),g.Name);if(c.get_isForm()){var f=$common.getPaddingBox(a.previousSibling?a.previousSibling:a);a.style.marginLeft=f.left+b;a.style.marginTop=1+b}else{var j=$common.getScrolling(),k=$common.getClientBounds(),h=$common.getBounds(a),e=h.x+h.width-(j.x+k.width);if(e<0)e=0;var l=$common.getBounds(a.parentNode);f=$common.getPaddingBox(a.parentNode);var i=$common.getBounds(a.nextSibling?a.nextSibling:a);a.style.marginLeft=-(i.x-l.x+1+e)+b;a.style.marginTop=i.height+f.bottom+b}}}},_focus:function(d,k){var i=true,m=false,l=null,a=this;if(k)for(var b=0;b<a.get_fields().length;b++)a._showFieldError(a.get_fields()[b]);var e=a._get_focusedCell();if(e&&a.get_isEditing()&&a._id==Web.DataView._activeDataSheetId){if(!String.isNullOrEmpty(d)){var c=l,p=m;for(b=0;b<a._fields.length;b++){c=a._fields[b];if(c.Name==d){a._focusCell(e.rowIndex,e.colIndex,m);p=e.colIndex!=b;e={rowIndex:a._selectedRowIndex,colIndex:b};if(!a._continueAfterScript)a._saveAndNew=m;break}}if(!String.isNullOrEmpty(k)&&c){if(p){a._focusCell(e.rowIndex,e.colIndex,i);a.refresh(i)}a._showFieldError(c,k)}}var j=a._focusCell(e.rowIndex,e.colIndex,i);if(j){var f=j.getElementsByTagName("input"),q=m;for(b=0;b<f.length;b++)if(f[b].type!="hidden"){q=i;break}if(!q)f=j.getElementsByTagName("textarea");if(f.length==0)f=j.getElementsByTagName("select");if(f.length==0)f=j.getElementsByTagName("a");for(b=0;b<f.length;b++){var g=f[b];if(g.tagName!="INPUT"||g.type!="hidden"){if((g.tagName=="INPUT"||g.tagName=="TEXTAREA")&&a._pendingChars!=l){a._focusText=a._pendingChars;a._focusId=g.id;window.setTimeout(String.format("$find('{0}')._internalFocus()",a.get_id(),50))}else Sys.UI.DomElement.setFocus(g);break}}}a._pendingChars=l;return}if(String.isNullOrEmpty(d)&&!String.isNullOrEmpty(a._focusedFieldName)){c=a.findField(a._focusedFieldName);if(c)d=c.Name}for(b=0;b<a.get_fields().length;b++){c=a.get_fields()[b];var o=c.ItemsStyle=="AutoComplete"&&(c.Name==d||c.AliasName==d||String.isNullOrEmpty(d));if(!c.ReadOnly&&(d==l||c.Name==d||o)){var n=a.get_id()+"_Item"+(o?c.AliasIndex:c.Index);switch(c.ItemsStyle){case"RadioButtonList":case"CheckBoxList":n+="_0";break;case"Lookup":n+="_ShowLookupLink"}var r=$get(n),s=$get(String.format("{0}_ItemContainer{1}",a.get_id(),c.Index)),t=a._categories[c.CategoryIndex],h=Array.indexOf(a._tabs,t.Tab);d&&h>=0&&a.set_categoryTabIndex(h);a._toggleCategoryVisibility(c.CategoryIndex,i);if(r&&(!s||Sys.UI.DomElement.getVisible(s)))if(d||(h==a.get_categoryTabIndex()||a._tabs.length==0)){h>=0&&a.set_categoryTabIndex(h);try{k&&a._showFieldError(c,k);Sys.UI.DomElement.setFocus(r)}catch(u){}break}}}},_saveTabIndexes:function(){var a=this;a._lastSavedTabIndexes=a._savedTabIndexes;a._savedTabIndexes=[];for(var c=0;c<Web.DataView._tagsWithIndexes.length;c++)for(var e=document.getElementsByTagName(Web.DataView._tagsWithIndexes[c]),d=0;d<e.length;d++){var b=e[d];b&&Array.add(a._savedTabIndexes,{element:b,tabIndex:b.tabIndex})}},_restoreTabIndexes:function(){var a=this;if(a._savedTabIndexes){for(var b=0;b<a._savedTabIndexes.length;b++){a._savedTabIndexes[b].element.tabIndex=a._savedTabIndexes[b].tabIndex;delete a._savedTabIndexes[b].element}Array.clear(a._savedTabIndexes)}a._savedTabIndexes=a._lastSavedTabIndexes;a._lastSavedTabIndexes=null},_selectKeyByRowIndex:function(e){var a=this,c=a._selectedKey;a._selectedKey=[];a._selectedKeyFilter=[];for(var b=0;b<a._keyFields.length;b++){var d=a._keyFields[b];Array.add(a._selectedKey,a._rows[e][d.Index]);Array.add(a._selectedKeyFilter,d.Name+":="+a.convertFieldValueToString(d,a._rows[e][d.Index]));if(c&&(c.length<b||c[b]!=a._selectedKey[b]))c=null}a.updateSummary();!c&&!a._raiseSelectedDelayed&&a.raiseSelected()},_showWait:function(c){var a=this;if(a.get_fields()==null||c)a._container.innerHTML=Web.DataViewResources.Common.WaitHtml;else{var b=$get(a.get_id()+"_Wait");if(b){a._oldWaitHTML=b.innerHTML;b.innerHTML=Web.DataViewResources.Common.WaitHtml}}},_hideWait:function(){if(this._oldWaitHTML!=null){var a=$get(this.get_id()+"_Wait");if(a)a.innerHTML=this._oldWaitHTML}},_get_colSpan:function(){var a=this;return a.get_isForm()?2:a.get_fields().length+(a._selectionMode==Web.DataViewSelectionMode.Multiple?1:0)+(a.get_showIcons()?1:0)+(a.get_isDataSheet()?1:0)+(a._actionColumn?1:0)},_renderCreateNewBegin:function(b,a){!String.isNullOrEmpty(a.ItemsNewDataView)&&b.append('<table cellpadding="0" cellspacing="0"><tr><td>')},_renderCreateNewEnd:function(b,a){if(!String.isNullOrEmpty(a.ItemsNewDataView)){b.append("</td><td>");this.get_enabled()&&b.appendFormat('<a href="#" class="CreateNew" onclick="$find(\'{0}\').createNewLookupValue({1});return false" id="{0}_Item{1}_CreateNewLookupLink" title="{2}"{3}>&nbsp;</a>',this.get_id(),a.Index,String.format(Web.DataViewResources.Lookup.NewToolTip,a.Label),String.format(' tabindex="{0}"',$nextTabIndex()));b.append("</td></tr></table>")}},_raisePopulateDynamicLookups:function(){var a=this;a._hasDynamicLookups&&a.get_isEditing()&&a._skipPopulateDynamicLookups!=true&&a.executeCommand({commandName:"PopulateDynamicLookups",commandArgument:"",causesValidation:false});a._skipPopulateDynamicLookups=false},_raiseCalculate:function(a){this.executeCommand({commandName:"Calculate",commandArgument:a.Name,causesValidation:false})},get_currentRow:function(){var a=this;return a.get_isInserting()?a._newRow?a._newRow:[]:a.get_selectedRow()},fieldValue:function(f,c){var a=null,b=!c||c.length==0?this:c.match(/^master$/i)?this.get_master():$find(c);if(!b)return a;if(!b._allFields)return a;var e=b.findField(f);if(!e)return a;var d=b._clonedRow;if(d==a)d=b._cloneChangedRow();return d?d[e.Index]:a},_useLEVs:function(g){var b=this;if(g&&b._allowLEVs){var d=b._get_LEVs();if(d.length>0)for(i=0;i<d[0].length;i++){var a=d[0][i];f=b.findField(a.Name);if(f&&f.AllowLEV){if(b._lastCommandName=="New"&&a.Modified&&a.NewValue!=null){for(var e=true,c=0;c<b._externalFilter.length;c++)if(b._externalFilter[c].Name.toLowerCase()==a.Name.toLowerCase()){e=false;break}if(e)g[f.Index]=a.NewValue}f._LEV=a.Modified?a.NewValue:null}}}},_configure:function(b){var a=this;if(!a._requiresConfiguration)return;if(!b)b=a.get_currentRow();if(!b)return;for(var e=0;e<a._allFields.length;e++){var c=a._allFields[e];if(!String.isNullOrEmpty(c.Configuration)){var g=/\s*(\w+)=(\w+)\s*?($|\n)/g,d=g.exec(c.Configuration);while(d){var f=a.findField(d[2]);if(f){var h=b[f.Index];if(h)c[d[1]]=h}d=g.exec(c.Configuration)}}}},_focusQuickFind:function(b){var a=this;if(!a._quickFindFocused||b==true){a._lostFocus=true;try{Sys.UI.DomElement.setFocus(a.get_quickFindElement())}catch(c){}a._quickFindFocused=true}},_restoreEmbeddedViews:function(){var a=this;if(!a._embeddedViews)return;for(var c=0;c<a._embeddedViews.length;c++){var b=a._embeddedViews[c];b.parent.appendChild(b.view._element);delete b.parent;b.view=null}Array.clear(a._embeddedViews)},_incorporateEmbeddedViews:function(){if(!this._embeddedViews)return;for(var b=0;b<this._embeddedViews.length;b++){var a=this._embeddedViews[b],d=$get("v_"+a.view.get_cookie().replace(/-/g,"")),c=a.view._element;a.parent=c.parentNode;d.appendChild(c)}},_render:function(){var b=false,a=this;a._restoreEmbeddedViews();a._detachBehaviors();a._disposeSearchBarExtenders();a._useLEVs();a._configure();a._internalRender();a._raisePopulateDynamicLookups();!a.get_modalAnchor()&&a.get_lookupField()&&a._focusQuickFind();if(a._raiseSelectedDelayed){a._raiseSelectedDelayed=b;a.raiseSelected();a._forceChanged=b}if(a._scrollIntoView){a._scrollIntoView=b;var e=$common.getBounds(a._element),d=$common.getScrolling();e.y<d.y&&a._element.scrollIntoView(true)}a._incorporateEmbeddedViews();a.get_isModal()&&a._adjustModalPopupSize();if(a.get_searchOnStart()&&a.get_isGrid()){a._focusSearchBar();a.set_searchOnStart(b)}if(a.get_isDataSheet()){var c=a._get_focusedCell();if(a.get_isInserting()&&!c)a._startInputListenerOnCell(0,0);else if(c&&a._id==Web.DataView._activeDataSheetId){a._skipCellFocus=true;a._focusCell(-1,-1,true)}}a._syncKeyFilter()},_syncKeyFilter:function(){var a=this,c=a.get_selectedKey();if(c.length>0&&a._selectedKeyFilter.length==0)for(var b=0;b<a._keyFields.length;b++){var d=a._keyFields[b];Array.add(a._selectedKeyFilter,d.Name+":="+a.convertFieldValueToString(d,c[b]))}},_mergeRowUpdates:function(b){var a=this;a._originalRow=null;a._useLEVs(b);if(a.get_isEditing()&&a._ditto){a._originalRow=Array.clone(b);for(var d=0;d<a._ditto.length;d++){var e=a._ditto[d],c=a.findField(e.name);if(c&&!(c.ReadOnly&&c.IsPrimaryKey))b[c.Index]=e.value}delete a._ditto}a._configure(b);a._mergedRow=b},_removeRowUpdates:function(){var a=this,c=a._mergedRow;if(!c)return;if(a._originalRow)for(var b=0;b<a._originalRow.length;b++)c[b]=a._originalRow[b];a._mergedRow=null},_internalRender:function(){var f=null,a=this;a._multipleSelection=f;a._dynamicActionButtons=false;var b=new Sys.StringBuilder;if(a.get_mode()==Web.DataViewMode.Lookup){var c=a._fields[0],d=a.get_lookupText();if(d==f)d=Web.DataViewResources.Lookup.SelectLink;var i=c.format(d);a._renderCreateNewBegin(b,c);b.appendFormat('<table cellpadding="0" cellspacing="0" class="DataViewLookup"><tr><td><a href="javascript:" onclick="$find(\'{0}\').showLookup({1});return false" class="Select" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{7}"{8}>{2}</a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{5}" tabindex="{7}">&nbsp;</a></td></tr></table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Text{1}" value="{6}"/>',a.get_id(),c.Index,a.htmlEncode(c,i),String.format(Web.DataViewResources.Lookup.SelectToolTip,c.Label),a.get_lookupValue(),String.format(Web.DataViewResources.Lookup.ClearToolTip,c.Label),Web.DataView.htmlAttributeEncode(i),$nextTabIndex(),a.get_enabled()?"":' disabled="true" class="Disabled"');a._renderCreateNewEnd(b,c);a.get_element().appendChild(a._container);a._container.innerHTML=b.toString();if(a.get_lookupValue()==""||!a.get_enabled())$get(a.get_id()+"_Item0_ClearLookupLink").style.display="none"}else{b.appendFormat('<table class="DataView {1}_{2}{3}{4} {5}Type" cellpadding="0" cellspacing="0"{0}>',a.get_isModal()?String.format(' style="width:{0}px"',a._container.offsetWidth-20):"",a.get_controller(),a.get_viewId(),a._numberOfColumns>0?" MultiColumn":"",a._tabs.length>0?" Tabbed":"",a.get_viewType());if(a.get_isForm())a._renderFormView(b);else a._renderGridView(b);b.append("</table>");if(a._mergedRow)for(var h=a._get_focusedCell(),e=0;e<a._allFields.length;e++){var g=a._allFields[e];if(g.Hidden&&(!g.IsPrimaryKey||a.get_isInserting())||h&&e!=a._fields[h.colIndex].Index){d=a._mergedRow[e];d!=f&&b.appendFormat('<input id="{0}_Item{1}" type="hidden" value="{2}"/>',a.get_id(),e,Web.DataView.htmlAttributeEncode(d!=f?g.format(d):""))}}a._container.innerHTML=b.toString();if(a._multipleSelection!=f&&a._multipleSelection==true)$get(a.get_id()+"_ToggleButton").checked=true;a._attachBehaviors();a._updateVisibility();a.get_isEditing()&&a._focus()}b.clear();a._updateChart();a._updateSearchBar();a._removeRowUpdates();a._fixWidthOfColumns();a._fixHeightOfRow(true)},_get_headerRowElement:function(){var b=this._container.childNodes[0].childNodes[0].childNodes,a=0;while(a<b.length){if(Sys.UI.DomElement.containsCssClass(b[a],"HeaderRow"))return b[a];a++}return null},_fixWidthOfColumns:function(){var f="Fixed",c=this;if(c.get_isDataSheet()||c.get_isGrid()){var b=c._get_headerRowElement();if(b){if(!c._viewColumnSettings)c._viewColumnSettings=[];var d=c._viewColumnSettings[c.get_viewId()];if(!d){d=[];Sys.UI.DomElement.addCssClass(b,f);for(var a=0;a<b.childNodes.length;a++){var g=b.childNodes[a],h=$common.getBounds(g);if(h.width==0){Sys.UI.DomElement.removeCssClass(b,f);return}var k=$common.getPaddingBox(g),j=$common.getBorderBox(g),e={w:h.width-k.horizontal-j.horizontal,h:h.height-k.vertical-j.vertical};Array.add(d,e)}var l=$common.getBounds(b);for(a=0;a<d.length;a++)d[a].h=l.height;c._viewColumnSettings[c.get_viewId()]=d;Sys.UI.DomElement.removeCssClass(b,f)}for(a=0;a<b.childNodes.length;a++){e=d[a];if(e){var i=b.childNodes[a];i.style.height=e.h+"px";i.style.width=e.w+"px"}}}}},_fixHeightOfRow:function(g){var a=this;if((a.get_isDataSheet()||a.get_isGrid())&&(!g||a.get_isEditing())){var c=a._get_headerRowElement();if(!c)return;var h=a._get_focusedCell(),f=a.get_isGrid()?a._selectedRowIndex:h.rowIndex;if(f>=0){for(var e=c.parentNode,b=0;b<e.childNodes.length;b++)if(e.childNodes[b]==c)break;var d=e.childNodes[b+f+1];if(d)if(g){if(a._selectedRowHeight)d.style.height=a._selectedRowHeight+"px"}else{var i=$common.getBounds(d);a._selectedRowHeight=i.height}}}},_updateChart:function(){var b=this;if(b.get_isChart()){var c=b._get("$Chart"),d=c.offsetWidth;if(d<100)d=c.parentNode.offsetWidth;var a=b._createParams();delete a.Transaction;delete a.LookupContextFieldName;delete a.LookupContextController;delete a.LookupContextView;delete a.LookupContext;delete a.LastCommandName;delete a.LastCommandArgument;delete a.Inserting;delete a.DoesNotRequireData;var f=Sys.Serialization.JavaScriptSerializer.serialize(a),e=$common.getBounds(c);if(e.height>0)c.style.height=e.height+"px";c.src=String.format("{0}ChartHost.aspx?c={1}_{2}&w={3}&r={4}",b.get_baseUrl(),b.get_controller(),b.get_viewId(),d,encodeURIComponent(f))}},_toggleCategoryVisibility:function(d,a){var e="Maximize",c=$get(String.format("{0}$Category${1}",this.get_id(),d));if(c){var f=this.get_categories()[d];if(!a)a=!Sys.UI.DomElement.getVisible(c);Sys.UI.DomElement.setVisible(c,a);var b=$get(String.format("{0}$CategoryButton${1}",this.get_id(),d));f.Collapsed=!a;if(a){Sys.UI.DomElement.removeCssClass(b,e);b.childNodes[0].title=Web.DataViewResources.Form.Minimize}else{Sys.UI.DomElement.addCssClass(b,e);b.childNodes[0].title=Web.DataViewResources.Form.Maximize}_body_performResize()}},_processTemplatedText:function(j,a){var d=false;if(!a)a="";var h=/\{(\w+)\}/g,c=h.exec(a);if(!c)return a;var b=new Sys.StringBuilder,e=0;while(c){b.append(a.substring(e,c.index));var f=c[1];e=c.index+f.length+2;var i=this.findField(f);if(i){b.append('<span class="FieldPlaceholder">');this._renderItem(b,i,j,d,d,d,d,d,true);b.append("</span>")}else b.appendFormat("[{0}]",f);c=h.exec(a)}var g=a.length-1;e<g&&b.append(a.substring(e,g));return b.toString().replace(/ (id|for)=\".+?\"/g,"")},_get_selectedTab:function(){return this._tabs.length>0?this._tabs[this.get_categoryTabIndex()]:null},_renderFormView:function(b){var y="</td></tr></table>",x="display:none",r="none",q="block",w="</td></tr>",k=false,g=true,v="</tr></table></td></tr>",a=this,E=a.get_isEditing();a._renderStatusBar(b);a._renderViewDescription(b);Web.DataViewResources.Form.ShowActionBar&&a._renderActionBar(b);var e=a.get_currentRow();a._mergeRowUpdates(e);if(a.get_isInserting()&&a._expressions)for(i=0;i<a._expressions.length;i++){var h=a._expressions[i];if(h.Scope==Web.DynamicExpressionScope.DefaultValues&&h.Type==Web.DynamicExpressionType.ClientScript){f=a.findField(h.Target);if(f)if(String.isNullOrEmpty(h.Test))e[f.Index]=h.Result;else{var B=eval(h.Test);if(B)e[f.Index]=String.isNullOrEmpty(h.Result)?B:h.Result}}}var D=0;for(i=0;i<a._allFields.length;i++)if(!a._allFields[i].Hidden)D++;var u=e!=null;u&&a._renderActionButtons(b,"Top","Form");var o=a._get_selectedTab();if(a._tabs.length>0){b.appendFormat('<tr class="TabsRow"><td colspan="{0}" class="TabsBar{1}">',a._get_colSpan(),!u?" WithMargin":"");b.append('<table cellpadding="0" cellspacing="0" class="Tabs"><tr>');for(i=0;i<a._tabs.length;i++)b.appendFormat('<td id="{2}_Tab{3}" class="Tab{1}" onmouseover="$hoverTab(this,true)" onmouseout="$hoverTab(this,false)"><span class="Outer"><span class="Inner"><span class="Tab"><a href="javascript:" onclick="$find(&quot;{2}&quot;).set_categoryTabIndex({3});return false;" onfocus="$hoverTab(this,true)" onblur="$hoverTab(this,false)" tabindex="{4}">{0}</a></span></span></span></td>',Web.DataView.htmlEncode(a._tabs[i]),i==a.get_categoryTabIndex()?" Selected":"",a.get_id(),i,$nextTabIndex());b.append(v)}if(!e)a._renderNoRecordsWhenNeeded(b);else{var C=a._get_template();if(C){b.appendFormat('<tr class="CategoryRow"><td valign="top" class="Fields" colspan="{0}">',a._get_colSpan());a._renderTemplate(C,b,e,g,k);b.append(w)}else{var n=a.get_categories(),l=a.get_fields(),s=a._numberOfColumns;if(s>0){b.appendFormat('<tr class="Categories"><td class="Categories" colspan="{0}"><table class="Categories"><tr class="CategoryRow">',a._get_colSpan());for(var p=0;p<s;p++){p>0&&b.append('<td class="CategorySeparator">&nbsp;</td>');b.appendFormat('<td class="CategoryColumn" valign="top" style="width:{0}%">',100/s);for(i=0;i<n.length;i++){var c=n[i];if(c.ColumnIndex==p||a._ignoreColumnIndex){if(a.get_isModal())c.Collapsed=k;b.appendFormat('<div id="{0}_Category{1}" class="Category" style="display:{2}">',a.get_id(),i,!o||o==c.Tab?q:r);var m=a._processTemplatedText(e,c.Description),t=a._formatViewText(Web.DataViewResources.Views.DefaultCategoryDescriptions[m],g,m);b.appendFormat('<table class="Category" cellpadding="0" cellspacing="0"><tr><td class="HeaderText"><span class="Text">{0}</span><a href="javascript:" class="MinMax{6}" onclick="$find(\'{2}\')._toggleCategoryVisibility({3});return false;" id="{2}$CategoryButton${3}" style="{5}"><span title="{4}"></span></a><div style="clear:both;height:1px;margin-top:-1px;"></div></td></tr><tr><td class="Description" id="{2}$CategoryDescription${3}" style="display:{7}">{1}</td></tr></table>',c.HeaderText,t,a.get_id(),i,c.Collapsed?Web.DataViewResources.Form.Maximize:Web.DataViewResources.Form.Minimize,n.length>1&&!a.get_isModal()?"":x,c.Collapsed?" Maximize":"",String.isNullOrEmpty(t)?r:q);var z=g;for(j=0;j<l.length;j++){var d=l[j];if(!d.Hidden&&d.CategoryIndex==c.Index){z=k;break}}if(!z){b.appendFormat('<table class="Fields" id="{0}$Category${1}" style="{2}"><tr class="FieldsRow"><td class="Fields" valign="top" width="100%">',a.get_id(),i,c.Collapsed?x:"");if(!String.isNullOrEmpty(c.Template))a._renderTemplate(c.Template,b,e,g,k);else for(j=0;j<l.length;j++){d=l[j];if(!d.Hidden&&d.CategoryIndex==c.Index){var A=d.Name.match(/^(_[A-Za-z_]+)\d/);b.appendFormat('<table cellpadding="0" cellspacing="0" class="FieldWrapper {0}"><tr class="FieldWrapper"><td class="Header" valign="top">',A?A[1]:d.Name);a._renderItem(b,d,e,g,k,k,g);b.appendFormat('</td><td class="Item{0}" valign="top">',E&&!d.isReadOnly()?"":" ReadOnly");a._renderItem(b,d,e,g);b.append(y)}}b.append(y)}b.append("</div>")}}b.append("</td>")}b.append(v)}else for(i=0;i<n.length;i++){c=n[i];m=a._processTemplatedText(e,c.Description);b.appendFormat('<tr class="CategoryRow" id="{2}_Category{3}" style="display:{4}"><td valign="top" class="Category"><table class="Category" cellpadding="0" cellspacing="0"><tr><td class="HeaderText">{0}</td></tr><tr><td class="Description" id="{2}$CategoryDescription${3}">{1}</td></tr></table></td><td valign="top" class="Fields">',c.HeaderText,a._formatViewText(Web.DataViewResources.Views.DefaultCategoryDescriptions[m],g,m),a.get_id(),i,!o||o==c.Tab?q:r);if(!String.isNullOrEmpty(c.Template))a._renderTemplate(c.Template,b,e,g,k);else for(j=0;j<l.length;j++){d=l[j];!d.Hidden&&d.CategoryIndex==c.Index&&a._renderItem(b,d,e,g)}b.append(w)}}}e&&a._renderActionButtons(b,"Bottom","Form")},_updateTabbedCategoryVisibility:function(){var d="Selected",a=this;if(a._tabs&&a._tabs.length>0){for(var e=a._tabs[a.get_categoryTabIndex()],b=0;b<a._tabs.length;b++){var c=a._get("_Tab",b);if(c)if(b==a.get_categoryTabIndex())Sys.UI.DomElement.addCssClass(c,d);else Sys.UI.DomElement.removeCssClass(c,d)}for(b=0;b<a._categories.length;b++){var f=a._categories[b];c=a._get("_Category",b);c&&Sys.UI.DomElement.setVisible(c,f.Tab==e)}a._updateVisibility()}a._adjustModalHeight()},_renderItem:function(b,a,l,F,W,X,D,V,z){var S=' size="{0}"',R=' style="display:block;width:90%;"',C='<input type="hidden" id="{0}_Item{1}" value="{2}"/>',Q="</table>",P='<td class="Button">&nbsp;</td><td class="Option"></td>',O='<table cellpadding="0" cellspacing="0" class="RadioButtonList">',v=true,N="AutoComplete",M='<div class="Header">&nbsp;</div>',g="",B=" checked",A="true",e=null,d=this,i=d.get_isForm()||W,c=l[a.Index];if(c!=e)c=c.toString();var m=e,s=a.ItemsStyle=="CheckBoxList",t=d.get_isEditing();if(t&&a.ItemsStyle=="CheckBox"&&a.Items.length==2){var J=a.Items[0][0],x=a.Items[1][0];if(J==A){J="false";x=A}if(c==e)c=a.Items[0][0];m=String.format('<input type="checkbox" id="{0}_Item{1}"{2} tabindex="{3}" value="{4}" onclick="this.value=this.checked?\'{6}\':\'{5}\';$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/>',d.get_id(),a.Index,x&&(c==A||c==x)?B:g,$nextTabIndex(),c,J,x)}var H=a.isReadOnly();if(i){var Y=String.format('<div class="Error" id="{0}_Item{1}_Error" style="display:none"></div>',d.get_id(),a.Index);!D&&b.appendFormat('<div class="Item {2}" id="{0}_ItemContainer{1}">',d.get_id(),a.Index,a.Name);var E=d._allFields[a.AliasIndex].HeaderText;if(m&&D){b.append(M);return}if(E.length>0)if(z&&m&&d._numberOfColumns>0)b.append(M);else b.appendFormat('<div class="Header {5}">{3}<label for="{0}_Item{1}">{2}{4}</label></div>',d.get_id(),a.Index,E,d._numberOfColumns>0||z?g:m,t&&!a.AllowNulls&&!m&&!H&&Web.DataViewResources.Form.RequiredFieldMarker?Web.DataViewResources.Form.RequiredFieldMarker:g,a.Name);if(D)return;(m==e||d._numberOfColumns>0)&&b.append('<div class="Value">')}var L=!t&&!String.isNullOrEmpty(a.ItemsDataController)&&!s&&!X&&c;L&&!i&&b.append('<table width="100%" cellpadding="0" cellspacing="0" class="ObjectRef"><tr><td>');if(t&&F&&!H){a._LEV!=e&&b.append('<table cellpadding="0" cellspacing="0"><tr><td>');!i&&m&&b.append(m);var h=a.DynamicItems?a.DynamicItems:a.Items;if(!String.isNullOrEmpty(a.ItemsStyle)&&a.ItemsStyle!="Lookup"&&a.ItemsStyle!=N&&(h.length==0&&!s)&&!String.isNullOrEmpty(a.ContextFields)){h=[];a.AllowNulls&&Array.add(h,[g,Web.DataViewResources.Data.NullValueInForms]);c!=e&&Array.add(h,[c,l[a.AliasIndex]])}else if(a.DynamicItems&&!s){for(var G=false,n=0;n<h.length;n++)if(h[n][0]==c){G=v;break}if(!G)c=e;(a.AllowNulls||!G)&&!String.isNullOrEmpty(h[0][0])&&Array.insert(h,0,[g,Web.DataViewResources.Data.NullValueInForms])}if(m!=e){if(d._numberOfColumns>0||z){b.append(m);b.appendFormat('<label for="{0}_Item{1}">{2}{3}</label>',d.get_id(),a.Index,E)}}else if(h.length>0||s)if(a.ItemsStyle=="RadioButtonList"){b.append(O);for(var o=a.Columns==0?1:a.Columns,u=Math.floor(h.length/o)+(h.length%o>0?1:0),r=0;r<u;r++){b.append("<tr>");for(var q=0;q<o;q++){var p=q*u+r;if(p<h.length){var j=h[p],k=j[0]==e?g:j[0].toString();if(c==e)c=g;b.appendFormat('<td class="Button"><input type="radio" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}" onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/></td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label></td>',d.get_id(),a.Index,p,k,k==c?B:g,d.htmlEncode(a,j[1]),$nextTabIndex())}else b.append(P)}b.append("</tr>")}b.append(Q)}else if(s){var bb=c?c.split(","):[],K=!String.isNullOrEmpty(a.ContextFields)&&!a.DynamicItems;b.appendFormat('<input type="hidden" id="{0}_Item{1}" name="{0}_Item{1}" value="{2}"/>',d.get_id(),a.Index,K?c:g);if(K)b.append(Web.DataViewResources.HeaderFilter.Loading);else{b.append(O);o=a.Columns==0?1:a.Columns;u=Math.floor(h.length/o)+(h.length%o>0?1:0);for(r=0;r<u;r++){b.append("<tr>");for(q=0;q<o;q++){p=q*u+r;if(p<h.length){j=h[p];k=j[0]==e?g:j[0].toString();if(c==e)c=g;b.appendFormat('<td class="Button"><input type="checkbox" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}"  onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/></td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label></td>',d.get_id(),a.Index,p,k,Array.indexOf(bb,k)!=-1?B:g,d.htmlEncode(a,j[1]),$nextTabIndex())}else b.append(P)}b.append("</tr>")}b.append(Q)}}else{b.appendFormat('<select id="{0}_Item{1}" size="{2}" tabindex="{3}" onchange="$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});">',d.get_id(),a.Index,a.ItemsStyle=="ListBox"?a.Rows==0?5:a.Rows:"1",$nextTabIndex());if(c==e)c=g;c=c.toString();for(n=0;n<h.length;n++){j=h[n];k=j[0];var Z=k==e&&!a.AllowNulls?Web.DataViewResources.Lookup.SelectLink:j[1];if(k==e)k=g;k=k.toString();b.appendFormat('<option value="{0}"{1}>{2}</option>',k,k==c?" selected":g,d.htmlEncode(a,Z))}b.append("</select>")}else if(!String.isNullOrEmpty(a.ItemsDataController)&&a.ItemsStyle=="Lookup"){c=l[a.AliasIndex];if(c==e)c=Web.DataViewResources.Lookup.SelectLink;var f=d._allFields[a.AliasIndex].format(c);d._renderCreateNewBegin(b,a);b.appendFormat('<table cellpadding="0" cellspacing="0" class="Lookup"><tr><td><a href="#" onclick="$find(\'{0}\').showLookup({1});return false" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{5}">{2}</a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{7}" tabindex="{6}" style="display:{8}">&nbsp;</a></td></tr></table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Item{9}" value="{2}"/>',d.get_id(),a.Index,d.htmlEncode(a,f),String.format(Web.DataViewResources.Lookup.SelectToolTip,a.Label),l[a.Index],$nextTabIndex(),$nextTabIndex(),String.format(Web.DataViewResources.Lookup.ClearToolTip,a.Label),l[a.Index]!=e?"display":"none",a.AliasIndex);d._renderCreateNewEnd(b,a)}else if(a.OnDemand)d._renderOnDemandItem(b,a,l,F,i);else if(a.Editor){var ab=a.Editor;b.appendFormat(C,d.get_id(),a.Index,Web.DataView.htmlAttributeEncode(c));b.appendFormat('<iframe src="{0}?id={1}_Item{2}&control={3}" frameborder="0" scrolling="no" id="{1}_Item{2}$Frame" class="FieldEditor {3}"></iframe>',d.resolveClientUrl(d.get_appRootPath()+"ControlHost.aspx"),d.get_id(),a.Index,ab)}else if(a.Rows>1){b.appendFormat('<textarea id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" style="',d.get_id(),a.Index,$nextTabIndex());a.TextMode==3&&!String.isNullOrEmpty(c)&&b.append("display:none;");if(!i)b.append('display:block;width:100%;"');else b.appendFormat('" cols="{0}"',a.Columns>0?a.Columns:50);b.appendFormat(' rows="{0}"',a.Rows);b.append(">");b.append(a.HtmlEncode?d.htmlEncode(a,c):c);b.append("</textarea>");a.TextMode==3&&!String.isNullOrEmpty(c)&&b.appendFormat("<div>{2}<div><a href=\"javascript:\" onclick=\"var o=$get('{0}_Item{1}');o.style.display='block';o.focus();this.parentNode.parentNode.style.display='none';return false;\">{3}</a> | <a href=\"javascript:\" onclick=\"if(!confirm('{5}'))return;$get('{0}_Item{1}').value='';this.parentNode.parentNode.parentNode.parentNode.style.display='none';return false;\">{4}</a></div></div>",d.get_id(),a.Index,d.htmlEncode(a,c).replace(/(\r\n*)/g,"<br/>"),Web.DataViewResources.Data.NoteEditLabel,Web.DataViewResources.Data.NoteDeleteLabel,Web.DataViewResources.Data.NoteDeleteConfirm)}else{o=a.Columns>0?a.Columns:50;var y=a.ItemsStyle==N;if(y&&a.Index!=a.AliasIndex){c=l[a.Index];b.appendFormat(C,d.get_id(),a.Index,Web.DataView.htmlAttributeEncode(c));a=d._allFields[a.AliasIndex]}a.TimeFmtStr&&b.append('<table cellpadding="0" cellspacing="0" class="DateTime"><tr><td class="Date">');b.appendFormat('<input type="{3}" id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',d.get_id(),a.Index,$nextTabIndex(),a.TextMode!=1?"text":"password");if(!i)b.append(R);else b.appendFormat(S,o);a.Len>0&&b.appendFormat(' maxlength="{0}"',a.Len);c=l[a.Index];if(c==e)f=y?Web.DataViewResources.Data.NullValueInForms:g;else if(a.AliasIndex!=a.Index)f=c.toString();else{if(a.DateFmtStr){if(typeof c=="string")c=Date.parseLocale(c,a.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1]);a.DataFormatString=a.DateFmtStr}f=a.format(c);if(a.DateFmtStr)a.DataFormatString=a.DataFmtStr}b.appendFormat(' value="{0}" {1}',Web.DataView.htmlAttributeEncode(f),i?' class="TextInput"':String.format('class="TextInput {0}Type"',a.Type));b.append("/>");a.Type.startsWith("DateTime")&&i&&Web.DataViewResources.Form.ShowCalendarButton&&!a.TimeFmtStr&&b.appendFormat('<a id="{0}_Item{1}_Button" href="#" onclick="return false" class="Calendar">&nbsp;</a>',d.get_id(),a.Index);if(a.TimeFmtStr){b.appendFormat('</td><td class="Time"><input type="text" id="{0}_Item$Time{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',d.get_id(),a.Index,$nextTabIndex());if(!i)b.append(R);else b.appendFormat(S,o);if(c==e)f=y?Web.DataViewResources.Data.NullValueInForms:g;else if(a.AliasIndex!=a.Index)f=c.toString();else{a.DataFormatString=a.TimeFmtStr;f=a.format(c);a.DataFormatString=a.DataFmtStr}b.appendFormat(' value="{0}" {1}/></td></table>',Web.DataView.htmlAttributeEncode(f),i?g:'class="TimeType"')}}if(a._LEV!=e){var I=d._allFields[a.AliasIndex]._LEV;if(I==e)I=g;b.appendFormat('</td><td class="UseLEV"><a href="javascript:" onclick="$find(\'{0}\')._applyLEV({1});return false" tabindex="{2}" title="{3}">&nbsp;</a></td></tr></table>',d.get_id(),a.Index,$nextTabIndex(),Web.DataView.htmlAttributeEncode(String.format(Web.DataViewResources.Data.UseLEV,d._allFields[a.AliasIndex].format(I))))}d._lastCommandName=="BatchEdit"&&b.appendFormat('<div class="BatchSelect"><table cellpadding="0" cellspacing="0"><tr><td><input type="checkbox" id="{0}$BatchSelect{1}" onclick="Web.DataView._updateBatchSelectStatus(this,{3})"/></td><td><label for="{0}$BatchSelect{1}">{2}</a></td></tr></table></div>',d.get_id(),a.Index,Web.DataViewResources.Data.BatchUpdate,i==v)}else if(a.OnDemand)d._renderOnDemandItem(b,a,l,F,i);else{c=d.htmlEncode(a,l[a.AliasIndex]);if(t)if(H){var U=l[a.Index];b.appendFormat(C,d.get_id(),a.Index,U!=e?Web.DataView.htmlAttributeEncode(d._allFields[a.AliasIndex].format(U)):g)}if(a.Items.length==0){if(a.Type=="String"&&c!=e&&c.length>Web.DataViewResources.Data.MaxReadOnlyStringLen&&a.TextMode!=3)c=c.substring(0,Web.DataViewResources.Data.MaxReadOnlyStringLen)+"...";if(c&&a.TextMode==3)c=c.replace(/(\r\n*)/g,"<br/>");f=String.isBlank(c)?i?Web.DataViewResources.Data.NullValueInForms:Web.DataViewResources.Data.NullValue:d._allFields[a.AliasIndex].format(c)}else if(s){h=c?c.split(","):[];var T=v;for(n=0;n<a.Items.length;n++){j=a.Items[n];k=j[0]==e?g:j[0].toString();if(Array.contains(h,k)){if(T)T=false;else b.append(", ");b.append(Web.DataView.htmlEncode(j[1]))}}f=h.length==0?Web.DataViewResources.Data.NullValueInForms:g}else{j=d._findItemByValue(a,a.AliasIndex==a.Index?c:l[a.Index]);f=j[1];if(!i&&f==Web.DataViewResources.Data.NullValueInForms)f=Web.DataViewResources.Data.NullValue}if(!String.isNullOrEmpty(a.HyperlinkFormatString)&&c!=e){var w=d._parseLocation(a.HyperlinkFormatString,l);if(w&&w.match(/^mailto\:/))f=String.format('<a href="{0}">{1}</a>',w,f);else f=String.format("<a href=\"javascript:\" onclick=\"$find('{2}')._navigate('{0}');\">{1}</a>",w,f,d.get_id())}if(a.TextMode==1)f="**********";if(V==v)f=String.trimLongWords(f);if(__designer()&&f)f=f.replace(/\^\w+\^/g,g);b.append(f)}if(L){!i&&b.append('</td><td align="right">');b.appendFormat('<span class="ObjectRef" title="{0}" onclick="$find(&quot;{1}&quot;).executeCommand({{commandName: &quot;_ViewDetails&quot;, commandArgument: &quot;{2}&quot;}})">&nbsp;</span>',String.format(Web.DataViewResources.Lookup.DetailsToolTip,Web.DataView.htmlAttributeEncode(d._allFields[a.AliasIndex].HeaderText)),d.get_id(),a.Name);!i&&b.append("</td></tr></table>")}if(i){(m==e||d._numberOfColumns>0)&&b.append("</div>");b.append(Y);!String.isNullOrEmpty(a.FooterText)&&b.appendFormat('<div class="Footer">{0}</div>',a.FooterText);b.append("</div>")}},_renderOnDemandItem:function(b,a,k,d,i){var f=null,g=this,c=k[a.Index],j=c!=f?c.toString().match(/^null\|(.+)$/):f,e=j!=f||c==f;if(j)c=j[1];if(e&&!d&&a.OnDemandStyle==1)b.append(i?Web.DataViewResources.Data.NullValueInForms:Web.DataViewResources.Data.NullValue);else{var h=g.resolveClientUrl(g.get_appRootPath()+Web.DataViewResources.Data.BlobHandler);d&&!e&&b.appendFormat('<a href="{0}?{1}=o|{2}" target="_blank" title="{3}">',h,a.OnDemandHandler,c,Web.DataViewResources.Data.BlobDownloadHint);if(a.OnDemandStyle==1)if(e)b.append(i?Web.DataViewResources.Data.NullValueInForms:Web.DataViewResources.Data.NullValue);else b.append(d?Web.DataViewResources.Data.BlobDownloadLink:Web.DataViewResources.Data.BlobDownloadLinkReadOnly);else if(!e)b.appendFormat('<img src="{0}?{1}=t|{2}" class="Thumbnail"/>',h,a.OnDemandHandler,c);else b.append(i?Web.DataViewResources.Data.NullValueInForms:Web.DataViewResources.Data.NullValue);d&&!e&&b.append("</a>");!a.ReadOnly&&(g.get_isEditing()&&d)&&b.appendFormat('<iframe src="{0}?{1}=u|{2}&owner={3}&index={4}" frameborder="0" scrolling="no" id="{3}_Frame{4}"></iframe><div style="display:none" id="{3}_ProgressBar{4}" class="UploadProgressBar">{5}</div>',h,a.OnDemandHandler,c,g.get_id(),a.Index,"Uploading...")}},_showUploadProgress:function(e){var b=$get(String.format("{0}_Frame{1}",this.get_id(),e)),a=$get(String.format("{0}_ProgressBar{1}",this.get_id(),e));if(b!=null&&a!=null){Sys.UI.DomElement.setVisible(a,true);var c=$common.getPaddingBox(a),d=$common.getBorderBox(a);a.style.width=b.offsetWidth-c.horizontal-d.horizontal+"px";a.style.height=b.offsetHeight-c.vertical-d.vertical+"px";Sys.UI.DomElement.setVisible(b,false)}},_internalRenderActionButtons:function(g,h,f,c){var a=this;if(!c)c=a._actionButtonsInScope(f);a._clonedRow=a._cloneChangedRow();for(var d=0;d<c.length;d++){action=c[d];if(a._isActionAvailable(action)){var b=!String.isNullOrEmpty(action.CssClass)?action.CssClass:"";if(action.HeaderText&&action.HeaderText.length>10){if(b.length>0)b+=" ";b+="AutoWidth"}var e=action.CommandName=="None";g.appendFormat('<button onclick="{6}$find(\'{0}\').executeAction(\'{5}\', {1},-1);return false;" tabindex="{3}" class="{8}{4}"{7}>{2}</button>',a.get_id(),d,action.HeaderText,$nextTabIndex(),b,f,e?"return false;":"",e?' disabled="disabled"':"",action.CssClassEx)}if(action._whenClientScript!=null)a._dynamicActionButtons=true}a._clonedRow=null},_actionButtonsInScope:function(c){var a=this.get_actions(c);if(a.length==0)return;if(c=="Row"){for(var d=false,b=0;b<a.length;b++)if(this._isActionAvailable(a[b])){d=true;break}if(!d)return null}return a},_renderActionButtons:function(b,g,f){var h=" Hidden",j=" Disabled",a=this,k=a._actionButtonsInScope(f);if(!k)return;b.appendFormat('<tr class="ActionButtonsRow {0}ButtonsRow"><td colspan="{1}" class="ActionButtons {2}ActionButtons">',g,a._get_colSpan(),f);b.append('<table style="width:100%" cellpadding="0" cellspacing="0" class="ActionButtons"><tr>');var i=String.format(' id="{0}$ActionButtons${1}"',a.get_id(),g);if(f=="Form"){var c=a._position,n=c&&c.count>1&&!a.get_isInserting(),l=c&&c.index>0,m=c&&c.index<c.count-1,e=a._get_specialAction("Print"),d=a.get_isModal()?a._get_specialAction("Annotate"):null;b.appendFormat('<td class="Left"><table class="FormNav"><tr><td class="Previous{5}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(-1);return false;" title="{3}"><span></span></a></td><td class="Next{6}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(1);return false;" title="{4}"><span></span></a></td><td class="Print{9}"><a href="javascript:" onclick="{10};return false;" title="{8}"><span></span></a></td><td class="Annotate{12}"><a href="javascript:" onclick="{13};return false;" title="{11}"><span></span></a></td><td class="Instruction" id="{0}_Wait" align="left">{1}</td></tr></table></td><td class="Right" align="right"{14}>&nbsp;',g=="Bottom"?a.get_id():"",a.get_isEditing()&&Web.DataViewResources.Form.RequiredFieldMarker?Web.DataViewResources.Form.RequiredFiledMarkerFootnote:"",a.get_id(),Web.DataViewResources.Pager.Previous,Web.DataViewResources.Pager.Next,l?"":j,m?"":j,n?"":h,e?e.text:"",e?"":h,e?e.script:null,d?d.text:"",d?"":h,d?d.script:null,i)}else b.appendFormat("<td{0}>",i);a._internalRenderActionButtons(b,g,f,k);a._lastActionButtonsScope=f;b.append("</td></tr></table>");b.append("</td></tr>")},_isActionMatched:function(a){var b=null;if(!a._csInitialized){if(!String.isNullOrEmpty(a.WhenClientScript))a._whenClientScript=this._prepareJavaScriptExpressionEx(a.WhenClientScript);a._csInitialized=true}var c=(a.WhenViewRegex==b||a.WhenViewRegex.exec(this.get_viewId())!=b==a.WhenViewRegexResult)&&(a.WhenTagRegex==b||a.WhenTagRegex.exec(this.get_tag())!=b==a.WhenTagRegexResult)&&(a.WhenHRefRegex==b||a.WhenHRefRegex.exec(location.pathname)!=b==a.WhenHRefRegexResult)&&(a._whenClientScript==b||eval(a._whenClientScript)==true);return c},_isActionAvailable:function(b,d){var h="Duplicate",g="DataSheet",a=this,c=b.WhenLastCommandName?b.WhenLastCommandName:"";if(c=="Any")c=a.get_lastCommandName();var f=b.WhenLastCommandArgument?b.WhenLastCommandArgument:"",j=c.length==0||c==a.get_lastCommandName()&&(f.length==0||f==a.get_lastCommandArgument());if(j){var e=a.get_isEditing();if(b.CommandName==g)return!e&&a.get_isGrid()&&!a.get_isTree()&&a.get_viewType()!=g;else if(b.CommandName=="Grid")return!e&&a.get_isGrid()&&!a.get_isTree()&&a.get_viewType()!="Grid";else if(e){var i=a._rowIsSelected(d==null?a._selectedRowIndex:d);return i?(c=="New"||c=="Edit"||c=="BatchEdit"||c==h)&&a._isActionMatched(b):!i&&d==null&&(c=="New"||c==h)?a._isActionMatched(b):c.length==0&&d!=null&&a._isActionMatched(b)}}return j&&(!b.WhenKeySelected||b.WhenKeySelected&&a._selectedKey&&a._selectedKey.length>0)&&a._isActionMatched(b)&&(b.CommandName!="New"||a._hasKey())},_hasKey:function(){return this._keyFields&&this._keyFields.length>0},_rowIsSelected:function(g){var a=this;if(!a._hasKey())return a.get_isModal()&&a.get_isForm();var e=a._rows[g];if(e&&a._keyFields.length==a._selectedKey.length){if(e==a._mergedRow)return true;for(var d=0;d<a._keyFields.length;d++){var f=a._keyFields[d],b=a._selectedKey[d],c=e[f.Index];if(f.Type.startsWith("DateTime")){if(!(b||c))return false;b=b.toString();c=c.toString()}if(b!=c&&!(c==null&&String.isNullOrEmpty(b)))return false}return true}else return false},_get_template:function(a){return this.get_isDataSheet()?null:$get(this.get_controller()+"_"+this.get_viewId()+(a?"_"+a:""))},_renderTemplate:function(g,c,j,l,k){var b=this,d=typeof g=="string"?g:g.innerHTML,i=/([\s\S]*?)\{([\w\d]+)(\:([\S\s]+?)){0,1}\}/g,e=0,a=i.exec(d);while(a){e=a.index+a[0].length;c.append(a[1]);var h=b.findField(a[2]);if(h)if(a[4]&&a[4].length>0)c.appendFormat("{0:"+a[4]+"}",j[h.Index]);else b._renderItem(c,h,j,l,k,null,null,null,true);else{var f=Web.DataView.find(a[2]);if(f){if(!b._embeddedViews)b._embeddedViews=[];Array.add(b._embeddedViews,{view:f});c.appendFormat('<div id="v_{0}" class="EmbeddedViewPlaceholder"></div>',f.get_cookie().replace(/-/g,""))}}a=i.exec(d)}e<d.length&&c.append(d.substring(e))},_renderNewRow:function(b){var a=this;if(a.get_isInserting()){var d=a.get_isDataSheet(),m=a._actionColumn&&!d,f=a._get_focusedCell();if(!f)f={colIndex:0};var i=d?null:a._gridTemplates.New;b.appendFormat('<tr class="Row Selected{0}{1}">',i?" InlineFormRow":"",d?" Inserting":"");var g=a.get_selectionMode()==Web.DataViewSelectionMode.Multiple;g&&b.append('<td class="Cell Toggle First">&nbsp;</td>');var k=a.get_showIcons();k&&b.appendFormat('<td class="Cell Icons{0}"><span>&nbsp;</span></td>',!g?" First":"");a.get_isDataSheet()&&b.appendFormat('<td class="Cell Gap"><div class="Icon"></div></td>',!g&&!k?" First":"");m&&b.append('<td class="Cell ActionColumn">&nbsp;</td>');var h=a._newRow?a._newRow:[];a._mergeRowUpdates(h);if(i){b.appendFormat('<td class="Cell" colspan="{0}">',a.get_fields().length);a._renderTemplate(i,b,h,true,true);b.append("</td>")}else for(var c=0;c<a._fields.length;c++){var e=a._fields[c],l=a._allFields[e.AliasIndex],j="";if(d){a._editing=f&&f.colIndex==c;if(!a._editing)j=String.format(" onclick=\"$find('{0}')._dataSheetCellFocus(event,-1,{1})\"",a.get_id(),c)}b.appendFormat('<td class="Cell {0} {1}Type{2}{3}"{4}>',l.Name,l.Type,c==0?" FirstColumn":"",c==a._fields.length-1?" LastColumn":"",j);!e.ReadOnly&&b.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"></div>',a.get_id(),e.Index);a._renderItem(b,e,h,!e.OnDemand,null);a._editing=null;b.append("</td>")}b.append("</tr>");!d&&a._renderActionButtons(b,"Bottom","Row")}},_iconClicked:function(c){var b="Attachment",a=this;if(!a.get_isDataSheet()&&a.get_lookupField()==null)if(a._icons&&a._icons[c]==b){a._lastClickedIcon=b;a.set_autoSelectFirstRow(true);a._autoSelect(c)}},_renderRows:function(b,P,o){var N=" Editing",M="Alternating",L=" Selected",K=" LastColumn",J=" FirstColumn",B="String",e="",w=" First",v=false,s=true,h=null,a=this,m=a.get_lookupField()!=h,n=a.get_isDataSheet(),A=!m&&a._actionColumn&&!n,R=A?a.get_actionGroups("ActionColumn",s):h,U=a._enumerateExpressions(Web.DynamicExpressionType.Any,Web.DynamicExpressionScope.ViewRowStyle,a.get_viewId());b.append('<tr class="HeaderRow">');var x=a.get_showIcons();if(o){b.appendFormat('<th class="Toggle First"><input type="checkbox" onclick="$find(&quot;{0}&quot;).toggleSelectedRow()" id="{0}_ToggleButton"/></th>',a.get_id());a._multipleSelection=v}x&&b.appendFormat('<th class="Icons{0}">&nbsp;&nbsp;</th>',!o?w:e);n&&b.appendFormat('<th class="Gap{0}">&nbsp;</th>',!o&&!x?w:e);A&&b.appendFormat('<th class="FieldHeaderSelector ActionColumn">{0}</th>',a._actionColumn);for(var c=0;c<a._fields.length;c++){var d=a._fields[c],p=d.Name;d=a._allFields[d.AliasIndex];if(d.Name==p)p=e;b.appendFormat('<th class="FieldHeaderSelector {4} {0} {1}Type{2}{3}"',d.Name,d.Items.length>0?B:d.Type,c==0?J:e,c==a._fields.length-1?K:e,p);(d.AllowSorting||d.AllowQBE)&&b.appendFormat(' onmouseover="$showHover(this,\'{0}$FieldHeaderSelector${1}\',\'FieldHeaderSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()"',a.get_id(),c);b.append(">");if(d.AllowSorting){b.appendFormat('<a href="#" onclick="$find(\'{0}\').sort(\'{1}\');$preventToggleHover();return false" title="{3}" onfocus="$showHover(this,\'{0}$FieldHeaderSelector${4}\',\'FieldHeaderSelector\',1)" onblur="$hideHover(this)" tabindex="{5}">{2}</a>',a.get_id(),d.Name,d.HeaderText,String.format(Web.DataViewResources.HeaderFilter.SortBy,d.HeaderText),c,$nextTabIndex());a.get_sortExpression()!=h&&a.get_sortExpression().startsWith(d.Name+" ")&&b.append(a.get_sortExpression().endsWith(" asc")?'<span class="SortUp">&nbsp;</span>':'<span class="SortDown">&nbsp;</span>');a.filterOf(d)!=h&&b.append('<span class="Filter">&nbsp;</span>')}else b.appendFormat("<span>{0}</span>",d.HeaderText);b.append("</th>")}b.append("</tr>");var g=a._get_focusedCell(),i=a.get_isEditing(),O=a.get_isInserting(),C=a._lastSelectedRowIndex;if(!a._gridTemplates){var k={Default:a._get_template(),Edit:a._get_template("edit"),New:a._get_template("new")};if(k.Default)k.Default=k.Default.innerHTML;k.Edit=k.Edit?k.Edit.innerHTML:k.Default;k.New=k.New?k.New.innerHTML:k.Default;a._gridTemplates=k}var D=n?h:a._gridTemplates.Edit,Q=n?h:a._gridTemplates.Default,l=h;a._registerRowSelectorItems();var S="onmouseover=\"Sys.UI.DomElement.addCssClass(this,'Highlight');\" onmouseout=\"Sys.UI.DomElement.removeCssClass(this,'Highlight')\"",T=a.get_showRowNumber();for(c=0;c<a.get_rows().length;c++){var t=a.get_rows()[c],F=" "+a._evaluateJavaScriptExpressions(U,t,s),f=a._rowIsSelected(c);if(f)a._selectedRowIndex=c;var u=h,E=e;if(o){var z=Array.indexOf(a._selectedKeyList,a._createRowKey(c))!=-1;if(z)a._multipleSelection=s;u=String.format('<td class="Cell Toggle First"><input type="checkbox" id="{0}_CheckBox{1}" onclick="$find(&quot;{0}&quot;).toggleSelectedRow({1})"{2} class="MultiSelect{3}"/></td>',a.get_id(),c,z?' checked="checked"':h,z?L:e);if(z)E=" MultiSelectedRow"}var y=x?String.format('<td class="Cell Icons {0}{1}"><span onclick="$find(\'{3}\')._iconClicked({4});">{2}</span></td>',a._icons?a._icons[c]:e,!o?w:e,T?a.get_pageSize()*a.get_pageIndex()+c+1+(a._pageOffset?a._pageOffset:0):"&nbsp;",a.get_id(),c):e;if(n)y+=String.format('<td class="Cell Gap{2}" onclick="$find(\'{0}\')._dataSheetCellFocus(event,{1},-1)"><div class="Icon"></div></td>',a.get_id(),c,!o&&!x?w:e);if(A)y+=a._renderActionColumnCell(t,c,f,R);if(f&&(i&&D||Q)){b.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3} Selected{7}">{5}{6}<td class="Cell" colspan="{4}">',a.get_id(),c,c%2==0?e:M," InlineFormRow",a.get_fields().length,u,y,i?N:e);a._renderTemplate(i&&D?D:Q,b,t,s,s);b.append("</td>")}else{b.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3}{4}{7}" {6}>',a.get_id(),c,c%2==0?e:M,f?L+F:F,E,P?e:" ReadOnlyRow",n&&!m?e:S,f&&i?N:e);u&&b.append(u);b.append(y);i&&f&&a._mergeRowUpdates(t);for(j=0;j<a._fields.length;j++){d=a._fields[j];var r=a._allFields[d.AliasIndex];p=d.Name==r.Name?e:d.Name;if(g)a._editing=i&&g.rowIndex==c&&g.colIndex==j;var q=j==0&&P;if(q){l=Web.HoverMonitor.Families[String.format("{0}$RowSelector${1}",a.get_id(),c)];if(!l||l.items.length==0)q=v}var G=j==0?J:e,I=String.format(" onclick=\"$find('{0}')._{3}CellFocus(event,{1},{2})\"",a.get_id(),c,j,n&&!m?"dataSheet":"gridView"),H=j==a._fields.length-1?K:e;if(q&&!m||f&&i||d.OnDemand&&f)b.appendFormat('<td class="Cell {5} {0} {1}Type{2}{4}"{3}>',r.Name,d.Items.length>0?B:r.Type,G,f&&i&&(!n||g&&g.colIndex==j)?e:I,H,p);else b.appendFormat('<td class="Cell {7} {2} {3}Type{4}{6}" style="cursor:default;"{5}>',a.get_id(),c,r.Name,r.Type=="Byte[]"?"Binary":d.Items.length>0?B:r.Type,G,I,H,p);f&&i&&!d.ReadOnly&&b.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"></div>',a.get_id(),d.Index);if(q){!m&&l&&l.items.length>1&&b.appendFormat('<div id="{0}_RowSelector{1}" class="RowSelector" onmouseover="$showHover(this, \'{0}$RowSelector${1}\', \'RowSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()">',a.get_id(),c);if(!(f&&i)){var V=m||!l||l.items.length==1?e:String.format(" onfocus=\"$showHover(this, '{0}$RowSelector${1}', 'RowSelector', 1)\" onblur=\"$hideHover(this)\" ",a.get_id(),c);if(!m)b.appendFormat('<a href="#" onclick="$hoverOver(this, 2);$find(\'{0}\').executeAction(\'Grid\',-1,{1});$preventToggleHover();return false" tabindex="{2}"{3}>',a.get_id(),c,$nextTabIndex(),V);else b.appendFormat('<a href="javascript:" onclick="return false" tabindex="{0}">',$nextTabIndex())}}a._renderItem(b,d,t,f,h,q);if(q&&!i){!(f&&i)&&b.append("</a>");!m&&l&&l.items.length>1&&b.append("</div>")}b.append("</td>");if(g)a._editing=h}}b.append("</tr>");f&&g==h&&a._renderActionButtons(b,"Bottom","Row");if(O&&C==c){C=-2;a._renderNewRow(b)}if(a._syncFocusedCell&&g&&f)g.rowIndex=c}O&&C!=-2&&a._renderNewRow(b);if(a._saveAndNew){a._saveAndNew=v;if(a._syncFocusedCell)a.newDataSheetRow();else{g=a._get_focusedCell();if(g){g.colIndex=0;a._moveFocusToNextRow(g,a.get_pageSize())}}}a._syncFocusedCell=v},_renderActionColumnCell:function(n,l,g,h){var a=this;a._clonedRow=n;if(!g){var k=a.get_lastCommandName(),j=a.get_lastCommandArgument();a.set_lastCommandName("Select");a.set_lastCommandArgument(null)}var b=new Sys.StringBuilder;b.append('<td class="Cell ActionColumn">');for(var f=true,d=0;d<h.length;d++)for(var i=h[d],e=0;e<i.Actions.length;e++){var c=i.Actions[e];if(a._isActionAvailable(c)){if(f)f=false;else b.append('<span class="Divider">&nbsp;</span>');b.appendFormat('<a href="javascript:" onclick="var dv=$find(\'{0}\');dv.executeAction(\'ActionColumn\',{2},{4},{3});return false;" class="{6}"><span class="Outer"><span class="Inner"><span class="Self" title="{5}">{1}</span></span></span></a>',a.get_id(),Web.DataView.htmlEncode(c.HeaderText),e,d,l,Web.DataView.htmlEncode(c.Description),c.CssClass)}}f&&b.append("&nbsp;");b.append("</td>");var m=b.toString();b.clear();a._clonedRow=null;if(!g){a.set_lastCommandName(k);a.set_lastCommandArgument(j)}return m},_renderGridView:function(b){var a=this;a._renderViewDescription(b);a._renderActionBar(b);a._renderSearchBar(b);if(a.get_isChart()){a._renderInfoBar(b);a._sortingDisabled=false;for(var f=false,c=0;c<a._fields.length;c++){var g=a._fields[c];if(g.Aggregate!=0)a._sortingDisabled=true;else if(!f){f=true;a.set_sortExpression(null);a.set_sortExpression(g.Name)}}b.appendFormat('<tr class="ChartRow"><td colspan="{1}" class="ChartCell"><img id="{0}$Chart" class="Chart" onload="if(this.readyState==\'complete\'){{this.style.height=\'\';_body_performResize()}}"/></td></tr>',a.get_id(),a._get_colSpan())}else{var e=a._hasKey(),d=a._selectionMode==Web.DataViewSelectionMode.Multiple&&e;if(!a.get_searchOnStart()){a._renderInfoBar(b);a._renderRows(b,e,d)}a._renderAggregates(b,d);a._renderNoRecordsWhenNeeded(b)}a._renderPager(b)},_renderAggregates:function(a,i){var e='<td class="Aggregate">&nbsp;</td>',b=this;if(b._totalRowCount==0||b.get_aggregates()==null)return;a.append('<tr class="AggregateRow">');i&&a.append(e);b.get_showIcons()&&a.append(e);b.get_isDataSheet()&&a.append(e);b._actionColumn&&a.append(e);for(var g=0;g<b.get_fields().length;g++){var c=b.get_fields()[g];if(c.Aggregate==0)a.append('<td class="None">&nbsp;</td>');else{var d=b.get_aggregates()[c.Index];if(d==null)d=Web.DataViewResources.Data.NullValue;else d=c.format(d);var f=b._allFields[c.AliasIndex],h=Web.DataViewResources.Grid.Aggregates[Web.DataViewAggregates[c.Aggregate]];a.appendFormat('<td class="Aggregate {0} {1}Type" title="',f.Name,f.Type);a.appendFormat(h.ToolTip,f.HeaderText);a.append('">');a.appendFormat(h.FmtStr,d);a.append("</td>")}}a.append("</tr>")},_renderSearchBar:function(b){var a=this;if(!a.get_showSearchBar())return;if(__tf!=4)return;a._searchBarInitialized=false;b.appendFormat('<tr class="SearchBarRow" id="{0}$SearchBar" style="{2}"><td colspan="{1}" class="SearchBarCell" id="{0}$SearchBarContent">Search bar goes here.<br/><br/><br/><br/></td></tr>',a.get_id(),a._get_colSpan(),a.get_searchBarIsVisible()?"":"display:none")},_renderNoRecordsWhenNeeded:function(c){var a=this;if(a._totalRowCount==0){var b=a.get_isDataSheet()&&a._keyFields.length>0&&a.executeActionInScope(["Row","ActionBar"],"New",null,null,true)?String.format(' <a href="javascript:" class="NewRowLink" onclick="$find(\'{0}\').newDataSheetRow();return false;" title="{2}">{1}</a>',a.get_id(),Web.DataViewResources.Grid.NewRowLink,Web.DataViewResources.Lookup.GenericNewToolTip):"";c.appendFormat('<tr class="Row NoRecords"><td colspan="{0}" class="Cell">{1}{2}</td></tr>',a._get_colSpan(),Web.DataViewResources.Data.NoRecords,b)}},_attachBehaviors:function(){var a=this;a._detachBehaviors();a._attachFieldBehaviors();var b=a.get_quickFindElement();b&&$addHandlers(b,a._quickFindHandlers,a)},_get:function(a,b){return b==null?$get(this.get_id()+a):$get(this.get_id()+a+b)},_attachFieldBehaviors:function(){var l="_AutoComplete",i="AutoComplete",d=null,b=this;if(b.get_isEditing())for(var k=0;k<b.get_fields().length;k++){var a=b.get_fields()[k],c=b._get("_Item",a.Index),e=d;if(c&&!a.ReadOnly){if(c.tagName=="TEXTAREA"&&a.Len>0){c.setAttribute("maxlength",a.Len);$addHandler(c,"keyup",b._checkMaxLengthHandler);$addHandler(c,"blur",b._checkMaxLengthHandler)}if(!String.isNullOrEmpty(a.Mask)){var f=Sys.CultureInfo.CurrentCulture,j=f.dateTimeFormat.ShortDatePattern.toUpperCase().split(f.dateTimeFormat.DateSeparator),o=$create(AjaxControlToolkit.MaskedEditBehavior,{CultureAMPMPlaceholder:f.dateTimeFormat.AMDesignator+";"+f.dateTimeFormat.PMDesignator,CultureCurrencySymbolPlaceholder:f.numberFormat.CurrencySymbol,CultureDateFormat:j[0].substring(0,1)+j[1].substring(0,1)+j[2].substring(0,1),CultureDatePlaceholder:f.dateTimeFormat.DateSeparator,CultureDecimalPlaceholder:f.numberFormat.NumberDecimalSeparator,CultureName:f.name,CultureThousandsPlaceholder:f.numberFormat.NumberGroupSeparator,CultureTimePlaceholder:f.dateTimeFormat.TimeSeparator,DisplayMoney:a.DataFormatString=="{0:c}",Mask:a.Mask,MaskType:a.MaskType,ClearMaskOnLostFocus:a.MaskType>0,id:b.get_id()+"_MaskedEdit"+a.Index},d,d,c);a.MaskType==2&&o.set_InputDirection(1);Array.add(a.Behaviors,o)}if(a.Type.startsWith("Date")){e=$create(AjaxControlToolkit.CalendarBehavior,{id:b._get("_Calendar",a.Index)},d,d,c);e.set_format((a.DateFmtStr?a.DateFmtStr:a.DataFormatString).match(/\{0:([\s\S]*?)\}/)[1]);var n=$get(c.id+"_Button");n&&e.set_button(n);if(a.TimeFmtStr){c=b._get("_Item$Time",a.Index);if(c){Array.add(a.Behaviors,e);e=$create(Web.AutoComplete,{completionInterval:500,contextKey:"",delimiterCharacters:"",id:b.get_id()+"_AutoComplete$Time"+a.Index,minimumPrefixLength:a.AutoCompletePrefixLength,typeCssClass:i},d,d,c);Sys.UI.DomElement.addCssClass(e._completionListElement,"Time");var g=Web.DataView._timeOptions;if(!g){g=[];var h=new Date;h.setHours(h.getHours(),0,0,0);while(g.length<24*2){Array.add(g,String.localeFormat("{0:"+Sys.CultureInfo.CurrentCulture.dateTimeFormat.ShortTimePattern+"}",h));h.setMinutes(h.getMinutes()+30)}Web.DataView._timeOptions=g}(e._cache=[])["%"]=g}}}else if(c.type=="text"&&a.AutoCompletePrefixLength>0)e=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0},{1},{2}",b.get_controller(),b.get_viewId(),a.Name),delimiterCharacters:",;",id:b.get_id()+l+a.Index,minimumPrefixLength:a.AutoCompletePrefixLength,serviceMethod:"GetCompletionList",servicePath:b.get_servicePath(),useContextKey:true,typeCssClass:i},d,d,c);else if(a.ItemsStyle==i){var m=b._allFields[a.AliasIndex];c=b._get("_Item",m.Index);if(c.type=="text")e=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("Field:{0},{1}",b.get_id(),m.Name),delimiterCharacters:"",id:b.get_id()+l+a.Index,minimumPrefixLength:a.AutoCompletePrefixLength==0?1:a.AutoCompletePrefixLength,serviceMethod:"GetPage",servicePath:b.get_servicePath(),useContextKey:true,fieldName:a.Name,enableCaching:false,typeCssClass:"Lookup"},d,d,c)}e&&Array.add(a.Behaviors,e)}}},_detachBehaviors:function(){var c=null,b=this,f=b.get_quickFindElement();f&&$clearHandlers(f);if(b.get_fields()!=c)for(i=0;i<b.get_fields().length;i++){var a=b.get_fields()[i];if(a.Len>0&&a.Rows>1){var d=b._get("_Item",a.Index);if(d&&d.tagName=="TEXTAREA"&&d._events){$removeHandler(d,"keyup",b._checkMaxLengthHandler);$removeHandler(d,"blur",b._checkMaxLengthHandler)}}if(a._lookupModalBehavior!=c){a._lookupModalBehavior.dispose();a._lookupModalPanel.parentNode.removeChild(a._lookupModalPanel);delete a._lookupModalPanel;a._lookupModalBehavior=c}if(a._lookupDataControllerBehavior!=c){a._lookupDataControllerBehavior.dispose();a._lookupDataControllerBehavior=c}for(var e=0;e<a.Behaviors.length;e++)a.Behaviors[e].dispose();Array.clear(a.Behaviors);if(a.Editor)Web.DataView.Editors[a.EditorId]=c}},_registerDataTypeFilterItems:function(f,h,i,e,c){for(var b=null,g=0;g<i.length;g++){var a=i[g];if(!a){if(!c.SearchOptions){b=new Web.Item(f);h.addChild(b)}}else if(!a.Hidden&&(!c.SearchOptions||Array.indexOf(c.SearchOptions,a.Function)>=0)){b=new Web.Item(f,a.Prompt?a.Text+"...":a.Text);h.addChild(b);if(a.List)this._registerDataTypeFilterItems(f,b,a.List,e,c);else if(a.Prompt)b.set_script('$find("{0}").showFieldFilter({1},"{2}","{3}")',this.get_id(),c.Index,a.Function,a.Text);else b.set_script('$find("{0}").applyFieldFilter({1},"{2}")',this.get_id(),c.Index,a.Function);if(e&&a.Function==e){var d=b;while(d){d.set_selected(true);d=d.get_parent()}}}}},_registerFieldHeaderItems:function(o,n,z,y){var h=true,m=null,c=this,A=o==m?0:o,B=o==m?c.get_fields().length-1:o,l=c.get_sortExpression();if(l)l=l.match(/^(\w+)\s+(asc|desc)/);for(var p=A;p<=B;p++){var d=m,e=[],g=n?n:String.format("{0}$FieldHeaderSelector${1}",c.get_id(),p),k=c.get_fields()[p],b=c._allFields[k.AliasIndex];if(y&&b.Aggregate!=0)continue;if(b.AllowSorting||b.AllowQBE){var s=Web.DataViewResources.HeaderFilter.GenericSortAscending,r=Web.DataViewResources.HeaderFilter.GenericSortDescending;switch(b.FilterType){case"String":s=Web.DataViewResources.HeaderFilter.StringSortAscending;r=Web.DataViewResources.HeaderFilter.StringSortDescending;break;case"Date":s=Web.DataViewResources.HeaderFilter.DateSortAscending;r=Web.DataViewResources.HeaderFilter.DateSortDescending}var t=b.AllowSorting&&!c._sortingDisabled;if(t){var w=l&&l[1]==b.Name,a=new Web.Item(g,s);if(w&&l[2]=="asc")a.set_selected(h);else a.set_cssClass("SortAscending");a.set_script('$find("{0}").sort("{1} asc")',c.get_id(),b.Name);Array.add(e,a);a=new Web.Item(g,r);if(w&&l[2]=="desc")a.set_selected(h);else a.set_cssClass("SortDescending");a.set_script('$find("{0}").sort("{1} desc")',c.get_id(),b.Name);Array.add(e,a)}if(b.AllowQBE){d=c.filterOf(b);t&&Array.add(e,new Web.Item);a=new Web.Item(g,String.format(Web.DataViewResources.HeaderFilter.ClearFilter,b.HeaderText));a.set_cssClass("FilterOff");!d&&a.set_disabled(h);a.set_script('$find("{0}").applyFilterByIndex({1},-1)',c.get_id(),k.AliasIndex);Array.add(e,a);var q=m;if(!__designer()){var v=Web.DataViewResources.Data.Filters[b.FilterType];if(b.Items.length==0){a=new Web.Item(g,v.Text);Array.add(e,a);q=c.get_fieldFilter(b,h);c._registerDataTypeFilterItems(g,a,v.List,q,b)}if(b.FilterType!="Boolean"&&(!b.SearchOptions||Array.indexOf(b.SearchOptions,"$in")>=0)){a=new Web.Item(g,Web.DataViewResources.HeaderFilter.CustomFilterOption);if(d&&d.match(/\$(in|out)\$/))a.set_selected(h);else a.set_cssClass("CustomFilter");a.set_script('$find("{0}").showCustomFilter({1})',c.get_id(),k.AliasIndex);Array.add(e,a)}}if(k._listOfValues){if(d&&d.startsWith("=")){d=d.substring(1);if(d.endsWith("\0"))d=d.substring(0,d.length-1)}for(var i=0;i<k._listOfValues.length;i++){i==0&&Array.add(e,new Web.Item);var j=k._listOfValues[i],u=false,f=j;if(j==m)f=Web.DataViewResources.HeaderFilter.EmptyValue;else if(b.Items.length>0){a=c._findItemByValue(b,j);f=a[1]}else if(b.Type=="String"&&j.length==0)f=Web.DataViewResources.HeaderFilter.BlankValue;else if(!String.isNullOrEmpty(b.DataFormatString))f=b.Type.startsWith("DateTime")?String.localeFormat("{0:d}",j):b.format(j);j=c.convertFieldValueToString(b,j);u=q=="="&&d&&j==d;if(f.length>Web.DataViewResources.HeaderFilter.MaxSampleTextLen)f=f.substring(0,Web.DataViewResources.HeaderFilter.MaxSampleTextLen)+"...";if(typeof f!="string")f=f.toString();a=new Web.Item(g,f);u&&a.set_selected(h);a.set_script("$find('{0}').applyFilterByIndex({1},{2});",c.get_id(),k.AliasIndex,i);a.set_group(1);Array.add(e,a)}}else if(!b.SearchOptions||Array.indexOf(b.SearchOptions,"=")>=0){a=new Web.Item(g,Web.DataViewResources.HeaderFilter.Loading);a.set_dynamic(h);a.set_script('$find("{0}")._loadListOfValues("{1}","{2}","{3}")',c.get_id(),g,k.Name,b.Name);Array.add(e,a)}}}if(n){a=new Web.Item(n,b.HeaderText);Array.add(z,a);for(i=0;i<e.length;i++){var x=e[i];a.addChild(x)}x.get_selected()&&a.set_selected(h);d&&a.set_selected(h)}else $registerItems(g,e,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}},_get_specialAction:function(b){if(!this._specialActions)return null;var c=this._specialActions[b+"Text"],a=this._specialActions[b+"Script"];return String.isNullOrEmpty(a)?null:{text:c,script:a}},_registerSpecialAction:function(b,d,c,e){var a=this;if(!a._specialActions.PrintText&&b.CommandName.match(/^Report/)){if(e==null&&!a._isActionAvailable(b))return;a._specialActions.PrintText=b.HeaderText;a._specialActions.PrintScript=String.format("$find('{0}').executeAction('ActionBar',{1},-1,{2})",a.get_id(),c,d)}else if(b.CssClass=="AttachIcon"){if(e==null&&!a._isActionAvailable(b))return;a._specialActions.AnnotateText=b.HeaderText;a._specialActions.AnnotateScript=String.format("$find('{0}').executeAction('ActionBar',{1},0,{2})",a.get_id(),c,d)}},_registerActionBarItems:function(){var f=null,a=this,i=a.get_actionGroups("ActionBar"),k=a.get_isChart();if(k&&!a.get_showViewSelector()){var e=String.format("{0}${1}$ActionGroup$Chart",a.get_id(),a.get_viewId()),h=[];a._registerFieldHeaderItems(f,e,h,true);$registerItems(e,h,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.None)}a._specialActions={PrintText:f,PrintScript:f,AnnotateText:f,AnnotateScript:f};for(var d=0;d<i.length;d++){var g=i[d];e=String.format("{0}${1}$ActionGroup${2}",a.get_id(),a.get_viewId(),d);if(!g.Flat){h=[];for(var b=0;b<g.Actions.length;b++){var c=g.Actions[b];if(a._isActionAvailable(c)){var j=new Web.Item(e,c.HeaderText,c.Description);j.set_cssClass(c.CssClassEx+(String.isNullOrEmpty(c.CssClass)?c.CommandName+"LargeIcon":c.CssClass));Array.add(h,j);j.set_script(String.format("$find('{0}').executeAction('ActionBar',{1},null,{2})",a.get_id(),b,d));a._registerSpecialAction(c,d,b,true)}}$registerItems(e,h,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.Inline)}else{$unregisterItems(e);for(b=0;b<g.Actions.length;b++)a._registerSpecialAction(g.Actions[b],d,b)}}Array.clear(i)},_registerViewSelectorItems:function(){var a=this;for(var c=[],d=a.get_id()+"$ViewSelector",f=0;f<a.get_views().length;f++){var b=a.get_views()[f];if(b.Type!="Form"&&b.ShowInSelector||b.Id==a.get_viewId()){var e=new Web.Item(d,b.Label);b.Id==a.get_viewId()&&e.set_selected(true);e.set_script('$find("{0}").executeCommand({{commandName:"Select",commandArgument:"{1}"}})',a.get_id(),b.Id);Array.add(c,e)}}if(a.get_isChart()){Array.add(c,new Web.Item);a._registerFieldHeaderItems(null,d,c,true)}$registerItems(d,c,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Right,Web.ItemDescriptionStyle.None)},_registerRowSelectorItems:function(){var h="{0}$RowSelector${1}",b=this,d=b.get_actions("Grid");if(d&&d.length>0)for(var a=0;a<b._rows.length;a++){for(var f=[],i=String.format(h,b.get_id(),a),e=0;e<d.length;e++){var c=d[e];if(b._isActionAvailable(c,a)){var g=new Web.Item(i,c.HeaderText,c.Description);g.set_cssClass(c.CssClassEx+(String.isNullOrEmpty(c.CssClass)?c.CommandName+"Icon":c.CssClass)+(f.length==0?" Default":""));Array.add(f,g);g.set_script(String.format('$find("{0}").executeAction("Grid", {1},{2})',b.get_id(),e,a))}}$registerItems(i,f,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}else for(a=0;a<b._rows.length;a++)$unregisterItems(String.format(h,b.get_id(),a))},_get_searchBarSettings:function(){var b=this;if(!b._searchBarSettings)b._searchBarSettings=[];var j=b._searchBarSettings[b.get_viewId()];if(!j){var q=[],h=[],m=b.get_filter();if(m.length>0&&!b.filterIsExternal())for(var c=0;c<m.length;c++){var o=m[c].match(Web.DataView._fieldFilterRegex),a=b.findField(o[1]);if(!a||b._fieldIsInExternalFilter(a))continue;var v=b._allFields[a.AliasIndex],f=o[2].match(Web.DataView._filterRegex);if(!o[2].startsWith("~")){a._renderedOnSearchBar=true;var w=b._findItemByValue(a,f[3]),e=f[3];if(e=="null")e="";var s=e.match(/^([\s\S]+?)\0?$/);if(s)e=s[1];var t=a.Items.length==0?f[1]:"$in",d=b._findFilterDefByFunction(Web.DataViewResources.Data.Filters[a.FilterType].List,a.FilterType=="Boolean"&&f[3].length>1?f[3]=="%js%true"?"$true":"$false":t);if(d){var k=e.match(/^(.+?)\$and\$(.+?)$/);Array.add(h,{Index:a.Index,Function:String.format("{0},{1}",d.Function,d.Prompt?"true":"false"),Value:k?k[1]:e,Value2:k?k[2]:""})}}}var i=false;for(c=0;c<b._allFields.length;c++){a=b._allFields[c];i=a.Search==Web.FieldSearchMode.Required||a.Search==Web.FieldSearchMode.Suggested;if(i)break}for(c=0;c<b._allFields.length;c++){var g=b._allFields[c];a=b._allFields[g.AliasIndex];if(a.AllowQBE&&a.Search!=Web.FieldSearchMode.Forbidden&&(!g.Hidden||a.Search!=Web.FieldSearchMode.Default)){var n=!i&&h.length<Web.DataViewResources.Grid.VisibleSearchBarFields||i&&(g.Search==Web.FieldSearchMode.Required||g.Search==Web.FieldSearchMode.Suggested);if(!a._renderedOnSearchBar){var l=a.Items.length==0||a.FilterType=="Boolean"?null:"$in";if(a.SearchOptions)l=a.SearchOptions[0];for(var r=Web.DataViewResources.Data.Filters[a.FilterType].List,p=0;p<r.length;p++){d=r[p];if(l==null||d.Function==l)break}var u={Index:a.Index,Function:String.format("{0},{1}",d.Function,d.Prompt?"true":"false")};(n||(b.findFieldUnderAlias(a)==a||a.VisibleOnSearchBar==null))&&Array.add(n?h:q,u);a.VisibleOnSearchBar=n}a._renderedOnSearchBar=false}}j={visibleFields:h,availableFields:q};b._searchBarSettings[b.get_viewId()]=j}return j},_toggleSearchBar:function(){var a=this;a.set_searchBarIsVisible(!a.get_searchBarIsVisible());a._updateSearchBar();if(a.get_searchBarIsVisible()){a.get_lookupField()&&a._adjustLookupSize();a._focusSearchBar()}_body_performResize()},_renderSearchBarFieldNameOptions:function(e,d,b){if(d.Search==Web.FieldSearchMode.Required)return;for(var a=0;a<b.availableFields.length;a++){var c=b.availableFields[a],f=this._allFields[c.Index];e.appendFormat('<option value="{0}">{1}</option>',a,Web.DataView.htmlEncode(f.HeaderText))}},_renderSearchBarFunctionOptions:function(i,b,f,g,d){for(var c=0;c<f.length;c++){var a=f[c];if(a)if(a.List)this._renderSearchBarFunctionOptions(i,b,a.List,g);else if(d==null||a.Function==d){var j=String.format("{0},{1}",Web.DataView.htmlAttributeEncode(a.Function),a.Prompt?"true":"false"),k=j==g.Function?' selected="selected"':"",h=String.format('<option value="{0}"{1}>{2}{3}</option>',j,k,a.Prompt?"":Web.DataViewResources.Data.Filters.Labels.Equals+" ",!a.Function.match(Web.DataView._keepCapitalization)?a.Text.toLowerCase():a.Text);if(b.SearchOptions){var e=Array.indexOf(b.SearchOptions,a.Function);if(e>=0)b.SearchOptionSet[e]=h}else i.append(h)}}},_renderSearchBarField:function(c,r,e){var q="$between",p="</select></td>",b=this,i=r.visibleFields[e],a=b._allFields[i.Index],u=a.Items.length==0||a.FilterType=="Boolean"?null:"$in",k=i.Function.match(/^(.+?),(true|false)$/);c.appendFormat('<tr id="{0}$SearchBarField${1}"><td class="Control"><select id="{0}$SearchBarName${1}" tabindex="{3}" onchange="$find(\'{0}\')._searchBarNameChanged({1})"><option value="{1}" selected="selected">{2}</option>',b.get_id(),e,Web.DataView.htmlEncode(a.HeaderText),$nextTabIndex());b._renderSearchBarFieldNameOptions(c,a,r);c.append(p);c.appendFormat('<td class="Control"><select id="{0}$SearchBarFunction${1}" class="Function" tabindex="{2}" onchange="$find(\'{0}\')._searchBarFuncChanged({1})">',b.get_id(),e,$nextTabIndex());if(a.SearchOptions)a.SearchOptionSet=[];b._renderSearchBarFunctionOptions(c,a,Web.DataViewResources.Data.Filters[a.FilterType].List,i,u);if(a.SearchOptions)for(var f=0;f<a.SearchOptionSet.length;f++)c.append(a.SearchOptionSet[f]);c.append(p);var o=a.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;</a>':"",m=k[1]=="$in"||k[1]=="$notin",d=i.Value;if(m){var h=new Sys.StringBuilder,j=!String.isNullOrEmpty(d);h.appendFormat('<table class="FilterValues{3}" cellpadding="0" cellspacing="0" onmouseover="Web.DataView.highlightFilterValues(this,true,\'Active\')" onmouseout="Web.DataView.highlightFilterValues(this,false,\'Active\')"><tr><td class="Values" valign="top"><div><a class="Link" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false;" tabindex="{4}" href="javascript:" onfocus="Web.DataView.highlightFilterValues(this,true,\'Focused\')" onblur="Web.DataView.highlightFilterValues(this,false,\'Focused\')" title="{5}">',b.get_id(),a.Index,e,j?"":" Empty",$nextTabIndex(),Web.DataViewResources.Data.Filters.Labels.FilterToolTip);if(j){var s=d.split(/\$or\$/);for(f=0;f<s.length;f++){f>0&&h.append('<span class="Highlight">, </span>');var g=s[f];if(String.isJavaScriptNull(g))g=Web.DataViewResources.HeaderFilter.EmptyValue;else{g=b.convertStringToFieldValue(a,g);var t=b._findItemByValue(a,g);g=t?t[1]:a.format(g)}h.append(g)}}else h.append(Web.DataViewResources.Lookup.SelectLink);h.appendFormat('</a></div></td><td class="Button{5}" valign="top"><a href="javascript:" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false" title="{3}" tabindex="{4}" onfocus="Web.DataView.highlightFilterValues(this,true,\'Focused\')" onblur="Web.DataView.highlightFilterValues(this,false,\'Focused\')" >&nbsp;</a></td></tr></table>',b.get_id(),j?-1:a.Index,e,j?Web.DataViewResources.Data.Filters.Labels.Clear:Web.DataViewResources.Data.Filters.Labels.FilterToolTip,$nextTabIndex(),j?" Clear":"");o=h.toString()}else if(!String.isNullOrEmpty(d))d=d.split(/\$or\$/)[0];if(k[2]=="true"){if(typeof d=="string"&&!m)d=a.format(b.convertStringToFieldValue(a,d));c.appendFormat('<td class="Control"><input id="{0}$SearchBarValue${1}" type="{6}" class="{2}" value="{3}" tabindex="{4}"/>{5}</td>',b.get_id(),e,a.FilterType,Web.DataView.htmlAttributeEncode(d=="null"?Web.DataViewResources.HeaderFilter.EmptyValue:d),$nextTabIndex(),o,m?"hidden":"text")}else c.append("<td>&nbsp;</td>");var n=$nextTabIndex();if(k[1]==q)n=$nextTabIndex();c.appendFormat('<td class="FieldAction"><a href="javascript:" tabindex="{1}" title="{2}" class="Remove" onclick="$find(\'{0}\')._searchBarNameChanged({3}, true)"><span></span</a></td>',b.get_id(),n,Web.DataViewResources.Grid.RemoveCondition,e);c.append("</tr>");if(a.FilterType!="Text"&&k[1]==q){var l=i.Value2;if(typeof l=="string")l=a.format(b.convertStringToFieldValue(a,l));c.appendFormat('<tr><td colspan="2" class="Control AndLabel">{4}</td><td><input id="{0}$SearchBarValue2${1}" type="Text" class="{2}" value="{3}" tabindex="{5}"/>{6}</td><td>&nbsp;</td></tr>',b.get_id(),e,a.FilterType,Web.DataView.htmlAttributeEncode(l),Web.DataViewResources.Data.Filters.Labels.And,n-1,o)}},_focusSearchBar:function(a){var f="Function",d=this,e=a!=null;if(!e)a=0;var c=d._get_searchBarControl(f,a);if(!c){a=0;c=d._get_searchBarControl(f,0)}var b=d._get_searchBarControl("Value",a);if(b)if(b.type=="hidden"){var g=b.parentNode.getElementsByTagName("a")[0];g.focus();e&&d._searchBarVisibleIndex==null&&String.isNullOrEmpty(b.value)&&g.click()}else Sys.UI.DomElement.setFocus(b);else c&&c.focus()},_searchBarNameChanged:function(b,g){var c=this;c._saveSearchBarSettings();var a=c._get_searchBarSettings(),e=a.visibleFields[b];if(!g){var f=c._get_searchBarControl("Name",b),d=parseInt(f.value);a.visibleFields[b]=a.availableFields[d];Array.removeAt(a.availableFields,d)}else Array.removeAt(a.visibleFields,b);Array.insert(a.availableFields,0,e);c._renderSearchBarControls(true);c._focusSearchBar(b)},_searchBarFuncChanged:function(b){var a=this;a._saveSearchBarSettings();var e=a._get_searchBarSettings(),c=e.visibleFields[b],d=a._get_searchBarControl("Function",b);c.Function=d.value;a._renderSearchBarControls(true);a._focusSearchBar(b)},_searchBarAddField:function(){var b=this;b._saveSearchBarSettings();var a=b._get_searchBarSettings();Array.add(a.visibleFields,a.availableFields[0]);Array.removeAt(a.availableFields,0);b._renderSearchBarControls(true);b._focusSearchBar(a.visibleFields.length-1)},_createSearchBarFilter:function(n){var q="DateTime",k=false,a=this;for(var s=Array.clone(a._filter),m=a._get_searchBarSettings(),h=[],g=true,b=0;b<m.visibleFields.length;b++){var l=m.visibleFields[b],c=a._allFields[l.Index];a.removeFromFilter(c);var d=l.Function.match(/^(.+?),(true|false)$/),o=[];if(d[2]=="true"){var f=a._get_searchBarControl("Value",b),e=a._get_searchBarControl("Value2",b);if(String.isBlank(f.value)&&(!e||String.isBlank(e.value))&&c.Search!=Web.FieldSearchMode.Required)continue;if(d[1]=="$in"||d[1]=="$notin"){Array.add(h,{Index:c.Index,Function:d[1],Values:[f.value]});continue}if(String.isBlank(f.value)){if(n)continue;else{alert(Web.DataViewResources.Validator.RequiredField);Sys.UI.DomElement.setFocus(f);g=k}break}var j={NewValue:f.value.trim()},i=a._validateFieldValueFormat(c,j);if(i)if(n)continue;else{alert(i);Sys.UI.DomElement.setFocus(f);g=k;break}else Array.add(o,c.Type.startsWith(q)?f.value.trim():j.NewValue);if(d[1]=="$between"){if(String.isBlank(e.value)){if(n)continue;else{alert(Web.DataViewResources.Validator.RequiredField);Sys.UI.DomElement.setFocus(e);g=k}break}j={NewValue:e.value.trim()};i=a._validateFieldValueFormat(c,j);if(i)if(n)continue;else{alert(i);Sys.UI.DomElement.setFocus(e);g=k;break}else Array.add(o,c.Type.startsWith(q)?e.value.trim():j.NewValue)}Array.add(h,{Index:c.Index,Function:d[1],Values:o})}else Array.add(h,{Index:c.Index,Function:d[1],Values:null})}if(!g)return null;for(b=0;b<m.availableFields.length;b++){l=m.availableFields[b];c=a._allFields[l.Index];a.removeFromFilter(c)}for(b=0;b<h.length;b++){var p=h[b];a.applyFieldFilter(p.Index,p.Function,p.Values,true)}var r=a._filter;a._filter=s;return r},_performSearch:function(){var a=this;if(a._isBusy)return;a._saveSearchBarSettings();var b=a._createSearchBarFilter(false);if(b){a.set_filter(b);a.refreshData();a._setFocusOnSearchBar=true}a._forgetSelectedRow(true)},_resetSearchBar:function(){var a=this;a._searchBarSettings[a.get_viewId()]=null;a._renderSearchBarControls(true);a._focusSearchBar()},_get_searchBarControl:function(b,a){return $get(String.format("{0}$SearchBar{1}${2}",this.get_id(),b,a))},_saveSearchBarSettings:function(){var a=this;for(var e=a._get_searchBarSettings(),b=0;b<e.visibleFields.length;b++){var c=e.visibleFields[b],g=a._get_searchBarControl("Function",b),d=a._get_searchBarControl("Value",b),f=a._get_searchBarControl("Value2",b);c.Function=g.value;if(d){d.value==Web.DataViewResources.HeaderFilter.EmptyValue?"null":d.value;c.Value=a._formatSearchField(d,c.Index)}if(f)c.Value2=a._formatSearchField(f,c.Index)}},_formatSearchField:function(b,e){var a=this._allFields[e];if(a.Type.startsWith("Date")){var c=Date.tryParseFuzzyDate(b.value,a.DataFormatString);if(c!=null)b.value=a.format(c)}else if(a.Type!="String"){var d=Number.tryParse(b.value,a.DataFormatString);if(d!=null)b.value=a.format(d)}return b.value},_renderSearchBarControls:function(p){var j="SearchBar",a=this;if(a._searchBarInitialized&&!p)return;var o=$get(a.get_id()+"$SearchBarContent");a._searchBarInitialized=true;var c=new Sys.StringBuilder;c.append('<table class="SearchBarFrame">');for(var e=a._get_searchBarSettings(),b=0;b<e.visibleFields.length;b++)a._renderSearchBarField(c,e,b);e.availableFields.length>0&&c.appendFormat('<tr><td colspan="3" class="AddConditionText"><a href="javascript:" onclick="$find(\'{0}\')._searchBarAddField();return false;">{3}</a></td><td class="FieldAction"><a href="javascript:" class="Add" tabindex="{1}" title="{2}" onclick="$find(\'{0}\')._searchBarAddField();return false;"><span></span></a></td>',a.get_id(),$nextTabIndex(),Web.DataViewResources.Grid.AddCondition,Web.DataViewResources.Grid.AddConditionText);c.appendFormat('<tr><td><div id="{0}$SearchBarNameStub" class="Stub"></div></td><td><div id="{0}$SearchBarFuncStub" class="Stub"></div></td><td></td></tr>',a.get_id());c.append("</table>");c.appendFormat('<div class="SearchButtons"><button onclick="$find(\'{0}\')._performSearch();return false" tabindex="{3}">{1}</button><br/><button onclick="$find(\'{0}\')._resetSearchBar();return false" tabindex="{4}">{2}</button></div>',a.get_id(),Web.DataViewResources.Grid.PerformAdvancedSearch,Web.DataViewResources.Grid.ResetAdvancedSearch,$nextTabIndex(),$nextTabIndex());o.innerHTML=c.toString();c.clear();var f=$get(a.get_id()+"$SearchBarNameStub");f.style.width=f.offsetWidth+"px";f=$get(a.get_id()+"$SearchBarFuncStub");f.style.width=f.offsetWidth+"px";var l=o.getElementsByTagName("select");for(b=0;b<l.length;b++)l[b].style.width="100%";if(!a._searchBarExtenders)a._searchBarExtenders=[];for(b=0;b<e.visibleFields.length;b++){var k=e.visibleFields[b],n=a._allFields[k.Index],h=a._get_searchBarControl("Value",b);if(h)if(k.Function.match(/\$(in|notin),/)==null){var g=a._createFieldInputExtender(j,n,h,b);g&&Array.add(a._searchBarExtenders,g)}else{var d=h;while(d&&d.tagName!="TR")d=d.parentNode;for(var i=0;i<d.childNodes.length;i++)d.childNodes[i].vAlign="top"}var m=a._get_searchBarControl("Value2",b);if(m){g=a._createFieldInputExtender(j,n,m,b+"$2");g&&Array.add(a._searchBarExtenders,g)}}},_updateSearchBar:function(){var g="WithSearchBar",f="Activated",a=this,d=$get(a.get_id()+"$SearchBar");if(!d)return;var b=a.get_searchBarIsVisible(),c=$get(a.get_id()+"$SearchBarActivator");if(c)if(b)Sys.UI.DomElement.addCssClass(c,f);else Sys.UI.DomElement.removeCssClass(c,f);Sys.UI.DomElement.setVisible(d,b);b&&a._renderSearchBarControls(d);if(c){Sys.UI.DomElement.setVisible(a._get("$QuickFind"),!b);$get(a.get_id()+"$SearchToggle").title=a.get_searchBarIsVisible()?Web.DataViewResources.Grid.HideAdvancedSearch:Web.DataViewResources.Grid.ShowAdvancedSearch}var e=a._get("$InfoRow");if(e)if(b)Sys.UI.DomElement.addCssClass(e,g);else Sys.UI.DomElement.removeCssClass(e,g);if(a._setFocusOnSearchBar){a._setFocusOnSearchBar=false;a._focusSearchBar()}},_renderSearchBarActivator:function(b){var a=this;if(!a.get_showSearchBar()||!a.get_showQuickFind()&&a.get_searchOnStart())return;b.appendFormat('<td class="SearchBarActivator" id="{0}$SearchBarActivator"><a href="javascript:" onclick="$find(\'{0}\')._toggleSearchBar();return false;" id="{0}$SearchToggle"><span></span></a></td>',a.get_id(),$nextTabIndex());!a.get_showQuickFind()&&b.append('<td class="Divider"><div></div></td>')},_internalRenderActionBar:function(c){var j='<td class="Divider"><div></div></td>',a=this,h=a.get_actionGroups("ActionBar");c.append('<table cellpadding="0" cellspacing="0" class="Groups"><tr>');var l=a.get_isGrid();l&&a._renderSearchBarActivator(c);if(l&&a.get_showQuickFind()){var m=a.get_quickFindText();c.appendFormat('<td class="QuickFind" title="{2}" id="{0}$QuickFind"><div class="QuickFind"><table cellpadding="0" cellspacing="0"><tr><td><input type="text" id="{0}_QuickFind" value="{1}" class="{3}" tabindex="{4}"/></td><td class="Button"><a href="#" onclick="$find(\'{0}\').quickFind();return false;"><span>&nbsp;</span></a></td></tr></table></div></td>',a.get_id(),Web.DataView.htmlAttributeEncode(m),Web.DataViewResources.Grid.QuickFindToolTip,m==Web.DataViewResources.Grid.QuickFindText?"Empty":"NonEmpty",$nextTabIndex());c.append(j);a.get_lookupField()&&!String.isNullOrEmpty(a.get_lookupField().ItemsNewDataView)&&c.appendFormat('<td class="QuickCreateNew"><a href="javascript:" onclick="$find(\'{0}\').closeLookupAndCreateNew();return false;" class="CreateNew" title="{1}" tabindex="{2}><span class="Placeholder"></span></a></td>',a.get_id(),Web.DataViewResources.Lookup.GenericNewToolTip,$nextTabIndex())}else(h.length==0||a.get_lookupField())&&c.append('<td class="Divider"><div style="visibility:hidden"></div></td>');if(!a.get_lookupField()){a._registerActionBarItems();var i=a.get_isChart()&&!a.get_showViewSelector();i&&c.appendFormat('<td class="Group Main" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{3}" onclick="$hoverOver(this, 2);return false;">{2}</a></span></td>',a.get_id(),a.get_viewId(),Web.DataView.htmlEncode(a.get_view().Label),$nextTabIndex());for(var f=0;f<h.length;f++){(f>0||i)&&c.append(j);var e=h[f];if(e.Flat){for(var g=-1,k=-1,d=0;d<e.Actions.length;d++){var b=e.Actions[d];b._isAvailable=a._isActionAvailable(b)&&!String.isNullOrEmpty(b.HeaderText);b._isFirst=false;b._isLast=false;if(b._isAvailable){if(g==-1)g=d;k=d}}if(g>=0){e.Actions[g]._isFirst=true;e.Actions[k]._isLast=true}for(d=0;d<e.Actions.length;d++){b=e.Actions[d];b._isAvailable&&c.appendFormat('<td class="{7}Group FlatGroup{6}{8}{9}" onmouseover="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="if(this._skip)this._skip=null;else $find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2})"><span class="Outer">{5}<a href="javascript:" tabindex="{4}" onclick="this.parentNode.parentNode._skip=true;$find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2});return false;" onfocus="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" >{3}</a></span></td>',a.get_id(),d,f,Web.DataView.htmlEncode(b.HeaderText),$nextTabIndex(),!String.isNullOrEmpty(b.CssClass)?String.format('<span class="FlatGroupIcon {0}">&nbsp;</span>',b.CssClass):"",!String.isNullOrEmpty(b.CssClass)?" FlatGroupWithIcon":"",b.CssClassEx,b._isFirst?" First":"",b._isLast?" Last":"")}}else c.appendFormat('<td class="{5}Group" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{4}" onclick="$hoverOver(this, 2);return false;">{3}</a></span></td>',a.get_id(),a.get_viewId(),f,e.HeaderText,$nextTabIndex(),e.CssClassEx)}}c.append("</tr></table>")},_renderActionBar:function(b){var c="</td></tr></table>",a=this;if(!a.get_showActionBar()){a._registerActionBarItems();return}b.appendFormat('<tr class="ActionRow"><td colspan="{0}"  class="ActionBar">',a._get_colSpan());b.appendFormat('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="width:100%" id="{0}$ActionBar">',a.get_id());a._internalRenderActionBar(b);a._registerViewSelectorItems();b.append('</td><td class="ViewSelectorControl">');if(a.get_showViewSelector()){b.appendFormat('<table cellpadding="0" cellspacing="0"><tr><td class="ViewSelectorLabel">{0}:</td><td>',Web.DataViewResources.ActionBar.View);b.appendFormat('<span class="ViewSelector" onmouseover="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><span class="Inner"><a href="javascript:" class="Link" tabindex="{2}" onfocus="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;,3)" onblur="$hideHover(this)">{1}</a></span></span></span>',a.get_id(),Web.DataView.htmlEncode(a.get_view().Label),$nextTabIndex());b.append(c)}b.append(c);b.append("</td></tr>")},get_statusBar:function(){return this._statusBar},_renderStatusBar:function(a){a.appendFormat('<tr class="StatusBarRow" style="display:none"><td colspan="{1}" class="StatusBar" id="{0}$StatusBar"></td></tr>',this.get_id(),this._get_colSpan())},_updateStatusBar:function(){var q="ToCurrent",f=this,m=f.get_statusBar();if(!String.isNullOrEmpty(m)){var k=f._get("$StatusBar");if(k){var d=null,p=f.fieldValue("Status");if(!p)p="null";var e=/((\w+)\.)?((\w+)\.)?Status:\s*(.+?)\s*\n\s*(((.+?)\s*>\s*)+)/g,c=e.exec(m);while(c){if(c[5]==p&&(String.isNullOrEmpty(c[2])||c[2]==f.get_controller())&&(String.isNullOrEmpty(c[3])||c[4]==f.get_viewId())){e=/(\[)?\s*(.+?)\s*(\])?\s*>\s*/g;var b=[],g=e.exec(c[6]);while(g){Array.add(b,{Text:g[2],Current:g[1]=="["&&g[3]=="]"});g=e.exec(c[6])}if(b.length>0&&!(__tf!=4)){d=new Sys.StringBuilder('<ul class="StatusBar">');for(var o=false,n=true,a=0;a<b.length;a++)if(b[a].Current){o=true;n=false;break}for(a=0;a<b.length;a++){var i=b[a],j=i.Current?"Current":o?"Past":n?"Future":"",l=a<b.length-1?b[a+1]:null,h="";if(l)if(l.Current)h=j+q;else if(i.Current)if(l.Current)h=j+q;else h=j+"ToFuture";if(i.Current){o=false;n=true}d.appendFormat('<li class="Segment {1}{2}{3} {4}"><span class="Outer"><span class="Inner"><span class="Self">{0}</span></span></span></li>',Web.DataView.htmlEncode(i.Text),j,a==0?" First":"",a==b.length-1?" Last":"",h)}d.append("</ul>")}break}c=e.exec(m)}if(d)k.innerHTML=d.toString();Sys.UI.DomElement.setVisible(k.parentNode,d!=null)}}},filterByFirstLetter:function(d){var a=this,b=a._firstLetters[0],c=a._firstLetters[d];a.applyFieldFilter(a.findField(b).Index,"$beginswith",[c])},_renderViewDescription:function(c){var j="</div>",o=" Selected",g=null,a=this,p=a._firstLetters&&a._firstLetters.length>2,i=a.get_showDescription();if(!i&&!p)return;var f=i?a.get_description():"",h=g;if(p){var e=new Sys.StringBuilder;e.append('<div class="Letters">');for(var l=a.findField(a._firstLetters[0]),n=g,b=0;b<a._filter.length;b++){var d=a._filter[b].match(Web.DataView._fieldFilterRegex);if(d&&d[1]==l.Name){d=d[2].match(/^\$beginswith\$(.+?)\0$/);if(d)n=a.convertStringToFieldValue(l,d[1]);break}}var s=String.format("{0} {1} ",Web.DataView.htmlAttributeEncode(l.Label),Web.DataViewResources.Data.Filters.Text.List[2].Text.toLowerCase());for(b=1;b<a._firstLetters.length;b++){var k=a._firstLetters[b];e.appendFormat('<a href="javascript:" onclick="$find(\'{0}\').filterByFirstLetter({1});return false;" class="Letter{5}" title="{3}{4}">{2}</a> ',a.get_id(),b,k,s,Web.DataView.htmlAttributeEncode(k),n==k?o:"")}e.append(j);h=e.toString();e.clear()}if(i&&String.isNullOrEmpty(f))f=a.get_view().HeaderText;var r=a.get_isTree();if(!String.isNullOrEmpty(f)||a.get_lookupField()||r||h){c.appendFormat('<tr class="HeaderTextRow"><td colspan="{0}" class="HeaderText">',a._get_colSpan());a.get_lookupField()!=g&&c.append('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="padding:0px">');c.appendFormat('<div id="{0}$HeaderText">',a.get_id());c.append(a._formatViewText(Web.DataViewResources.Views.DefaultDescriptions[f],true,f));c.append(j);h&&c.append(h);a.get_lookupField()!=g&&c.appendFormat('</td><td align="right" style="padding:0px"><a href="javascript:" class="Close" onclick="$find(\'{0}\').hideLookup();return false" tabindex="{2}" title="{1}">&nbsp;</a></td></tr></table>',a.get_id(),Web.DataViewResources.ModalPopup.Close,$nextTabIndex());if(r){var m=a.get_path();c.append('<div class="Path">');c.appendFormat('<a href="javascript:" onclick="return false" class="Toggle" title="{1}"><span>&nbsp;</span></a>',a.get_id(),Web.DataView.htmlAttributeEncode(Web.DataViewResources.Grid.FlatTreeToggle));for(b=0;b<m.length;b++){var q=m[b];c.appendFormat('<span class="Divider"></span><a href="javascript:" class="Node{4}" onclick="$find(\'{0}\').drillIn({1})" title="{3}">{2}</a>',a.get_id(),b,Web.DataView.htmlEncode(q.text),Web.DataView.htmlAttributeEncode(String.format(Web.DataViewResources.Lookup.SelectToolTip,'"'+q.text+'"')),b==m.length-1?o:"")}c.append(j)}c.append("</td></tr>")}},_renderInfoBar:function(c){var a=this,d=a.get_filter();if(d.length>0&&!a.filterIsExternal()){var b=new Sys.StringBuilder;a.get_viewType()!="Form"&&a._renderFilterDetails(b,d);if(a.get_viewType()!="Form"&&!b.isEmpty()){c.appendFormat('<tr class="InfoRow {2}" id="{0}$InfoRow"><td colspan="{1}">',a.get_id(),a._get_colSpan(),a.get_viewType());c.append(b.toString());c.append("</td></tr>")}b.clear()}},_findFilterDefByFunction:function(d,a){if(a.endsWith("$"))a=a.substring(0,a.length-1);for(var c=0;c<d.length;c++){var b=d[c];if(b)if(b.List){var e=this._findFilterDefByFunction(b.List,a);if(e)return e}else if(b.Function==a)return b}return null},_renderFilterDetails:function(b,o){var p="<b>{0}</b>",d=this;for(var m=false,n=true,l=0;l<o.length;l++){var j=o[l].match(Web.DataView._fieldFilterRegex),a=d.findField(j[1]),q=a&&a.ItemsDataController==d.get_controller()&&d.get_isTree()&&n;if(q)n=false;if(!a||d._fieldIsInExternalFilter(a)||q)continue;if(!m){b.appendFormat('<a href="javascript:" onclick="$find(\'{0}\').clearFilter();return false" class="Close" tabindex="{3}" title="{2}">&nbsp;</a><span class="Details"><span class="Information">&nbsp;</span>{1} ',d.get_id(),Web.DataViewResources.InfoBar.FilterApplied,Web.DataViewResources.ModalPopup.Close,$nextTabIndex());m=true}var s=d._allFields[a.AliasIndex],e=Web.DataView._filterIteratorRegex.exec(j[2]),k=true;while(e&&!(a.Index==a.AliasIndex&&a.IsPrimaryKey&&a.Hidden)){if(!k)b.append(", ");else b.appendFormat('<span class="FilterElement" onclick="$find(\'{0}\').removeFromFilterByIndex({1})" title="{2}">',d.get_id(),a.Index,Web.DataView.htmlAttributeEncode(String.format(Web.DataViewResources.HeaderFilter.ClearFilter,a.Label)));if(e[1].startsWith("~"))b.appendFormat(String.format('{0} <b class="String">{1}</b>',Web.DataViewResources.InfoBar.QuickFind,d.convertStringToFieldValue(a,e[3])));else{b.appendFormat('<span class="Highlight">{0}</span>',s.HeaderText);var h=d._findFilterDefByFunction(Web.DataViewResources.Data.Filters[a.FilterType].List,a.FilterType=="Boolean"&&e[3].length>1?e[3]=="%js%true"?"$true":"$false":e[1]);if(!h){switch(e[1]){case"=":b.append(String.isJavaScriptNull(e[2])?Web.DataViewResources.InfoBar.Empty:Web.DataViewResources.InfoBar.EqualTo);break;case"<":b.append(Web.DataViewResources.InfoBar.LessThan);break;case"<=":b.append(Web.DataViewResources.InfoBar.LessThanOrEqual);break;case">":b.append(Web.DataViewResources.InfoBar.GreaterThan);break;case">=":b.append(Web.DataViewResources.InfoBar.GreaterThanOrEqual);break;case"*":b.append(e[2].startsWith("%")?Web.DataViewResources.InfoBar.Like:Web.DataViewResources.InfoBar.StartsWith)}var f=d._findItemByValue(a,d.convertStringToFieldValue(a,e[3])),c=f==null?e[3]:f[1];if(String.isJavaScriptNull(e[3])||String.isBlank(c))c=Web.DataViewResources.InfoBar.Empty;else c=d.convertStringToFieldValue(a,c);b.appendFormat(p,String.htmlEncode(c))}else if(h.Prompt){b.appendFormat(" {0} ",h.Text.toLowerCase());c=e[3];var g=c.split(Web.DataView._listRegex);if(String.isJavaScriptNull(g[0]))g[0]=Web.DataViewResources.InfoBar.Empty;if(!String.isJavaScriptNull(e[2])){var r=g[0].match(/^([\s\S]+?)\0?$/);if(r)g[0]=r[1];c=d.convertStringToFieldValue(a,g[0]);f=d._findItemByValue(a,c);b.appendFormat(p,String.htmlEncode(f?f[1]:a.format(c)));for(var i=1;i<g.length;i++){b.appendFormat("{0} ",e[1]=="$between$"?" "+Web.DataViewResources.Data.Filters.Labels.And:", ");c=d.convertStringToFieldValue(a,g[i]);if(c==null)c=Web.DataViewResources.HeaderFilter.EmptyValue;else{f=d._findItemByValue(a,c);c=f?f[1]:a.format(c)}b.appendFormat('<b class="{1}">{0}</b>',String.htmlEncode(c));if(i>5){b.append(", ..");break}}}}else b.appendFormat(" {0} <b>{1}</b>",Web.DataViewResources.Data.Filters.Labels.Equals,h.Function.match(Web.DataView._keepCapitalization)?h.Text:h.Text.toLowerCase())}e=Web.DataView._filterIteratorRegex.exec(j[2]);k=false}!k&&b.append(".");b.append("</span> ")}b.append("</span>")},_findItemByValue:function(c,b){var a=null;if(c.Items.length==0)return a;b=b==a?"":b.toString();for(var e=0;e<c.Items.length;e++){var d=c.Items[e],f=d[0]==a?"":d[0].toString();if(f==b)return d}return[a,this.get_isForm()?Web.DataViewResources.Data.NullValueInForms:Web.DataViewResources.Data.NullValue]},_renderPager:function(b){var l='<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{2}">...</a>',k='<span class="Disabled">{0}</span>',g='<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}</a>',a=this,n=a.get_isChart();b.appendFormat('<tr class="FooterRow" style="{1}"><td colspan="{0}" class="Footer"><table cellpadding="0" cellspacing="0" style="width:100%"><tr><td align="left" class="Pager PageButtons{2}">',a._get_colSpan(),a.get_showPager()?"":"display:none",n?" Print":"");var e=a.get_pageCount(),d=a.get_pageSize();if(n){e=1;d=a._totalRowCount;var h=a._get_specialAction("Print");h&&b.appendFormat('<a href="javascript:" onclick="{1};return false;" title="{0}" class="Print"><span></span></a></td><td>',h.text,h.script)}if(e>1){var c=a._firstPageButtonIndex,m=Web.DataViewResources.Pager.PageButtonCount;if(a.get_pageIndex()>0)b.appendFormat(g,a.get_pageIndex()-1,a.get_id(),Web.DataViewResources.Pager.Previous,$nextTabIndex());else b.appendFormat(k,Web.DataViewResources.Pager.Previous);b.appendFormat(" | {0}: ",Web.DataViewResources.Pager.Page);c>0&&b.appendFormat(l,c-1,a.get_id(),$nextTabIndex());while(m>0&&c<e){if(c==a.get_pageIndex())b.appendFormat('<span class="Selected">{0}</span>',c+1);else b.appendFormat(g,c,a.get_id(),c+1,$nextTabIndex());c++;m--}c<=e-1&&b.appendFormat(l,a._firstPageButtonIndex+Web.DataViewResources.Pager.PageButtonCount,a.get_id(),$nextTabIndex());b.append(" | ");if(a.get_pageIndex()<e-1)b.appendFormat(g,a.get_pageIndex()+1,a.get_id(),Web.DataViewResources.Pager.Next,$nextTabIndex());else b.appendFormat(k,Web.DataViewResources.Pager.Next)}b.append('</td><td align="right" class="Pager PageSize">&nbsp;');var j=a._pageSizes;if(a._totalRowCount>d){b.append(Web.DataViewResources.Pager.ItemsPerPage);for(i=0;i<j.length;i++){i>0&&b.append(", ");if(d==j[i])b.appendFormat("<b>{0}</b>",d);else b.appendFormat('<a href="#" onclick="$find(\'{0}\').set_pageSize({1},true);return false" tabindex="{2}">{1}</a>',a.get_id(),j[i],$nextTabIndex())}b.append(" | ")}if(a._totalRowCount>0){var f=(a.get_pageIndex()+1)*d;if(f>a._totalRowCount)f=a._totalRowCount;b.appendFormat(Web.DataViewResources.Pager.ShowingItems,a.get_pageIndex()*d+1,f,a._totalRowCount);if(a._selectionMode==Web.DataViewSelectionMode.Multiple){b.appendFormat('<span id="{0}$SelectionInfo">',a.get_id());a._selectedKeyList.length>0&&b.appendFormat(Web.DataViewResources.Pager.SelectionInfo,a._selectedKeyList.length);b.append("</span>")}b.append(" | ")}b.appendFormat('</td><td align="center" class="Pager Refresh" id="{0}_Wait">',a.get_id());!a.get_searchOnStart()&&b.appendFormat('<a href="#" onclick="$find(\'{0}\').refreshAndResize();return false" tabindex="{2}" title="{1}"><span>&nbsp;</span></a>',a.get_id(),Web.DataViewResources.Pager.Refresh,$nextTabIndex());b.append("</td></tr></table>");b.append("</td></tr>")},refreshAndResize:function(){this.cancelDataSheetEdit();this.goToPage(-1);delete this._viewColumnSettings},refreshData:function(){this.set_pageIndex(-2);this._loadPage()},_dittoCollectedValues:function(e,f){if(this.get_isEditing()){for(var g=f?new RegExp(String.format("^{0}(Length|ContentType|FileName|FullFileName)?$",f)):null,h=this._collectFieldValues(true),c=[],b=0;b<h.length;b++){var a=h[b];(!g||!a.Name.match(g))&&Array.add(c,{name:a.Name,value:a.Modified?a.NewValue:a.OldValue})}if(e)for(b=0;b<e.length;b++){a=e[b];for(var d=0;d<c.length;d++){var i=a.Name?a.Name:a.name;if(c[d].name==i){Array.removeAt(c,d);break}}Array.add(c,a.Name?{name:a.Name,value:a.NewValue}:a)}this._ditto=c}},refresh:function(d,c,b){var a=this;a._dittoCollectedValues(c,b);a._lastSelectedCategoryTabIndex=a.get_categoryTabIndex();if(d)a._render();else a.goToView(a.get_viewId())},_cname:function(b){var a=this.get_viewId();if(a==null)a="grid1";return String.format("{0}${1}${2}",this._id,a,b)},readContext:function(a){return Web.PageState.read(this._cname(a))},writeContext:function(b,a){Web.PageState.write(this._cname(b),a)},_saveViewVitals:function(){var a=this;a.writeContext("vitals",{PageIndex:a.get_pageIndex(),PageSize:a.get_pageSize(),Filter:a.get_filter(),SortExpression:a.get_sortExpression(),Tag:a.get_tag()})},_restoreViewVitals:function(a){var c=this;if(a.PageIndex>=0)return;var b=c.readContext("vitals");if(b==null)return;a.RequiresRowCount=true;a.RequiresMetaData=true;if(a.PageIndex==-1&&b.Filter&&a.Filter){a.Tag=b.Tag;a.PageIndex=b.PageIndex;a.PageSize=b.PageSize;if(a.FilterIsExternal){for(var h=a.Filter,e=0;e<b.Filter.length;e++){for(var d=b.Filter[e],k=d.substring(0,d.indexOf(":")),j=false,f=0;f<a.Filter.length;f++){var g=a.Filter[f],l=g.substring(0,g.indexOf(":"));if(l==k){j=true;break}}!j&&Array.add(h,d)}a.Filter=Array.clone(h)}else if(a.Filter==null||a.Filter.length==0)a.Filter=Array.clone(b.Filter);a.SortExpression=b.SortExpression;if(!c.get_isDataSheet()||!c._get_focusedCell()){var i=c.readContext("GridType");i!=null&&c.changeViewType(i)}}},_createParams:function(f){var a=this,c=a.get_lookupContext(),b={PageIndex:a.get_pageIndex(),PageSize:a.get_pageSize(),PageOffset:a.get_pageOffset(),SortExpression:a.get_sortExpression(),Filter:a.get_filter(),ContextKey:a.get_id(),Cookie:a.get_cookie(),FilterIsExternal:a._externalFilter.length>0,LookupContextFieldName:c?c.FieldName:null,LookupContextController:c?c.Controller:null,LookupContextView:c?c.View:null,LookupContext:c,Inserting:a.get_isInserting(),LastCommandName:a.get_lastCommandName(),LastCommandArgument:a.get_lastCommandArgument(),ExternalFilter:a.get_externalFilter(),Transaction:a.get_transaction(),DoesNotRequireData:a.get_searchOnStart(),LastView:a.get_lastViewId(),Tag:a.get_tag(),RequiresFirstLetters:a.get_showFirstLetters()},d=a.get_confirmContext();if(d){var e=Array.clone(b.ExternalFilter);Array.addRange(e,d.Values);b.ExternalFilter=e}if(a._position){if(a._position.changing){b.PageIndex=a._position.index;b.PageSize=1;b.Filter=a._position.filter;b.SortExpression=a._position.sortExpression;b.RequiresMetaData=true}if(f)b.Filter=a._selectedKeyFilter}return b},_createArguments:function(d,e,c){var a=this;if(!c)c=a._collectFieldValues();if(!e)e=a.get_viewId();if(d.values)c=Array.clone(d.values);if(a._paramValues){c=Array.clone(c);Array.addRange(c,a._paramValues);delete a._paramVlaues}var b={CommandName:d.commandName,CommandArgument:d.commandArgument,Path:d.path,LastCommandName:a.get_lastCommandName(),Values:c,ContextKey:a.get_id(),Cookie:a.get_cookie(),Controller:a.get_controller(),View:e,LastView:a.get_lastViewId(),Tag:a.get_tag()};b.Filter=a.get_filter();b.SortExpression=a.get_sortExpression();b.SelectedValues=a.get_selectedValues();b.ExternalFilter=a.get_externalFilter();b.Transaction=a.get_transaction();if(!String.isNullOrEmpty(b.Transaction)&&!a.get_isModal()&&!a.get_filterSource()&&b.CommandName.match(/Insert|Update|Delete/))b.Transaction+=":complete";b.SaveLEVs=a._allowLEVs==true;return b},_loadPage:function(){var a=this;a._isBusy&&a._cancelWSRequest();a._delayedLoading=false;if(a._source)return;if(a.get_mode()!=Web.DataViewMode.View){a._allFields=[{Index:0,Label:"",DataFormatString:"",AliasIndex:0,ItemsDataController:a.get_controller(),ItemsNewDataView:a.get_newViewId(),ItemsDataView:a.get_viewId(),_dataView:a,Behaviors:[],format:_field_format,isReadOnly:_field_isReadOnly,isNumber:_field_isNumber}];a._fields=a._allFields;a._render()}else{a._busy(true);a._detachBehaviors();a._showWait();var b=a._createParams();a._restoreViewVitals(b);a._invoke("GetPage",{controller:a.get_controller(),view:a.get_viewId(),request:b},Function.createDelegate(a,a._onGetPageComplete))}},_cancelWSRequest:function(){var a=this._wsRequest;if(a){this._wsRequest=null;a.get_executor&&!a.completed()&&a.get_executor().abort()}},_invoke:function(f,j,l,i){var b=this;b._autoRefresh(true);if(b.get_servicePath().startsWith("http")){var g=b.get_servicePath().match(/(.+?)\w+\/\w+\.\w+(\?|$)/),h=String.format("__{0}_{1}_ScriptParam",b.get_id(),f),a=$get(h),c=a?a.value:Sys.Serialization.JavaScriptSerializer.serialize(j);if(a)a.value="";var d=c.length;while(c){var k=String.format("{0}ScriptHost.ashx?sender={1}&method={2}&ctx={3}&args={4}&cookie={5}",g&&g[1].startsWith("http")?g[1]:"",b.get_id(),f,i,encodeURI(c),b.get_cookie());if(k.length<=2048){a&&a.value.length==0&&a.parentElement.removeChild(a);break}if(!a){a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("id",h);document.body.appendChild(a)}d=Math.round(d/3*2);c=c+a.value;a.value=c.substr(d,c.length-d);c=c.substr(0,d)}var m=document.getElementsByTagName("head")[0],e=document.createElement("script");e.setAttribute("id",String.format("__{0}_{1}_ScriptCallBack",b.get_id(),f));e.setAttribute("type","text/javascript");e.setAttribute("language","javascript");e.setAttribute("src",k+(a?"&c=1":""));m.appendChild(e)}else b._wsRequest=Sys.Net.WebServiceProxy.invoke(b.get_servicePath(),f,false,j,l,Function.createDelegate(b,b._onMethodFailed),i)},_disposeFields:function(){if(this._allFields)for(var b=0;b<this._allFields.length;b++){var a=this._allFields[b];a._dataView=null;a._listOfValues&&Array.clear(a._listOfValues)}},_formatViewText:function(b,d,e){var a=this,c=a._views.length>0?a._views[0].Label:a._view?a._view.Label:"";return!String.isNullOrEmpty(b)?String.format(b,d==true?c.toLowerCase():c):e},_autoRefresh:function(b){var a=this;if(a._refreshInterval>0){if(a._riTimeout){window.clearTimeout(a._riTimeout);a._riTimeout=null}if(!b)a._riTimeout=window.setTimeout(String.format("$find('{0}').refreshAndResize()",a.get_id()),a._refreshInterval*1e3)}},_onGetPageComplete:function(c){var x="false",J="createForm1",I="/Membership.aspx",H="UserUserName",G="aspnet_Membership",w="Lookup",t="{0:",v="Boolean",F="DateTime",l=null,i=true,n=false,a=this;a._busy(n);if(Sys.Services&&Sys.Services.AuthenticationService&&Sys.Services.AuthenticationService.get_isLoggedIn&&Sys.Services.AuthenticationService.get_isLoggedIn()&&!c.IsAuthenticated){window.location.reload();return}if(a._containerIsHidden){Sys.UI.DomElement.setVisible(a._container,i);a._containerIsHidden=n}a.set_tag(c.Tag);if(c.FirstLetters!="")a._firstLetters=c.FirstLetters?c.FirstLetters.split(/,/):l;var r=a._position&&a._position.changed;if(a._pageIndex<0||r){if(a._pageIndex==-1||r){a._disposeFields();a._expressions=c.Expressions;a._detachBehaviors();a._allFields=c.Fields;a._fields=[];var s=[];if(a._keyFields&&a._selectedKey.length>0){for(var d=0;d<a._keyFields.length;d++)s[d]={name:a._keyFields[d].Name,value:a._selectedKey[d]};a._selectedKey=[]}a._keyFields=[];var E=n;for(d=0;d<c.Fields.length;d++){var b=c.Fields[d];b.Index=d;if(b.Name=="Status")E=i}if(!E)c.Fields[c.Fields.length]={Name:"Status",ReadOnly:i,Type:"String",AllowNulls:i,Hidden:i,Index:c.Fields.length};var u=Web.DataView._commandLine.match(/\W_display=(.+?)(&|$)/);for(d=0;d<c.Fields.length;d++){b=c.Fields[d];b.AliasIndex=!String.isNullOrEmpty(b.AliasName)?a.findField(b.AliasName).Index:d;if((!b.Hidden||u)&&a._fieldIsInExternalFilter(b)&&a.get_hideExternalFilterFields()){var U=b.Hidden;b.Hidden=i;if(u&&Array.indexOfCaseInsensitive(u[1].split(","),b.Name)!=-1){if(!U)b.Hidden=n;if(a.get_isInserting()){var S=new RegExp(String.format("\\W{0}=(.*?)(&|$)",b.Name)),M=Web.DataView._commandLine.match(S);if(M){if(!c.NewRow)c.NewRow=[];c.NewRow[d]=decodeURIComponent(M[1])}}}}b.Behaviors=[]}a._hasDynamicLookups=n;a._requiresConfiguration=n;for(d=0;d<c.Fields.length;d++){b=c.Fields[d];b._dataView=a;!b.Hidden&&Array.add(a._fields,b);if(b.IsPrimaryKey){Array.add(a._keyFields,b);for(var f=0;f<s.length;f++)if(s[f].name==b.Name){Array.add(a._selectedKey,s[f].value);break}}if(String.isNullOrEmpty(b.HeaderText))b.HeaderText=b.Label;if(String.isNullOrEmpty(b.HeaderText))b.HeaderText=b.Name;b.FilterType="Number";switch(b.Type){case"Time":case"String":b.FilterType="Text";break;case F:case"DateTimeOffset":b.FilterType="Date";break;case v:b.FilterType=v}if(!String.isBlank(b.SearchOptions)&&a.get_showSearchBar()){var m=b.SearchOptions.split(/[,\n]/);f=0;var D=n;while(f<m.length){var B=m[f]=m[f].trim();if(B=="*")D=i;if(B.length>0&&B!="*")f++;else Array.removeAt(m,f)}if(D&&m.length>0){var T=Web.DataViewResources.Data.Filters[b.FilterType];a._enumerateMissingSearchOptions(m,T.List)}Array.contains(m,"$in")&&!Array.contains(m,"$notin")&&Array.add(m,"$notin");b.SearchOptions=m.length==0?l:m}else b.SearchOptions=l;b.format=_field_format;b.isReadOnly=_field_isReadOnly;b.isNumber=_field_isNumber;if(b.DataFormatString&&b.DataFormatString.indexOf("{")==-1)b.DataFormatString=t+b.DataFormatString+"}";if(b.DataFormatString)b.DataFormatString=a.resolveClientUrl(b.DataFormatString);if(b.Type.startsWith(F))if(!b.DataFormatString)b.DataFormatString="{0:d}";else{h=b.DataFormatString.match(/{0:(g)}/i);if(h){var A=Sys.CultureInfo.CurrentCulture.dateTimeFormat;b.DateFmtStr=t+A.ShortDatePattern+"}";b.TimeFmtStr=t+(h[1]=="g"?A.ShortTimePattern:A.LongTimePattern)+"}"}var O=Web.DataView.dateFormatStrings[b.DataFormatString];if(O)b.DataFormatString=t+O+"}";if(b.DateFmtStr)b.DataFmtStr=b.DataFormatString}if(b.Type==v&&b.Items.length==0){b.Items=Array.clone(b.AllowNulls?Web.DataViewResources.Data.BooleanOptionalDefaultItems:Web.DataViewResources.Data.BooleanDefaultItems);if(!b.ItemsStyle)b.ItemsStyle=Web.DataViewResources.Data.BooleanDefaultStyle}b.Items&&b.Items.length>0&&(b.AllowNulls||b.ItemsStyle=="DropDownList")&&!String.isNullOrEmpty(b.Items[0][0])&&b.ItemsStyle!="CheckBoxList"&&Array.insert(b.Items,0,[l,Web.DataViewResources.Data.NullValueInForms]);if(!String.isNullOrEmpty(b.ItemsStyle))if(!String.isNullOrEmpty(b.ContextFields)&&b.ItemsStyle!=w&&b.ItemsStyle!="AutoComplete"&&!String.isNullOrEmpty(b.ItemsDataController)){a._hasDynamicLookups=i;b.ItemsAreDynamic=i}else if(b.ItemsStyle=="UserNameLookup"){b.ItemsStyle=w;b.ItemsDataController=G;b.ItemsDataTextField="UserName";b.ItemsDataValueField=H;if(Web.Menu.findNode(I))b.ItemsNewDataView=J}else if(b.ItemsStyle=="UserIdLookup"){b.ItemsStyle=w;b.ItemsDataController=G;b.ItemsDataTextField=H;b.ItemsDataValueField="UserId";if(Web.Menu.findNode(I))b.ItemsNewDataView=J}if(!String.isNullOrEmpty(b.Configuration))a._requiresConfiguration=i;if(b.AllowLEV)a._allowLEVs=i;if(b.TextMode==2&&String.isNullOrEmpty(b.Editor)){b.Editor="RichEditor";b.HtmlEncode=n}if(b.Editor)b.EditorId=String.format("{0}_Item{1}",a.get_id(),b.Index)}c.LEVs&&a._recordLEVs(c.LEVs);a._views=c.Views;a._view=l;if(!a._lastViewId&&!a.get_isForm())a._lastViewId=c.View;a._actionGroups=c.ActionGroups?c.ActionGroups:[];a._statusBar=c.StatusBar;var y=/^(true|false)\:(.+)$/;a._actionColumn=l;for(d=0;d<a._actionGroups.length;d++){var k=a._actionGroups[d];k.Scope=="Grid"&&a.get_isTree()&&Array.insert(k.Actions,0,{CommandName:"Open"});var z=Web.DataViewResources.Actions.Scopes[k.Scope];if(z._Self){var N=z._Self[k.HeaderText];if(N)k.HeaderText=N.HeaderText}if(k.Scope=="ActionColumn")a._actionColumn=!String.isNullOrEmpty(k.HeaderText)?k.HeaderText:Web.DataViewResources.Grid.ActionColumnHeaderText;k.CssClassEx=String.format("Actions$g${0} ",k.Id);for(f=0;f<k.Actions.length;f++){var e=k.Actions[f];e.Path=String.format("{0}/{1}",k.Id,e.Id);e.CssClassEx=String.format("Actions$g${0}$a${1} ",k.Id,e.Id);if(String.isNullOrEmpty(e.HeaderText)){var j=z[e.CommandName];if(j){if(j.CommandArgument){var p=j.CommandArgument[e.CommandArgument];if(p)j=p}if(j.WhenLastCommandName){p=j.WhenLastCommandName[e.WhenLastCommandName];if(p)j=p}e.HeaderText=j.HeaderText;if(!String.isNullOrEmpty(j.HeaderText)&&j.HeaderText.indexOf("{")>=0)e.HeaderText=j.VarMaxLen!=l&&c.Views[0].Label.length>j.VarMaxLen?j.HeaderText2:a._formatViewText(j.HeaderText);if(String.isNullOrEmpty(e.Description))e.Description=a._formatViewText(j.Description);if(String.isNullOrEmpty(e.Confirmation))e.Confirmation=j.Confirmation}else e.HeaderText=e.CommandName}if(String.isNullOrEmpty(e.WhenView))e.WhenViewRegex=l;else{var h=y.exec(e.WhenView);e.WhenViewRegex=new RegExp(h?h[2]:e.WhenView);e.WhenViewRegexResult=h?h[1]!=x:i}if(String.isNullOrEmpty(e.WhenTag))e.WhenTagRegex=l;else{h=y.exec(e.WhenTag);e.WhenTagRegex=new RegExp(h?h[2]:e.WhenTag);e.WhenTagRegexResult=h?h[1]!=x:i}if(String.isNullOrEmpty(e.WhenHRef))e.WhenHRefRegex=l;else{h=y.exec(e.WhenHRef);e.WhenHRefRegex=new RegExp(h?h[2]:e.WhenHRef);e.WhenHRefRegexResult=h?h[1]!=x:i}}}var q=1,L=n,o=a._categories=c.Categories;a._tabs=[];for(d=0;d<o.length;d++){var g=o[d];g.Index=d;!String.isNullOrEmpty(g.Tab)&&!Array.contains(a._tabs,g.Tab)&&Array.add(a._tabs,g.Tab);if(g.NewColumn){if(d>0)q++;L=i}g.ColumnIndex=q-1;if(g.Id){var Q=$get(String.format("{0}_{1}_{2}",c.Controller,c.View,g.Id));if(Q)g.Template=Q.innerHTML}if(g.Floating&&String.isNullOrEmpty(g.Template)){var P=new Sys.StringBuilder('<div class="FloatingCategoryHeader"></div>');for(f=0;f<a._allFields.length;f++){var C=a._allFields[f];!C.Hidden&&d==C.CategoryIndex&&P.appendFormat('<div class="FieldPlaceholder">{{{0}}}</div>',C.Name)}g.Template=P.toString()}}if(a._tabs.length>0){for(d=0;d<o.length;d++){g=o[d];if(String.isNullOrEmpty(g.Tab))if(!String.isNullOrEmpty(o[0].Tab))g.Tab=o[0].Tab;else{g.Tab=Web.DataViewResources.Form.GeneralTabText;a._tabs[0]!=Web.DataViewResources.Form.GeneralTabText&&Array.insert(a._tabs,0,Web.DataViewResources.Form.GeneralTabText)}g.ColumnIndex=0}if(a._lastSelectedCategoryTabIndex!=l){a.set_categoryTabIndex(!(a._lastSelectedCategoryTabIndex>=0)?a._tabs.length-1:0);delete a._lastSelectedCategoryTabIndex}else a.set_categoryTabIndex(0);var K=a.get_parentDataView(a);K._lastClickedIcon=="Attachment"&&a.set_categoryTabIndex(a._tabs.length-1);K._lastClickedIcon=l;q=1}else a.set_categoryTabIndex(-1);a._numberOfColumns=L&&!a._get_template()?q:0}a._totalRowCount=c.TotalRowCount;if(a._position&&a._position.count==-1)a._position.count=c.TotalRowCount;a._filter=c.Filter;a._sortExpression=c.SortExpression;a._pageIndex=c.PageIndex;a._firstPageButtonIndex=Math.floor(c.PageIndex/Web.DataViewResources.Pager.PageButtonCount)*Web.DataViewResources.Pager.PageButtonCount;if(!r){a._pageSize=c.PageSize;a._pageCount=Math.floor(c.TotalRowCount/c.PageSize);if(c.TotalRowCount%c.PageSize!=0)a._pageCount++}}a._icons=c.Icons;if(!a.get_isInserting()){if(a._rows){if(a._rows.length==0||c.Rows.length==0)delete a._viewColumnSettings;for(d=0;d<a._rows.length;d++)Array.clear(a._rows[d]);Array.clear(a._rows)}a._rows=c.Rows}a._newRow=c.NewRow?c.NewRow:[];if(c.Aggregates)a._aggregates=c.Aggregates;if(a.get_isForm()&&a._selectedRowIndex==l&&a._totalRowCount>0){a._selectedRowIndex=0;a._selectKeyByRowIndex(0)}if(r){a._position.changed=i;a._selectKeyByRowIndex(0)}a._render();a.get_lookupField()&&a._adjustLookupSize();if(a._isInInstantDetailsMode()){var V=$common.getClientBounds(),R=$common.getContentSize(document.body);window.resizeBy(0,R.height-V.height)}a._saveViewVitals();if(a._pendingSelectedEvent){a._pendingSelectedEvent=n;a.updateSummary()}a._registerFieldHeaderItems();_body_performResize();a._executeSecondCommand();a._autoRefresh();a._autoSelect();if(!String.isNullOrEmpty(c.ClientScript))eval(c.ClientScript)},_autoSelect:function(e){var b=null,a=this,c=b,d=b;if(a.get_autoHighlightFirstRow()){a.set_autoHighlightFirstRow(false);c="Select"}var i=false;if(a.get_autoSelectFirstRow()){a.set_autoSelectFirstRow(false);var f=a.get_actionGroups("Grid");if(f.length>0)for(var h=0;h<f[0].Actions.length;h++){var g=f[0].Actions[h];if(g.CommandName){c=g.CommandName;d=g.CommandArgument;i=!String.isNullOrEmpty(d)&!a.get_showModalForms()&&e==b;break}}}if(c&&a.get_viewType()!="Form"&&a._rows.length>0){i&&a._hideContainer();a.executeRowCommand(e==b?0:e,c,d)}},_hideContainer:function(){this._containerIsHidden=true;this._container.style.display="none"},_enumerateMissingSearchOptions:function(b,c){for(var d=0;d<c.length;d++){var a=c[d];if(a&&!a.Hidden)if(a.List)this._enumerateExpressions(b,c);else!Array.contains(b,a.Function)&&Array.add(b,a.Function)}},_executeSecondCommand:function(c){var a=this;if(c){var b=Web.DataView._commandLine.match(/_commandName2=(\w+)(.*?_commandArgument2=(.*?)(&|$))?/);b&&a.executeActionInScope([a.get_viewType(),"ActionBar"],b[1],b[3])}else if(a._trySecondCommand){a._trySecondCommand=false;(a.get_viewType()!="Form"||a._totalRowCount>0)&&window.setTimeout(String.format('$find("{0}")._executeSecondCommand(true)',a.get_id()),50)}},_skipNextInputListenerClickEvent:function(){if(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>=9)this._skipClickEvent=true},_gridViewCellFocus:function(d,c){var b=this;try{var a=new Sys.UI.DomEvent(d);if((a.target.tagName=="A"||a.target.parentNode.tagName=="A")&&!b.get_lookupField()||Sys.UI.DomElement.containsCssClass(a.target,"RowSelector"))return false;if(b.get_lookupField()){a.stopPropagation();a.preventDefault()}b._skipNextInputListenerClickEvent()}catch(f){}b.executeRowCommand(c,"Select");return true},_dataSheetCellFocus:function(f,c,d){var a=this,b=a._get_focusedCell();if(d==-1)d=b!=null?b.colIndex:0;if(a.get_isEditing()&&b){a._focusCell(-1,-1,false);a._focusCell(c,d);var e=c==b.rowIndex||a.get_isInserting()&&c==-1;if(!e&&!a._updateFocusedRow(b)||!a._updateFocusedCell(b)){a._focusCell(c,d,false);a._focusCell(b.rowIndex,b.colIndex)}else e&&(c!=a._selectedRowIndex&&!a.get_isInserting())&&a.cancelDataSheetEdit();a._skipNextInputListenerClickEvent();return}if(!f)a._skipNextInputListenerClickEvent();else if(!a._gridViewCellFocus(f,c,d))return;if(b!=null&&b.rowIndex==c&&b.colIndex==d&&!a.get_isEditing()&&!a.get_lookupField()){document.selection&&document.selection.clear();a._skipEditOnClick!=true&&a._allowEdit()&&a.editDataSheetRow(b.rowIndex)}else a._startInputListenerOnCell(c,d);a._skipEditOnClick=false},_startInputListenerOnCell:function(d,c){var a=this;a._startInputListener();a._focusCell(-1,-1,false);a._focusCell(d,c);if(!a.get_lookupField()){if(Web.DataView._activeDataSheetId!=a.get_id()){var b=$find(Web.DataView._activeDataSheetId);b&&b.cancelDataSheet();Web.DataView._activeDataSheetId=a.get_id()}a._lostFocus=false}},_startInputListener:function(){var a=this;a._stopInputListener();if(!a._inputListenerKeyDownHandler){a._inputListenerKeyDownHandler=Function.createDelegate(a,a._inputListenerKeyDown);a._inputListenerKeyPressHandler=Function.createDelegate(a,a._inputListenerKeyPress);a._inputListenerClickHandler=Function.createDelegate(a,a._inputListenerClick);a._inputListenerDblClickHandler=Function.createDelegate(a,a._inputListenerDblClick);a._focusedCell=null}$addHandler(document,"keydown",a._inputListenerKeyDownHandler);$addHandler(document,"keypress",a._inputListenerKeyPressHandler);$addHandler(document,"click",a._inputListenerClickHandler);$addHandler(document,"dblclick",a._inputListenerDblClickHandler);a._trackingInput=true},_stopInputListener:function(){var a=this;if(!a._trackingInput)return;$removeHandler(document,"keydown",a._inputListenerKeyDownHandler);$removeHandler(document,"keypress",a._inputListenerKeyPressHandler);$removeHandler(document,"click",a._inputListenerClickHandler);$removeHandler(document,"dblclick",a._inputListenerDblClickHandler);a._lostFocus=true;a._trackingInput=false},_allowEdit:function(){return this._findActionsByCommandName("Edit").length>0},_allowNew:function(){return this._findActionsByCommandName("New").length>0},get_interactiveActionGroups:function(){var b=this,a=b.get_actionGroups("Grid");Array.addRange(a,b.get_actionGroups("ActionBar"));Array.addRange(a,b.get_actionGroups("Form"));Array.addRange(a,b.get_actionGroups("ActionColumn"));return a},_findActionsByCommandName:function(f){for(var d=[],c=this.get_interactiveActionGroups(),a=0;a<c.length;a++){actions=c[a].Actions;for(var b=0;b<actions.length;b++){var e=actions[b];e.CommandName==f&&Array.add(d,e)}}return d},_inputListenerKeyPress:function(b){var a=this;if(b.rawEvent&&b.rawEvent.charCode==0)return;if(a._lostFocus)return;if(a.get_isEditing()){if(a._pendingChars)a._pendingChars+=String.fromCharCode(b.charCode);return}if(a._isBusy)return;var c=a._get_focusedCell();if(c==null)return;var d=a._fields[c.colIndex];if(d.ReadOnly)return;if(!a._allowEdit())return;a._pendingChars=String.fromCharCode(b.charCode);a.editDataSheetRow(c.rowIndex)},cancelDataSheet:function(){var a=this;if(a.get_isDataSheet()){a._focusCell(-1,-1,false);a._stopInputListener();a.set_ditto(null);Web.DataView._activeDataSheetId=null;a.cancelDataSheetEdit();a._lostFocus=false;a._focusedCell=null}},_inputListenerKeyDown:function(b){var d=true,h=false,g=null,a=this;if(a._lookupIsActive)return;if(a._lostFocus)return;if(Web.HoverMonitor._instance.get_isOpen())return;if(a._isBusy){if(a._pendingChars)return;b.preventDefault();b.stopPropagation();return}if(a._isBusy)return;var e=a._get_focusedCell();if(e==g)return;var c={rowIndex:e.rowIndex,colIndex:e.colIndex},f=h,k=h,i=a.get_pageSize();if(a._rows.length<i)i=a._rows.length;switch(b.keyCode){case 83:case Sys.UI.Key.enter:if(b.keyCode==83&&!b.ctrlKey)return;if(a.get_isEditing()){var l=b.target&&b.target.tagName;if((l=="TEXTAREA"||l=="A")&&!b.ctrlKey)return;f=d;if(!a._updateFocusedRow(e)){b.preventDefault();b.stopPropagation();return}}if(b.ctrlKey&&!a.get_isEditing()||a.get_lookupField()){f=d;a.executeRowCommand(e.rowIndex,"Select")}else if(b.shiftKey){if(c.rowIndex>0)c.rowIndex--}else if(a._moveFocusToNextRow(c,i))f=d;break;case Sys.UI.Key.down:if(a.get_isEditing()||b.ctrlKey)return;if(a._moveFocusToNextRow(c,i))f=d;break;case Sys.UI.Key.up:if(a.get_isEditing()||b.ctrlKey)return;if(c.rowIndex>0)c.rowIndex--;else{if(a._pageOffset==0&&a.get_pageIndex()==0){a._pageOffset=g;f=d}else if(a._pageOffset==g){if(a.get_pageIndex()>0)a._pageOffset=-1}else a._pageOffset--;f=d;if(a._pageOffset==-i){a._pageOffset=g;a.get_pageIndex()>0&&a.goToPage(a.get_pageIndex()-1)}else a.goToPage(a.get_pageIndex())}break;case Sys.UI.Key.tab:case Sys.UI.Key.right:case Sys.UI.Key.left:var j=d;if((b.keyCode==Sys.UI.Key.right||b.keyCode==Sys.UI.Key.left)&&a.get_isEditing())return;if(!b.shiftKey&&b.target.parentNode.className=="Date")return;if(b.shiftKey&&b.target.id&&b.target.id.match(/\$Time\d+/))return;var m=a._pageOffset;if(b.shiftKey||b.keyCode==Sys.UI.Key.left){if(c.colIndex>0){c.colIndex--;if(b.keyCode==Sys.UI.Key.tab)while(c.colIndex>0&&a._fields[c.colIndex].isReadOnly())c.colIndex--}else if(a.get_isEditing())f=d}else if(c.colIndex<a._fields.length-1){c.colIndex++;if(b.keyCode==Sys.UI.Key.tab)while(c.colIndex<a._fields.length-1&&a._fields[c.colIndex].isReadOnly())c.colIndex++}else{if(a.get_isEditing()){if(!a._updateFocusedRow(e,b.keyCode==Sys.UI.Key.tab)){b.preventDefault();b.stopPropagation();return}else j=h;f=d}if(j&&a._moveFocusToNextRow(c,i))f=d;if(c.rowIndex!=e.rowIndex||a._pageOffset!=m){c.colIndex=0;f=h}}if(j&&a.get_isEditing())k=d;break;case Sys.UI.Key.home:if(a.get_isEditing())return;if(b.ctrlKey)if(a.get_pageIndex()>0){f=d;a._pageOffset=0;a.goToPage(0);e.rowIndex=0;e.colIndex=0}else{c.rowIndex=0;c.colIndex=0}else c.colIndex=0;break;case Sys.UI.Key.end:if(a.get_isEditing())return;if(b.ctrlKey){f=d;e.colIndex=a._fields.length-1;e.rowIndex=a._totalRowCount%a.get_pageSize()-1;if(e.rowIndex<0)e.rowIndex=a.get_pageSize();a._pageOffset=g;a.goToPage(a.get_pageCount()-1)}else c.colIndex=a._fields.length-1;break;case Sys.UI.Key.pageUp:if(a.get_isEditing())return;f=d;if(a.get_pageIndex()>0)a.goToPage(a.get_pageIndex()-1);else if(a._pageOffset!=g){a._pageOffset=g;a.goToPage(a.get_pageIndex())}break;case Sys.UI.Key.pageDown:if(a.get_isEditing())return;f=d;a.get_pageIndex()<a.get_pageCount()-1&&a.goToPage(a.get_pageIndex()+1);break;case Sys.UI.Key.esc:!a.cancelDataSheetEdit()&&a.cancelDataSheet();f=d;break;case Sys.UI.Key.del:if(a.get_isEditing()||b.shiftKey||b.altKey)return;f=d;if(b.ctrlKey)a.deleteDataSheetRow();else{a._pendingChars="";a.editDataSheetRow(e.rowIndex)}break;case 45:if(!a.get_isEditing()){f=d;a._allowNew()&&a.newDataSheetRow()}break;case 32:if(b.ctrlKey&&a.get_selectionMode()==Web.DataViewSelectionMode.Multiple&&!a.get_isInserting()){f=d;a.toggleSelectedRow(e.rowIndex)}else return;break;case 113:if(a.get_isEditing())return;f=d;a._allowEdit()&&a.editDataSheetRow(e.rowIndex)}if((e.rowIndex!=c.rowIndex||e.colIndex!=c.colIndex)&&!f){a._focusCell(e.rowIndex,e.colIndex,h);a._focusCell(c.rowIndex,c.colIndex,d);f=d}if(f){b.preventDefault();b.stopPropagation()}if(k)if(!a._updateFocusedCell(e)){a._focusCell(c.rowIndex,c.colIndex,h);a._focusCell(e.rowIndex,e.colIndex,d)}},_updateFocusedCell:function(h){var b=this,d=b._collectFieldValues(),g=b._validateFieldValues(d,true),a=b._fields[h.colIndex];if(g){var f=true;if(a.Index<d.length&&d[a.Index].Modified)f=!b._performValueChanged(a.Index);f&&b.refresh(true)}else if(a.Behaviors)for(var e=0;e<a.Behaviors.length;e++){var c=a.Behaviors[e];if(AjaxControlToolkit.CalendarBehavior.isInstanceOfType(c)&&c.get_isOpen()){c.hide();c.show()}}return g},_updateFocusedRow:function(b,c){var a=this;Web.DataView.showMessage();a._syncFocusedCell=a.get_isInserting();a._saveAndNew=c;a._lastFocusedCell=b;a.executeRowCommand(b.rowIndex,a._syncFocusedCell?"Insert":"Update",null,true);return a._valid},_get_selectedDataRowIndex:function(b){var a=this;return a.get_pageIndex()*a.get_pageSize()+a.get_pageOffset()+(b!=null?b:a._selectedRowIndex)},executeActionInScope:function(j,l,i,a,m){var b=this;if(a==null)a=b._selectedRowIndex;for(var h=0;h<j.length;h++){var k=j[h],e=b.get_actionGroups(k);if(e)for(var d=0;d<e.length;d++){var f=e[d].Actions;if(f)for(var c=0;c<f.length;c++){var g=f[c];if(g.CommandName==l&&(String.isNullOrEmpty(i)||g.CommandArgument==i)&&b._isActionAvailable(g,a)){m!=true&&b.executeAction(k,c,a,d);return true}}}}return false},newDataSheetRow:function(){window.setTimeout(String.format("$find('{0}').executeCommand({{commandName:'New',commandArgument:'{1}'}});",this.get_id(),this.get_viewId()),100)},editDataSheetRow:function(a){this.get_isDataSheet()&&this.executeRowCommand(a,"Edit","",false)},deleteDataSheetRow:function(){var a=this._get_focusedCell();if(a){this.executeRowCommand(a.rowIndex,"Select");window.setTimeout(String.format("$find('{0}').executeActionInScope(['Row','ActionBar'],'Delete',null,{1});",this.get_id(),a.rowIndex),100)}},_moveFocusToNextRow:function(b,d){var a=this,c=false,e=a._get_selectedDataRowIndex(b.rowIndex),f=a._pageOffset;if(b.rowIndex<d-1)b.rowIndex++;else if(a._get_selectedDataRowIndex(b.rowIndex)<a._totalRowCount-1){if(a._pageOffset==null)a._pageOffset=1;else a._pageOffset++;c=true;if(a._pageOffset==d){a._pageOffset=null;a.goToPage(a.get_pageIndex()+1)}else a.goToPage(a.get_pageIndex())}if(e==a._get_selectedDataRowIndex(b.rowIndex)&&!a.get_isEditing()&&a._allowNew()){a._ignoreSelectedKey=true;a.newDataSheetRow();c=true}return c},_scrollToRow:function(b){return;var a=this._get_focusedCell();if(a){a.rowIndex+=b>0?1:-1;this._moveFocusToNextRow(a,this.get_pageSize)}},cancelDataSheetEdit:function(){if(this.get_isEditing()){var a=this._get_focusedCell();a!=null&&this.executeRowCommand(a.rowIndex,"Cancel",null,false);return true}else return false},_inputListenerClick:function(h){var c=true,d=false,a=this;if(a._skipClickEvent){a._skipClickEvent=d;return}if(a._lookupIsActive)return;var b=h.target,f=d,e=d,g=c;while(b!=null){if(b==a._container){f=c;break}if(b.className!=null)if(b.className.match(/Cell|Group|InfoRow|FieldHeaderSelector|Toggle|FooterRow|ActionRow\s*/))e=c;else if(b.className.match(/QuickFind|SearchBarFrame\s*/))g=d;b=b.parentNode}if(!f)a.cancelDataSheet();else{if(g)a._lostFocus=!e;else a._lostFocus=c;a._skipEditOnClick=c;!e&&a.cancelDataSheetEdit()}},_inputListenerDblClick:function(){var a=this;if(a._lostFocus)return;var b=a._get_focusedCell();if(!b||a.get_isEditing()||!a._allowEdit())return;document.selection&&document.selection.clear();a.editDataSheetRow(b.rowIndex)},_get_focusedCell:function(){return this._focusedCell},_focusCell:function(h,d,r){var l="CrossHair",f=null,a=this;if(!a.get_isDataSheet()){a._focusedCell=f;return f}var u=a.get_isInserting();if(r==f)r=true;if(h==-1&&d==-1){if(!a._focusedCell)return f;h=a._focusedCell.rowIndex;d=a._focusedCell.colIndex}if(h>=a._rows.length)h=a._rows.length-1;if(d>=a._fields.length)d=a._fields.length-1;for(var s=a._container.childNodes[0].rows,k=-1,e=0;e<s.length;e++){var j=s[e];if(Sys.UI.DomElement.containsCssClass(j,"Row")||Sys.UI.DomElement.containsCssClass(j,"AlternatingRow"))k++;if(u){if(Sys.UI.DomElement.containsCssClass(j,"Inserting"))break}else if(k==h)break}if(k<0)return f;var o=-1;for(e=0;e<j.childNodes.length;e++){var b=j.childNodes[e+a.get_sysColCount()];if(Sys.UI.DomElement.containsCssClass(b,"Cell"))o++;if(o==d)break}if(o<0)return f;var t=b.parentNode.childNodes[a.get_sysColCount()-1],q=a._get_headerRowElement(),g=q.childNodes[d+a.get_sysColCount()];if(r==true){var n=$common.getBounds(g);Sys.UI.DomElement.addCssClass(b,"Focused");Sys.UI.DomElement.addCssClass(t,l);Sys.UI.DomElement.addCssClass(g,l);if(!a._skipCellFocus){var i=$common.getScrolling(),p=$common.getClientBounds(),c=$common.getBounds(b);if(i.y>c.y)(k==0?g:b).scrollIntoView(true);else if(i.y+p.height<=c.y+c.height)b.scrollIntoView(false);else(i.x>c.x||i.x+p.width-1<=c.x||i.x+p.width-1<=c.x+c.width)&&b.scrollIntoView(false);if(Sys.Browser.agent==Sys.Browser.InternetExplorer){var v=$common.getBounds(q);q.style.height=v.height+"px"}}var m=$common.getBounds(g);(n.width!=m.width||n.x!=m.x||n.y!=m.y)&&Sys.UI.DomElement.addCssClass(g,"Narrow");a._skipCellFocus=false}else{Sys.UI.DomElement.removeCssClass(b,"Focused");Sys.UI.DomElement.removeCssClass(b,"Narrow");Sys.UI.DomElement.removeCssClass(t,l);Sys.UI.DomElement.removeCssClass(g,l)}a._focusedCell={rowIndex:h,colIndex:d};return b},_initializeModalPopup:function(){var a=this;Sys.UI.DomElement.addCssClass(a.get_element(),"ModalPlaceholder");var e=$common.getClientBounds(),c=e.width/5*4,d=Web.DataViewResources.ModalPopup.MaxWidth,b=a.get_confirmContext();if(b&&b.MaxWidth>0&&b.MaxWidth<c)d=b.MaxWidth;if(c>d)c=d;var f=e.height/5*4;if(a._container.style.overflowX!=null){a._container.style.overflowY="auto";a._container.style.overflowX="hidden"}else a._container.style.overflow="auto";a._container.style.height=f+"px";a._container.style.width=c+"px";a._saveTabIndexes();a._modalPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:a.get_id()+"ModalPopup"+Sys.Application.getComponents().length,PopupControlID:a.get_element().id,DropShadow:true,BackgroundCssClass:"ModalBackground"},null,null,a.get_modalAnchor());a._modalPopup.show()},_resizeContainerBounds:function(){var a=this;if(!a._modalPopup)a._container.style.height="";var b=$common.getBounds(a._container),d=$common.getClientBounds(),c=Math.ceil(d.height/5*4);if(b.height>c){a._container.style.height=c+"px";b.skipResizing=true}return b},_adjustModalPopupSize:function(){var g=true,b="px",a=this,h=a.get_confirmContext();Sys.UI.DomElement.removeCssClass(a._element,"EmptyModalDialog");for(var d=new Sys.StringBuilder,c=[],n=a._container.getElementsByTagName("table"),k=n.length-1;k>=0;k--){var l=n[k];if(l.className=="ActionButtons"){if(d.isEmpty()){d.append('<table class="DataView" cellSpacing=0 cellPadding=0><tr class="ActionButtonsRow BottomButtonsRow">');d.append(l.parentNode.parentNode.innerHTML);d.append("</tr></table>")}Array.add(c,l.parentNode.parentNode)}}while(c.length>0){c[0].parentNode.removeChild(c[0]);delete c[0];Array.removeAt(c,0)}var e=a._container.childNodes[0];e.style.width="";e.style.height="";var f=$common.getContentSize(e);f.height+=Sys.Browser.agent===Sys.Browser.InternetExplorer&&Sys.Browser.version<8?3:1;if(!a._buttons){a._buttons=document.createElement("div");a.get_element().appendChild(a._buttons);a._buttons.style.width=f.width+b;Sys.UI.DomElement.addCssClass(a._buttons,"FixedButtons");a._title=document.createElement("div");Sys.UI.DomElement.addCssClass(a._title,"FixedTitle");a.get_element().insertBefore(a._title,a._container)}else if(!a._modalAutoSized){a._container.style.width="auto";a._modalAutoSized=g}a._buttons.innerHTML=d.toString();d.clear();var m=a._resizeContainerBounds();if(m.height>f.height&&!m.skipResizing){var p=$common.getBorderBox(e);f.width+=p.horizontal;$common.setContentSize(a._container,f)}e.style.width=a._title.offsetWidth+b;a._buttons.style.width=a._title.offsetWidth+b;Sys.UI.DomElement.setVisible(a.get_element(),g);var o=$common.getBounds(a._container),j=$common.getPaddingBox(a._title),i=$common.getBorderBox(a._title);a._title.style.width=o.width-j.horizontal-i.horizontal+b;j=$common.getPaddingBox(a._buttons);i=$common.getBorderBox(a._buttons);a._buttons.style.width=o.width-j.horizontal-i.horizontal+b;a._title.innerHTML=String.format('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td><div class="Text">{1}</div></td><td align="right"><a href="javascript:" class="Close" onclick="$find(\'{0}\').endModalState(\'Cancel\');return false" tabindex="{3}" title="{2}">&nbsp;</a></td></tr></table>',a.get_id(),h&&h.WindowTitle?h.WindowTitle:Web.DataView.htmlEncode(a.get_view().Label),Web.DataViewResources.ModalPopup.Close,$nextTabIndex());a._modalPopup.show();if(a._modalAutoSized&&!a._modalWidthFixed){a._modalWidthFixed=g;a._container.style.width=a._container.offsetWidth+b}a._adjustModalHeight(g)},_adjustModalHeight:function(g){var a=this;if(a._modalPopup&&a.get_viewType()=="Form")if(g){var c=$common.getBounds(a._container);a._lastContainerHeight=c.height}else if(a._lastContainerHeight!=null){a._container.style.height="";for(var b=null,e=a._container.getElementsByTagName("tr"),d=0;d<e.length;d++)if(e[d].className=="Categories"){b=e[d].childNodes[0];break}if(b)b.style.paddingBottom="";c=$common.getBounds(a._container);if(a._lastContainerHeight>c.height){var f=$common.getPaddingBox(b);if(b)b.style.paddingBottom=a._lastContainerHeight-c.height-f.bottom+"px"}else a._lastContainerHeight=c.height}},_allowModalAutoSize:function(){this._modalWidthFixed=false;this._modalAutoSized=false},_disposeModalPopup:function(){var a=this;if(!a._modalPopup)return;a._modalPopup.hide();a._modalPopup.dispose();delete a._buttons;delete a._title;delete a._modalAnchor;var b=a.get_element();b.parentNode.removeChild(b);a._restoreTabIndexes()},endModalState:function(e){var b=this,a=b.get_parentDataView();if(b.get_isModal()){var c=b.get_exitModalStateCommands();if(c)for(var d=0;d<c.length;d++)if(e==c[d]){if(a){a._lookupIsActive=false;a._skipClickEvent=true}b.dispose();return true}}a&&a.refresh();Web.HoverMonitor._instance.close();return false},_adjustLookupSize:function(){var a=this;if(a.get_lookupField()&&a.get_pageSize()>3){var d=$common.getScrolling(),c=$common.getClientBounds(),b=$common.getBounds(a.get_element());b.height+b.y>c.height+d.y&&a.set_pageSize(Math.ceil(a.get_pageSize()*.66))}},_onMethodFailed:function(b){var a=this;if(Web.DataView._navigated)return;if(a._wsRequest==null)return;a._busy(false);Web.DataView.showMessage(String.format('<pre style="word-wrap:break-word;margin:0px">Component: {4}\r\nController: {5}; View: {6}; Timed out: {0}\r\nException: {1}\r\nMessage: {2}\r\nStack:\r\n{3}</pre>',b.get_timedOut(),b.get_exceptionType(),b.get_message(),b.get_stackTrace(),a.get_id(),a.get_controller(),a.get_viewId()));a.get_element().style.border="1px red solid"},_createArgsForListOfValues:function(e){var c=null,a=this,b=a.get_lookupContext(),d=a._searchBarVisibleIndex==c?a.get_filter():a._createSearchBarFilter(true);return{controller:a.get_controller(),view:a.get_viewId(),request:{FieldName:e,Controller:a.get_controller(),View:a.get_viewId(),Filter:d.length==1&&d[0].match(/(\w+):/)[1]==e?c:d,LookupContextFieldName:b?b.FieldName:c,LookupContextController:b?b.Controller:c,LookupContextView:b?b.View:c,Tag:a.get_tag()}}},_loadListOfValues:function(d,c,b){var a=this;a._busy(true);a._invoke("GetListOfValues",a._createArgsForListOfValues(b),Function.createDelegate(a,a._onGetListOfValuesComplete),{family:d,fieldName:c})},_onGetListOfValuesComplete:function(a,c){var b=this;b._busy(false);var d=b.findField(c.fieldName);d._listOfValues=a;if(a[a.length-1]==null){Array.insert(a,0,a[a.length-1]);Array.removeAt(a,a.length-1)}if(b.get_isChart()){if(b.get_showViewSelector())b._registerViewSelectorItems();else b._registerActionBarItems();Web.HoverMonitor._instance._tempOpenDelay=100}else b._registerFieldHeaderItems(Array.indexOf(b.get_fields(),d));$refreshHoverMenu(c.family);Web.DataView._resized=true},get_parentDataView:function(b){var a=b;if(!String.isNullOrEmpty(this._parentDataViewId))a=$find(this._parentDataViewId);return a},get_selectedValues:function(){var b=this.get_parentDataView(this),a=b.get_selectedValue();return a.length==0?[]:this.get_selectionMode()==Web.DataViewSelectionMode.Single?[a]:a.split(";")},_execute:function(b){var a=this;a._busy(true);a._showWait();a._lastArgs=b;a._invoke("Execute",{controller:b.Controller,view:b.View,args:b},Function.createDelegate(a,a._onExecuteComplete))},_populateDynamicLookups:function(c){var a=this;for(var b=0;b<c.Values.length;b++){var e=c.Values[b],d=a.findField(e.Name);if(d)d.DynamicItems=e.NewValue}a._skipPopulateDynamicLookups=true;a.refresh(true);a._focus()},_updateCalculatedFields:function(a){this._displayActionErrors(a);for(var c=[],b=0;b<a.Values.length;b++){var d=a.Values[b];Array.add(c,{name:d.Name,value:d.NewValue})}this.refresh(true,c);this._focus()},_get_LEVs:function(){for(var b=0;b<Web.DataView.LEVs.length;b++){var a=Web.DataView.LEVs[b];if(a.controller==this.get_controller())return a.records}a={controller:this.get_controller(),records:[]};Array.add(Web.DataView.LEVs,a);return a.records},_recordLEVs:function(a){var b=this;if(!b._allowLEVs||!a&&!b._lastArgs.CommandName.match(/Insert|Update/))return;if(!(b._lastArgs||a))return;if(!a)a=b._lastArgs.Values;for(var c=b._get_LEVs(),e=true,d=0;d<a.length;d++)if(a[d].Modified){e=false;break}if(e)return;c.length>0&&Array.removeAt(c,c.length-1);Array.insert(c,0,a)},_applyLEV:function(g){var a=this;for(var e=a._allFields[g],h=a._allFields[e.AliasIndex],d=[],f=a._get_LEVs()[0],c=0;c<f.length;c++){var b=f[c];(b.Name==e.Name||b.Name==h.Name)&&Array.add(d,{name:b.Name,value:b.NewValue})}a.refresh(true,d)},_notifyMaster:function(){if(this.get_hasParent()){var a=$find(this.get_filterSource());a&&a._updateDynamicValues(this.get_controller())}},_clearSelectedKey:function(){var a=this.get_parentDataView(this);a._selectedKey=[];a._selectedKeyFilter=[];a._position=null;a._raiseSelectedDelayed=true},_refreshSelectedKey:function(b){var a=this;if(b.length==0&&a._lastArgs)b=a._lastArgs.Values;for(var d=[],h=[],i=false,f=0;f<a._keyFields.length;f++)for(var e=a._keyFields[f],c=0;c<b.length;c++)if(b[c].Name==e.Name){var g=b[c];if(g.NewValue==null){a._clearSelectedKey();return}Array.add(d,g.NewValue);Array.add(h,e.Name+":="+a.convertFieldValueToString(e,g.NewValue));break}if(d.length>0){a._selectedKey=d;a._selectedKeyFilter=h;a._raiseSelectedDelayed=true}},_onExecuteComplete:function(b,t){var e=true,h=null,g=false,a=this;a._busy(g);a._hideWait();var j=a._lastFocusedCell,c=a._lastArgs.CommandName;if(c=="PopulateDynamicLookups"){a._populateDynamicLookups(b);return}else if(c=="Calculate"){a._updateCalculatedFields(b);return}var k=g,o=c=="Custom",i=b.Errors.length==0;if(i&&a._confirmDataViewId){var m=$find(a._confirmDataViewId);if(m){a._confirmDataViewId=h;m.cancel()}}var r={result:b,context:t,handled:g};a.raiseExecuted(r);if(r.handled)return;var n=!c.match(/Insert/);if(c.match(/Delete/i)&&b.RowsAffected>0)a._clearSelectedKey();else if(c.match(/Custom|SQL|Email/)){k=!o&&a.get_isEditing();if(b.Values.length>0){a.refresh(e,b.Values);if(o&&!b.ClientScript)b.ClientScript="void(0)";a._refreshSelectedKey(b.Values,i)}else if(!k&&c=="SQL"){a._raiseSelectedDelayed=e;a._forceChanged=e}}else if(n)for(var f=0;f<b.Values.length;f++){var s=b.Values[f],q=a.findField(s.Name);if(q)a.get_currentRow()[q.Index]=s.NewValue}else a._refreshSelectedKey(b.Values,i);if(i){a.set_tag(b.Tag);a._requestedFilter=b.Filter;a._requestedSortExpression=b.SortExpression;a._autoRefresh();if(a.get_selectionMode()==Web.DataViewSelectionMode.Multiple){a._selectedKeyList=[];a.set_selectedValue("")}a._recordLEVs();a.updateSummary();a._continueAfterScript=e;if(b.ClientScript){a._continueAfterScript=g;b.ClientScript=a.resolveClientUrl(b.ClientScript);eval(b.ClientScript)}a._lastFocusedCell=h;if(a._continueAfterScript){if(b.NavigateUrl){b.NavigateUrl=a.resolveClientUrl(b.NavigateUrl);a.navigate(b.NavigateUrl,n?a._lastArgs.Values:b.Values)}else if(!a._closeInstantDetails())if(!a.endModalState(c))if(a.get_backOnCancel()||!String.isNullOrEmpty(a._replaceTriggerViewId))a.goBack(e);else{a._notifyDesigner(e);var p=a.get_actions(a.get_view().Type),l=a._lastArgs.CommandArgument;for(f=0;f<p.length;f++){var d=p[f];if(d.WhenLastCommandName==c&&(d.WhenLastCommandArgument==""||d.WhenLastCommandArgument==l)&&a._isActionMatched(d)){a.set_lastCommandName(c);a.set_lastCommandArgument(l);a.executeCommand({commandName:d.CommandName,commandArgument:d.CommandArgument,path:d.Path,causesValidation:d.CausesValidation,values:c=="Insert"?a._lastArgs.Values:h});a._pendingSelectedEvent=d.CommandName.match(/^(Edit|Select)/)!=h;a._notifyMaster();return}}if(!k){a._pendingSelectedEvent=c.match(/Update|Custom|SQL/);a.set_lastCommandName(h);if(a.get_isModal()&&!a.get_isForm(a._lastViewId))a.endModalState("Cancel");else a.goToView(a._lastViewId)}}a._notifyMaster()}}else{if(j){a._focusCell(-1,-1,g);a._focusCell(j.rowIndex,j.colIndex,e);a._lastFocusedCell=h;a._saveAndNew=g}if(b.ClientScript){b.ClientScript=a.resolveClientUrl(b.ClientScript);eval(b.ClientScript)}a._displayActionErrors(b)}},_displayActionErrors:function(a){if(a.Errors.length==0)return;var b=new Sys.StringBuilder;for(i=0;i<a.Errors.length;i++)b.append(Web.DataView.formatMessage("Attention",a.Errors[i]));Web.DataView.showMessage(b.toString());b.clear()},_busy:function(a){this._isBusy=a;this._enableButtons(!a)},_enableButtons:function(d){for(var b=this._element.getElementsByTagName("button"),c=0;c<b.length;c++){var a=b[c];if(a)if(!d){a.WasDisabled=true;a.disabled=true}else if(a.WasDisabled){a.WasDisabled=false;a.disabled=false}}b=null},_bodyKeydown:function(b){var a=this,c=false;if(a._customFilterField){if(b.keyCode==Sys.UI.Key.enter){c=true;a.applyCustomFilter()}else if(b.keyCode==Sys.UI.Key.esc){c=true;a.closeCustomFilter()}}else if(a.get_lookupField())if(b.keyCode==Sys.UI.Key.esc){c=true;a.hideLookup()}if(c){b.preventDefault();b.stopPropagation()}},_prepareJavaScriptExpressionEx:function(a){return a.replace(/\[((\w+)\.)?(\w+)\]/g,"this.fieldValue('$3','$2')")},_evaluateVisibility:function(){var a=this.get_visibleWhen();if(String.isNullOrEmpty(a))return true;a=this._prepareJavaScriptExpressionEx(a);return eval(a)!=false},_filterSourceSelected:function(c,s,m){var g=true,e=false,a=this;a._hidden=!a._evaluateVisibility();var f=a.readContext("vitals");if(f){var b=0;while(b<f.Filter.length){var k=f.Filter[b],r=k.substring(0,k.indexOf(":")),p=e;if(a._keyFields)for(var h=0;h<a._keyFields.length;h++)if(a._keyFields[h].Name==r){p=g;break}if(p)Array.removeAt(f.Filter,b);else b++}a.writeContext("vitals",f)}var o=[];for(b=0;b<a._externalFilter.length;b++){Array.add(o,a._externalFilter[b].Value);a._externalFilter[b].Value=null}var n=e,l=e;if(Web.DataView.isInstanceOfType(c)){!String.isNullOrEmpty(a._transaction)&&a.set_transaction(c.get_transaction());a._populateExternalViewFilter(c);n=!c.get_showDetailsInListMode()&&c.get_isGrid();if(c._forceChanged)l=g}else if(a._externalFilter.length>0)a._externalFilter[0].Value=c.target.value;a.applyExternalFilter();var j=g,i=e;for(b=0;b<a._externalFilter.length;b++){var q=a._externalFilter[b].Value;if(q!=null)j=e;if(q!=o[b])i=g}a.get_autoHide()!=Web.AutoHideMode.Nothing&&a._updateLayoutContainerVisibility(!j&&!n&&!a._hidden);if(i||l){!m&&a.set_pageIndex(-1);var d=a._position;if(d){d.index=0;d.count=-1;d.key=[];d.keyFilter=[];d.filter=a.get_filter()}if(!m){a._selectedKey=[];a._selectedKeyFilter=[]}a.loadPage()}a.raiseSelected();a.updateSummary()},_createExternalFilter:function(){var a=this;a._externalFilter=[];var d=/(\w+)(,|$)/g;if(a.get_filterFields())for(var c=a.get_filterFields().split(Web.DataView._simpleListRegex),b=0;b<c.length;b++)Array.add(a._externalFilter,{Name:c[b],Value:null})},_populateExternalViewFilter:function(a){if(!(a._selectedKey&&a._keyFields&&a._selectedKey.length==a._keyFields.length))return;for(var e=0;e<this._externalFilter.length;e++){for(var c=this._externalFilter[e],f=false,b=0;b<a._keyFields.length;b++){var d=a._keyFields[b];if(c.Name==d.Name){c.Value=a.convertFieldValueToString(d,a._selectedKey[b]);f=true;break}}if(!f&&this.get_controller()!=a.get_controller())for(b=0;b<a._allFields.length;b++){d=a._allFields[b];if(c.Name==d.Name){c.Value=a.convertFieldValueToString(d,a.get_selectedRow()[a._allFields[b].Index]);f=true;break}}if(!f&&a._selectedKey.length>=e)c.Value=a._selectedKey[e]}},_cloneChangedRow:function(){var a=this;if(a.get_isEditing()){for(var d=a._collectFieldValues(),c=a.get_currentRow(),e=c?Array.clone(c):null,b=0;b<d.length;b++){var g=d[b],f=a.findField(g.Name);if(f)e[f.Index]=g.NewValue}return e}else return a.get_selectedRow()},_updateVisibility:function(){var q="$ActionButtons$",g=true,f=false,a=this;if(!a._expressions)return;a._readOnlyChanged=f;var w=a.get_isForm(),m=[],j=a._cloneChangedRow();if(!j)return;for(var l=f,e=0;e<a._expressions.length;e++){var i=m[0]=a._expressions[e];if(i.Type==Web.DynamicExpressionType.ClientScript)if(i.Scope==Web.DynamicExpressionScope.DataFieldVisibility){var b=a.findField(i.Target);if(b){var c=a._get(w?"_ItemContainer":"Item",b.Index);if(c){var h=a._evaluateJavaScriptExpressions(m,j,f);if(w){var o=Sys.UI.DomElement.getVisible(c);if(Sys.UI.DomElement.containsCssClass(c.parentNode,"FieldPlaceholder"))c=c.parentNode;else if(Sys.UI.DomElement.containsCssClass(c.parentNode.parentNode,"FieldWrapper"))c=c.parentNode.parentNode.parentNode.parentNode;Sys.UI.DomElement.setVisible(c,h==g);if(o!=h)l=g}}}}else if(i.Scope==Web.DynamicExpressionScope.CategoryVisibility){var d=a.findCategory(i.Target);if(d){c=a._get("_Category",d.Index);if(c){h=a._evaluateJavaScriptExpressions(m,j,f)&&(String.isNullOrEmpty(d.Tab)||d.Tab==a._get_selectedTab());o=Sys.UI.DomElement.getVisible(c);Sys.UI.DomElement.setVisible(c,h==g);if(o!=h)l=g;var n=a._get("$CategoryDescription$",d.Index);if(n){var p=a._processTemplatedText(j,d.Description);n.innerHTML=p;n.style.display=String.isNullOrEmpty(p)?"none":"block"}if(l)if(!String.isNullOrEmpty(d.Tab)){var s=Array.indexOf(a._tabs,d.Tab),u=a._get("_Tab",s);if(u){for(var t=g,A=0;e<a.get_categories().length;e++){var r=a.get_categories()[A];if(r!=d&&d.Tab==r.Tab&&Sys.UI.DomElement.getVisible(a._get("_Tab",s))){t=f;break}}t&&Sys.UI.DomElement.setVisible(u,f)}}}}}else if(i.Scope==Web.DynamicExpressionScope.ReadOnly){b=a.findField(i.Target);if(b){if(b.OriginalTextMode==null)b.OriginalTextMode=b.TextMode;var z=b.isReadOnly();h=a._evaluateJavaScriptExpressions(m,j,f);b.TextMode=h==g?4:b.OriginalTextMode;if(h!=z){l=g;a._readOnlyChanged=g}}}}if(a._dynamicActionButtons){a._clonedRow=j;var y=a._get(q,"Top");if(y){var k=new Sys.StringBuilder;a._internalRenderActionButtons(k,"Top",a._lastActionButtonsScope);a._newTopActionButtons=k.toString();k.clear()}var x=a._get(q,"Bottom");if(x){k=new Sys.StringBuilder;a._internalRenderActionButtons(k,"Bottom",a._lastActionButtonsScope);a._newBottomActionButtons=k.toString();k.clear()}window.setTimeout(String.format('$find("{0}")._refreshActionButtons()',a.get_id(),500));a._clonedRow=null}a._updateStatusBar();if(l){a._adjustModalHeight();a._modalPopup&&a._modalPopup.show();_body_performResize()}if(a.get_isEditing())for(e=0;e<a._fields.length;e++){b=a._fields[e];if(!b.ReadOnly&&!b.Hidden&&b.AutoSelect&&b.ItemsStyle=="Lookup"){b.AutoSelect=f;v=j[b.Index];if(v==null){window.setTimeout(String.format('$find("{0}").showLookup({1})',a.get_id(),b.Index),100);break}}}},_refreshActionButtons:function(){var d="$ActionButtons$",a=this,c=a._get(d,"Top");if(c&&a._newTopActionButtons){c.innerHTML=a._newTopActionButtons;a._newTopActionButtons=null}var b=a._get(d,"Bottom");if(b&&a._newBottomActionButtons){b.innerHTML=a._newBottomActionButtons;a._newBottomActionButtons=null}},_updateDynamicValues:function(c){var e=true,a=this;for(var d=false,h=c&&c.Name?c.Name:c,g=0;g<a._allFields.length;g++){var b=a._allFields[g],j=!String.isNullOrEmpty(b.ContextFields);if(j){var i=/\s*(\w+)\s*(=\s*(\w+)\s*)?(,|$)/g,f=i.exec(b.ContextFields);while(f){if(b.ItemsAreDynamic&&(c==null||f[3]==h)){if(!a.get_isEditing()){a.refresh();return e}a._raisePopulateDynamicLookups();d=e}else if(b.Calculated&&f[1]==h){if(!a.get_isEditing()){a.refresh();return e}a._raiseCalculate(b);d=e}if(d)break;f=i.exec(b.ContextFields)}if(d)break}}return d},_valueFocused:function(a){var b=this._allFields[a];this._focusedFieldName=b.Name;Web.DataView._focusedDataViewId=this._id;Web.DataView._focusedItemIndex=a},_copyStaticLookupValues:function(a){if(!String.isNullOrEmpty(a.Copy)&&(a.ItemsStyle=="RadioButtonList"||a.ItemsStyle=="ListBox"||a.ItemsStyle=="DropDownList")){var j=this._collectFieldValues(),b=j[a.Index].NewValue;if(b!=null&&typeof b!="string")b=b.toString();for(var d=null,e=0;e<a.Items.length;e++){var i=a.Items[e],c=i[0];if(c!=null&&typeof c!="string")c=c.toString();if(c==b){d=i;break}}if(d){var h=[],g=/(\w+)=(\w+)/g,k=2,f=g.exec(a.Copy);while(f){Array.add(h,{name:f[1],value:d[k++]});f=g.exec(a.Copy)}this.refresh(true,h);return true}}return false},_replaceFieldValue:function(a){for(var d=this._enumerateExpressions(Web.DynamicExpressionType.RegularExpression,Web.DynamicExpressionScope.Field,a.Name),c=0;c<d.length;c++){var b=d[c];try{if(b.Result.match(/\$(\d|\'\`)/)){var h=this._collectFieldValues(),g=h[a.Index],f=g.NewValue?g.NewValue.toString():null,j=new RegExp(b.Test),e=f.replace(j,b.Result);if(e!=f){var i=[{name:a.Name,value:e}];this.refresh(true,i)}}}catch(k){}}},_valueChanged:function(a){var b=this._allFields[a];this._showFieldError(b,null);window.setTimeout(String.format('var dv=$find("{0}");if(dv && !Web.DataView._navigated)dv._performValueChanged({1},true);',this.get_id(),a),200)},_performValueChanged:function(d,c){var a=this,b=a._allFields[d];if(!b)return;if(a._skipErrorReset){a._skipErrorReset=false;return}else a._showFieldError(b,null);a._replaceFieldValue(b);var e=a._copyStaticLookupValues(b);a._updateVisibility();var f=a._updateDynamicValues(b);if(c&&a._readOnlyChanged&&a.get_isEditing()){a.refresh(true);a._focus()}return e||f||a._readOnlyChanged},_quickFind_focus:function(){var a=this.get_quickFindElement();if(a.value==Web.DataViewResources.Grid.QuickFindText)a.value="";Sys.UI.DomElement.removeCssClass(a,"Empty");Sys.UI.DomElement.removeCssClass(a,"NonEmpty");a.select();this._lostFocus=true},_quickFind_blur:function(){var a=this.get_quickFindElement();if(String.isBlank(a.value)){a.value=Web.DataViewResources.Grid.QuickFindText;Sys.UI.DomElement.addCssClass(a,"Empty")}else Sys.UI.DomElement.addCssClass(a,"NonEmpty");this._lostFocus=false},_executeQuickFind:function(d){var a=this;for(var b=0;b<a._allFields.length;b++)a._allFields[b]._listOfValues=null;for(b=0;b<a._allFields.length;b++){var c=a._allFields[b];if(!c.Hidden){c=a._allFields[c.AliasIndex];if(String.isNullOrEmpty(d)){a.removeFromFilter(c);a.refreshData()}else a.applyFilter(c,"~",d);break}}a._forgetSelectedRow(true)},quickFind:function(b){var a=this,d=(String.isNullOrEmpty(b)?a.get_quickFindElement().value:b).match(/^\s*(.*?)\s*$/),c=d[1]==Web.DataViewResources.Grid.QuickFindText?"":d[1];a.set_quickFindText(c);a._executeQuickFind(c);a._lostFocus=false},_quickFind_keydown:function(b){var a=this;if(b.keyCode==Sys.UI.Key.enter){b.preventDefault();b.stopPropagation();a.quickFind()}else if(b.keyCode==Sys.UI.Key.down){return;if(a.get_isDataSheet()&&a._totalRowCount>0){b.preventDefault();b.stopPropagation();if(!a._get_focusedCell())a._startInputListenerOnCell(0,0);else a._lostFocus=false;var c=a._focusCell(-1,-1,true);c.focus()}}},encodePermalink:function(d,c,b){var a=this;Sys.Net.WebServiceProxy.invoke(a.get_servicePath(),"EncodePermalink",false,{link:d,rooted:false},Function.createDelegate(a,a._encodePermalink_Success),Function.createDelegate(a,a._onMethodFailed),{target:c,features:b})},_encodePermalink_Success:function(b,a){if(a.target||a.features)window.open(b,a.target,a.features);else location.href=b},showViewMessage:function(d){var c=this._get("$HeaderText");if(c!=null){var b=String.format('<div class="MsgBox">{1} <a href="javascript:" onclick="$find(\'{0}\').hideViewMessage()" class="Close" title="{2}">&nbsp;</a></div>',this.get_id(),d,Web.DataViewResources.ModalPopup.Close),a=this.get_view();a.OriginalHeaderText=a.HeaderText;a.HeaderText=b;c.innerHTML=b}},hideViewMessage:function(){var b=this._get("$HeaderText");if(b!=null){var c=this.get_view(),a=c.OriginalHeaderText;c.HeaderText=a;b.innerHTML=this._formatViewText(Web.DataViewResources.Views.DefaultDescriptions[a],true,a)}}};Web.DataView.registerClass("Web.DataView",Sys.UI.Behavior);Web.AutoComplete=function(a){Web.AutoComplete.initializeBase(this,[a])};Web.AutoComplete.prototype={initialize:function(){var a=this;Web.AutoComplete.callBaseMethod(a,"initialize");a._textBoxMouseOverHandler=Function.createDelegate(a,a._onTextBoxMouseOver);a._textBoxMouseOutHandler=Function.createDelegate(a,a._onTextBoxMouseOut);a._completionListItemCssClass="Item";a._highlightedItemCssClass="HighlightedItem"},dispose:function(){var a=this;a._viewPage=null;if(a._element){$removeHandler(a._element,"mouseover",a._textBoxMouseOverHandler);$removeHandler(a._element,"mouseout",a._textBoxMouseOutHandler)}Web.AutoComplete.callBaseMethod(a,"dispose")},get_fieldName:function(){return this._fieldName},set_fieldName:function(a){this._fieldName=a},updated:function(){var a=this,b=document.createElement("div");b.className="AutoCompleteFrame "+a.get_typeCssClass();b.innerHTML=String.format('<table><tr><td class="Input"></td><td class="Clear" style="{2}"><span class="Clear" onclick="var e=this.parentNode.parentNode.getElementsByTagName(\'input\')[0];e.value=\'\';e.focus()" title="{1}">&nbsp;</span></td><td class="Button" onmouseover="if(!Sys.UI.DomElement.containsCssClass(this.parentNode, \'Active\'))$find(\'{0}\')._showDropDown(true)" onmouseout="$find(\'{0}\')._showDropDown(false)"><span class="Button" onclick="$find(\'{0}\')._showFullList();">&nbsp;</span></td></tr></table>',a.get_id(),Web.DataViewResources.Data.Filters.Labels.Clear,a.get_contextKey().match(/^(SearchBar|Filter)\:/)!=null?"":"display:none");a._element.setAttribute("autocomplete","off");a._element.parentNode.insertBefore(b,a._element);b.getElementsByTagName("td")[0].appendChild(a._element);if(Sys.Browser.agent==Sys.Browser.WebKit)b.style.marginLeft="2px";if(a._completionSetCount==10)a._completionSetCount=100;$addHandler(a._element,"mouseover",a._textBoxMouseOverHandler);$addHandler(a._element,"mouseout",a._textBoxMouseOutHandler);Web.AutoComplete.callBaseMethod(a,"updated");document.body.appendChild(a._completionListElement);a._completionListElement.className="CompletionList AutoComplete";a._completionListElement.style.display="none"},_showCachedFullList:function(){this._update("%",this._cache["%"],false)},_showFullList:function(){var a=this;if(a._webRequest)return;var c=a._popupBehavior.get_visible();a._hideCompletionList();a._element.focus();if(c)return;a._completionWord="%";if(a._cache&&a._cache["%"]){window.setTimeout(String.format('$find("{0}")._showCachedFullList()',a.get_id()),50);return}var b={prefixText:a._completionWord,count:a._completionSetCount};if(a._useContextKey)b.contextKey=a._contextKey;a._ignoreCompletionWord=true;a._invoke(b,a._completionWord)},_showDropDown:function(c){var b="Active",a=this._element;while(a.tagName!="TR")a=a.parentNode;if(c)Sys.UI.DomElement.addCssClass(a,b);else if(this._textBoxHasFocus)Sys.UI.DomElement.addCssClass(a,b);else Sys.UI.DomElement.removeCssClass(a,b)},_onKeyDown:function(a){var c=this;if(a.keyCode==Sys.UI.Key.down&&a.altKey){a.preventDefault();a.stopPropagation();c._showFullList()}var d=c._popupBehavior._visible;Web.AutoComplete.callBaseMethod(c,"_onKeyDown",[a]);if(a.keyCode==Sys.UI.Key.enter||a.keyCode==Sys.UI.Key.esc){var b=c._get_fieldDataView(true);if(b)if(b.get_isDataSheet()&&d){a.preventDefault();a.stopPropagation()}else if(b.get_searchBarIsVisible()){a.preventDefault();a.stopPropagation();!d&&window.setTimeout(String.format("$find('{0}')._performSearch()",b.get_id()),100)}}},_update:function(h,f,g){var b=this;Web.AutoComplete.callBaseMethod(b,"_update",[h,f,g]);if(f){for(var a=-1,e=b._currentCompletionWord().toLowerCase(),c=0;c<f.length;c++){var d=f[c];if(d!=null){d=d.toLowerCase();if(a==-1&&d.startsWith(e))a=c;if(d==e){a=c;break}}}if(a>=0&&a<b._completionListElement.childNodes.length){b._selectIndex=a;e=b._completionListElement.childNodes[a];b._highlightItem(e);b._handleScroll(e,a+5)}}},_get_fieldDataView:function(c){var b=null,a=this._get_contextInfo();if(a&&(a.type=="Field"||c&&a.type=="SearchBar"))b=Web.DataView.find(a.controller);return b},_setText:function(n){var b=this;Web.AutoComplete.callBaseMethod(b,"_setText",[n]);b._updateClearButton();var h=b._get_fieldDataView();if(h){var e=h.findField(b.get_fieldName()),m=b.get_element().value,d=[];if(m!=Web.DataViewResources.Data.NullValueInForms){var k=b._enumerateViewPageItems(m);if(k!=-1){for(var c=b._viewPage,l=c.Rows[k],g=[],a=0;a<c.Fields.length;a++){var i=c.Fields[a];i.Name==e.ItemsDataValueField&&Array.add(g,i)}if(g.length==0)for(a=0;a<c.Fields.length;a++){i=c.Fields[a];if(i.IsPrimaryKey){Array.add(g,i);break}}for(a=0;a<g.length;a++){var o=l[g[0].Index];Array.add(d,o)}}}$get(h.get_id()+"_Item"+e.Index).value=d.toString();b._originalElementText=b.get_element().value;if(b._get_isInLookupMode()){if(!String.isNullOrEmpty(e.Copy)){d=[];var j=/(\w+)=(\w+)/g,f=j.exec(e.Copy);while(f){if(f[2]=="null")Array.add(d,{name:f[1],value:null});else for(a=0;a<c.Fields.length;a++)c.Fields[a].Name==f[2]&&Array.add(d,{name:f[1],value:l[a]});f=j.exec(e.Copy)}h.refresh(true,d)}h._valueChanged(e.Index)}}},_get_isInLookupMode:function(){var a=this._get_contextInfo();return a!=null&&a.type=="Field"},_updateClearButton:function(){var a="Filtered",b=this._element.parentNode.parentNode;if(!String.isBlank(this._element.value))Sys.UI.DomElement.addCssClass(b,a);else Sys.UI.DomElement.removeCssClass(b,a)},_onGotFocus:function(c){var a=this;Web.AutoComplete.callBaseMethod(a,"_onGotFocus",[c]);a._showDropDown(true);a._updateClearButton();if(a._get_isInLookupMode()){var b=a.get_element();a._originalElementText=b.value;if(a._originalElementText==Web.DataViewResources.Data.NullValueInForms){b.value="";b.select()}}},_onLostFocus:function(b){var a=this;Web.AutoComplete.callBaseMethod(a,"_onLostFocus",[b]);a._showDropDown(false);a._updateClearButton();if(a._get_isInLookupMode()&&a._originalElementText!=null)a.get_element().value=a._originalElementText},_onTextBoxMouseOver:function(){this._showDropDown(true)},_onTextBoxMouseOut:function(){this._showDropDown(false)},_currentCompletionWord:function(){var a=this;if(a._completionWord){var b=a._completionWord;a._completionWord=null;return b}return Web.AutoComplete.callBaseMethod(a,"_currentCompletionWord")},_onTimerTick:function(e,c){var a=this;a._timer.set_enabled(false);if(a._servicePath&&a._serviceMethod){var b=a._currentCompletionWord();if(b.trim().length<a._minimumPrefixLength){a._currentPrefix=null;a._update("",null,false);return}if(a._currentPrefix!==b||b==""&&a._minimumPrefixLength==0){a._currentPrefix=b;if(b!=""&&a._cache&&a._cache[b]){a._update(b,a._cache[b],false);return}c=new Sys.CancelEventArgs;a.raisePopulating(c);if(c.get_cancel())return;var d={prefixText:a._currentPrefix,count:a._completionSetCount};if(a._useContextKey)d.contextKey=a._contextKey;if(a._webRequest){a._webRequest.get_executor().abort();a._webRequest=null}a._invoke(d,b);$common.updateFormToRefreshATDeviceBuffer()}}},_get_contextInfo:function(){var a=this.get_contextKey().match(/^(\w+)\:(\w+),(\w+)$/);return a?{type:a[1],controller:a[2],fieldName:a[3]}:null},_invoke:function(p,n){var d=null,a=this,f=a._get_contextInfo();if(f){var b=Web.DataView.find(f.controller),e=[],m=f.fieldName;if(f.type=="SearchBar")e=b._createSearchBarFilter(true);else if(f.type=="Filter")e=b.get_filter();else{var g=b.findField(a.get_fieldName());m=!String.isNullOrEmpty(g.ItemsDataTextField)?g.ItemsDataTextField:g.Name}if(!a._ignoreCompletionWord){for(var h=0;h<e.length;h++){var q=e[h].match(/^(\w+):/);if(q[1]==f.fieldName){Array.removeAt(e,h);break}}Array.add(e,String.format("{0}:$beginswith${1}\0",m,a._currentCompletionWord()))}var l=d,i=d,j=d;if(f.type=="Field"){i=g.ItemsDataController;j=g.ItemsDataView;var c={FieldName:g.Name,Controller:b.get_controller(),View:b.get_viewId()},k=b.get_contextFilter(g);for(h=0;h<k.length;h++){var o=k[h];Array.add(e,String.format("{0}:={1}\0",o.Name,o.Value))}l={PageIndex:0,RequiresMetaData:true,RequiresRowCount:false,PageSize:300,SortExpression:g.ItemsDataTextField,Filter:e,ContextKey:b.get_id(),Cookie:b.get_cookie(),FilterIsExternal:k.length>0,Transaction:b.get_transaction(),LookupContextFieldName:c?c.FieldName:d,LookupContextController:c?c.Controller:d,LookupContextView:c?c.View:d,LookupContext:c,View:b.get_viewId(),Tag:b.get_tag()}}else{i=b.get_controller();j=b.get_viewId();l={FieldName:f.fieldName,Filter:e,LookupContextFieldName:c?c.FieldName:d,LookupContextController:c?c.Controller:d,LookupContextView:c?c.View:d,AllowFieldInFilter:a._ignoreCompletionWord!=true,Controller:i,View:j,Tag:b.get_tag()}}a._webRequest=b._invoke(a.get_serviceMethod(),{controller:i,view:j,request:l},Function.createDelegate(a,f.type=="Field"?a._onGetPageComplete:a._onGetListOfValuesComplete),n);a._ignoreCompletionWord=false}else a._webRequest=Sys.Net.WebServiceProxy.invoke(a.get_servicePath(),a.get_serviceMethod(),false,p,Function.createDelegate(a,a._onMethodComplete),Function.createDelegate(a,a._onMethodFailed),n)},_onGetListOfValuesComplete:function(a,b){if(a.length>0&&a[0]==null)a[0]=Web.DataViewResources.HeaderFilter.EmptyValue;this._webRequest=null;this._update(b,a,true)},_onGetPageComplete:function(c,b){this._viewPage=c;var a=this._enumerateViewPageItems();this._onGetListOfValuesComplete(a,b)},_enumerateViewPageItems:function(f){for(var c=this._viewPage,i=this._get_fieldDataView(),g=i.findField(this.get_fieldName()),d=[],a=0;a<c.Fields.length;a++){var b=c.Fields[a];b.Index=a;b.Name==g.ItemsDataTextField&&Array.add(d,b)}if(d.length==0)for(a=0;a<c.Fields.length;a++){b=c.Fields[a];if(!b.Hidden&&b.Type=="String"){Array.add(d,b);break}}if(d.length==0)for(a=0;a<c.Fields.length;a++){b=c.Fields[a];if(!b.Hidden){Array.add(b);break}}var e=[];g.AllowNulls&&Array.add(e,Web.DataViewResources.Data.NullValueInForms);for(a=0;a<c.Rows.length;a++){var h=c.Rows[a][d[0].Index];if(f!=null){if(h==f)return a}else Array.add(e,h)}return f!=null?-1:e},get_typeCssClass:function(){return this._typeCssClass},set_typeCssClass:function(a){this._typeCssClass=a}};Web.DataView.hideMessage=function(){Web.DataView.showMessage()};Web.DataView.formatMessage=function(b,a){return String.format('<table cellpadding="0" cellspacing="0" ><tr><td class="{0}" valign="top">&nbsp;</td><td class="Message">{1}</td></tr></table>',b,a)};Web.DataView.showMessage=function(b){var f="DataView_MessageBar",c=null;if(String.isBlank(b))b=c;var d=document.getElementsByTagName("body")[0],k=false;if(!Web.DataView.MessageBar){var a=document.createElement("div");a.id=f;d.appendChild(a);Sys.UI.DomElement.setVisible(a,false);Sys.UI.DomElement.addCssClass(a,"MessageBar");Web.DataView.MessageBar=$create(AjaxControlToolkit.AlwaysVisibleControlBehavior,{VerticalOffset:AjaxControlToolkit.VerticalSide.Top},c,c,a);var e=Sys.UI.DomElement.getBounds(d);if(e.y<0)e.y=0;Web.DataView.OriginalBodyTopOffset=e.y}a=$get(f);var i=Sys.UI.DomElement.getVisible(a);a.innerHTML=b?String.format('<div>{0}</div><div class="Stub"></div>',b):"";Sys.UI.DomElement.setVisible(a,b!=c);var j=Sys.UI.DomElement.getBounds(a),h=b?Web.DataView.OriginalBodyTopOffset+j.height:Web.DataView.OriginalBodyTopOffset;d.style.paddingTop=h+"px";var g=$get("Membership_Login");if(g)g.style.marginTop=h+"px";Sys.UI.DomElement.getVisible(a)!=i&&_body_performResize()};Web.DataView._tagsWithIndexes=["A","AREA","BUTTON","INPUT","OBJECT","SELECT","TEXTAREA","IFRAME"];Web.DataView._delayedLoadingViews=[];Web.DataView._performDelayedLoading=function(){var b=0;while(b<Web.DataView._delayedLoadingViews.length){var a=Web.DataView._delayedLoadingViews[b];if(a.get_isDisplayed()){Array.remove(Web.DataView._delayedLoadingViews,a);a._delayedLoading&&a._loadPage()}else b++}};Web.DataView.find=function(d){for(var e="_"+d,c=Sys.Application.getComponents(),b=0;b<c.length;b++){var a=c[b];if(a._id==d||Web.DataView.isInstanceOfType(a)&&a._id.endsWith(e))return a}return null};Web.DataView.showModal=function(c,i,m,o,n,j,h,p,a){var g=Web.DataView.isInstanceOfType(c),e=c;if(g&&c._container)e=c._container.getElementsByTagName("a")[0];if(!e)for(var k=document.getElementsByTagName("a","input","button"),f=k.length-1;f>=0;f--)if(k[f].tabIndex>=0){e=k[f];break}if(e==null){alert("Cannot find an anchor for a modal popup.");return}Web.HoverMonitor._instance.close();if(!j)j=Web.DataView._baseUrl;if(!h)h=Web.DataView._servicePath;var d=this._placeholder=document.createElement("div");d.id=String.format("{0}_{1}_Placeholder{2}",i,m,Sys.Application.getComponents().length);if(g)c._appendModalPanel(d);else document.body.appendChild(d);d.className="ModalPlaceholder FixedDialog EmptyModalDialog";var b={id:i+"_ModalDataView"+Sys.Application.getComponents().length,baseUrl:j,servicePath:h,controller:i,viewId:m,showActionBar:false,modalAnchor:e,startCommandName:o,startCommandArgument:n,exitModalStateCommands:["Cancel"],externalFilter:p};if(a){b.filter=a.filter;b.ditto=a.ditto;b.lastViewId=a.lastViewId;b.transaction=a.transaction;b.filterSource=a.filterSource;b.filterFields=a.filterFields;b.confirmContext=a.confirmContext;b.showSearchBar=a.showSearchBar}var l=$create(Web.DataView,b,null,null,d);if(g)l._parentDataViewId=c.get_id();return l};Web.DataView._resizeInterval=null;Web.DataView._resizing=false;Web.DataView._resized=false;function _body_hideLayoutContainers(){if(!Web.DataView._layoutContainers)return;for(var a=0;a<Web.DataView._layoutContainers.length;a++){var b=Web.DataView._layoutContainers[a];b.width!="100%"&&Sys.UI.DomElement.setVisible($get(b.id),false)}}function _body_resizeLayoutContainers(){var c=Web.DataView._layoutContainers;if(!c||c.length==0)return;var h=$get("PageContent"),g=$common.getBounds(h),n=$common.getPaddingBox(h),o=$common.getBorderBox(h),p=$common.getMarginBox(h);g.width-=n.horizontal+o.horizontal+p.horizontal;var f=c[c.length-1].rowIndex;while(f>=c[0].rowIndex){for(var l=0,e=0;e<c.length;e++){var b=c[e];if(b.rowIndex==f&&!String.isNullOrEmpty(b.width)){var a=$get(b.id);if(a){var i=$common.getPaddingBox(a),j=$common.getBorderBox(a),k=$common.getMarginBox(a),m=b.width.match(/(\d+)(%|px|)/),d=m[2]!="%"?parseFloat(m[1]):Math.floor(g.width*parseFloat(m[1])/100);l+=d;d-=i.horizontal+j.horizontal+k.horizontal;if(b.width!="100%"){a.style.width=d+"px";Sys.UI.DomElement.setVisible(a,true)}else{Sys.UI.DomElement.removeCssClass(a,"LayoutContainer");Sys.UI.DomElement.addCssClass(a,"RowContainer")}}}}if(l<g.width)for(e=0;e<c.length;e++){b=c[e];if(b.rowIndex==f&&String.isNullOrEmpty(b.width)){a=$get(b.id);if(a){i=$common.getPaddingBox(a);j=$common.getBorderBox(a);k=$common.getMarginBox(a);d=Math.floor((g.width-l)/b.peersWithoutWidth);d-=i.horizontal+j.horizontal+k.horizontal;if(d<1)d=1;a.style.width=d+"px";Sys.UI.DomElement.setVisible(a,true)}}}f--}}function _body_keydown(c){if(c.keyCode==Sys.UI.Key.enter&&Web.DataView._focusedItemIndex!=null){var a=$find(Web.DataView._focusedDataViewId);if(a&&a._get_focusedCell())return;var b=$get(Web.DataView._focusedDataViewId+"_Item"+Web.DataView._focusedItemIndex);if(b&&b.tagName=="INPUT"&&b.type=="text"&&b==c.target){c.preventDefault();c.stopPropagation();a=$find(Web.DataView._focusedDataViewId);a&&a._valueChanged(Web.DataView._focusedItemIndex)}}}function _body_resize(){Web.DataView._resizeInterval&&window.clearInterval(Web.DataView._resizeInterval);if(!Web.DataView._resizing&&!Web.DataView._resized){Web.DataView._resizeInterval=window.setInterval("_body_performResize()",10);_body_hideLayoutContainers();_body_resizeLayoutContainers()}else $closeHovers();Web.DataView._resized=false}function _body_scroll(){var a=$getSideBar();if(!a)return;var b=$common.getScrolling(),e=$common.getClientBounds(),c=$common.getBounds(a);if(a._originalTop==null)a._originalTop=c.y;var f=a._originalTop,d=0;if(Web.DataView.MessageBar){var g=$common.getBounds(Web.DataView.MessageBar._element);f+=d=g.height}if(b.y>a._originalTop&&c.height+4<=e.height&&b.x==0){a.style.width=c.width+"px";if(Sys.Browser.agent==Sys.Browser.InternetExplorer&&Sys.Browser.version<=6){a.style.top=4+b.y+d+"px";a.style.position="absolute"}else{a.style.top=4+d+"px";a.style.position="fixed"}}else{a.style.top="";a.style.width="";a.style.position=""}}function _body_createPageContext(c){var a=$get("PageContent");if(!a)return;var f=$common.getBounds(a),e=$common.getPaddingBox(a),d=$common.getBorderBox(a),b={height:f.height-e.vertical-d.vertical,scrolling:$common.getScrolling()};if(c!=false)Web.DataView._pageContext=b;return b}function _body_performResize(){var b="px";Web.DataView._resizeInterval&&window.clearInterval(Web.DataView._resizeInterval);Web.DataView._resizeInterval=null;$closeHovers();var a=$get("PageContent");if(!a)return;var h=$common.getClientBounds(),r=$common.getClientBounds();if(Web.DataView.MessageBar){var c=Web.DataView.MessageBar._element;if($common.getVisible(c)){var g=$common.getPaddingBox(c);c.style.width=r.width-g.horizontal+b;var e=c.childNodes[0];e.style.height="";var s=$common.getBounds(e),i=Math.ceil(h.height*.15);if(s.height>i){e.style.height=i+b;e.style.overflow="auto"}g=Sys.UI.DomElement.getBounds(c);var l=Web.DataView.OriginalBodyTopOffset+g.height;document.body.style.paddingTop=l+b;var j=$get("Membership_Login");if(j)j.style.marginTop=l+b}}Web.DataView._resizing=true;var d=Web.DataView._pageContext;if(d==null)d=_body_createPageContext(false);else Web.DataView._pageContext=null;var k=$common.getScrolling();if(k.y==0)a.style.height="10px";_body_resizeLayoutContainers();if(typeof __cothost=="undefined"){var o=$common.getBounds(a),m=$common.getPaddingBox(a),n=$common.getBorderBox(a),q=$get("PageFooterContent"),p=$get("PageFooterBar"),f=k.y+h.height-o.y-(p?p.offsetHeight:0)-(q?q.offsetHeight:0)-n.vertical-m.vertical;if(o.height<f)if(Sys.Browser.agent==Sys.Browser.Firefox||Sys.Browser.agent==Sys.Browser.Opera)f+=n.vertical+m.vertical;if(d.scrolling.y==0||Web.DataView._numberOfContainers<2)a.style.height=document.body.offsetHeight>h.height?"":f+b;else{a.style.height=d.height+b;window.scrollTo(0,d.scrolling.y)}}_body_scroll();Web.DataView._resizing=false;Web.DataView._resized=true}Web.DataView._activate=function(b,l,e){var j="Selected",i="CloseSiteAction",h="SideBarTask",p=new RegExp("^\\s*"+e+"\\s*\\|"),a=$get(l);if(e==h){var d=a;while(d&&String.isNullOrEmpty(d.getAttribute("factory:flow")))d=d.parentNode;for(var g=d.getElementsByTagName("div"),c=0;c<g.length;c++){var k=g[c].getAttribute("factory:activator");!String.isNullOrEmpty(k)&&p.exec(k)&&Sys.UI.DomElement.setVisible(g[c],false)}}Sys.UI.DomElement.setVisible(a,e==h?true:!Sys.UI.DomElement.getVisible(a));a._activated=true;if(e=="SiteAction"&&a.childNodes[0].className!=i){var f=document.createElement("div");f.className=i;f.innerHTML=String.format("<a href=\"javascript:\" onclick=\"Web.DataView._activate(null,'{0}','SiteAction')\">{1}</a>",l,Web.DataViewResources.ModalPopup.Close);a.insertBefore(f,a.childNodes[0])}if(Sys.UI.DomElement.getVisible(a)){var n=$common.getBounds(a),q=$common.getClientBounds(),m=$common.getScrolling();(n.y<m.y||n.y>m.y+q.height)&&a.scrollIntoView(false)}if(b){while(b&&!Sys.UI.DomElement.containsCssClass(b,"Task"))b=b.parentNode;for(c=0;c<b.parentNode.childNodes.length;c++){var o=b.parentNode.childNodes[c];o.className&&Sys.UI.DomElement.removeCssClass(o,j)}Sys.UI.DomElement.addCssClass(b,j)}_body_performResize()};Web.DataView._partialUpdateBeginRequest=function(i,g){for(var f=g.get_request(),d=Sys.Application.getComponents(),b=[],c=0;c<d.length;c++){var a=d[c];if(a._controller&&a._viewId&&Web.DataView.isInstanceOfType(a)){var e=a.get_tag();if(!String.isNullOrEmpty(e)){Array.add(b,e);Array.add(b,a.get_selectedKey())}}}var h=Sys.Serialization.JavaScriptSerializer.serialize(b);f.set_body(f.get_body()+"&"+encodeURIComponent("__WEB_DATAVIEWSTATE")+"="+encodeURIComponent(h))};Web.DataView._load=function(){var C="factory:hidden",t="factory:description",n=null,m=false,l="div",h=true;if(Web.DataView._loaded)return;Sys.WebForms&&Sys.WebForms.PageRequestManager._instance&&Sys.WebForms.PageRequestManager._instance.add_beginRequest(Web.DataView._partialUpdateBeginRequest);Web.DataView._loaded=h;updateACT();var I=$get("PageContent");if(I){for(var k=document.body.getElementsByTagName(l),b=0;b<k.length;b++)if(k[b].className.match(/Loading/)){Sys.UI.DomElement.removeCssClass(k[b],"Loading");break}k=I.getElementsByTagName(l);var e=[],v=0,B=m,s=m,g=n,u=[];Web.DataView._numberOfContainers=0;for(b=0;b<k.length;b++){var d=k[b],w=d.getAttribute("factory:width"),H=d.getAttribute("factory:flow");if(!String.isNullOrEmpty(w)||!String.isNullOrEmpty(H)){if(H!="NewColumn"){d.style.clear="left";v++}if(String.isNullOrEmpty(d.id))d.id="_lc"+e.length;Sys.UI.DomElement.addCssClass(d,"LayoutContainer");Web.DataView._numberOfContainers++;if(w!="100%")d.style.overflow="hidden";Array.add(e,{id:d.id,width:w,rowIndex:v,peersWithoutWidth:0});for(var E=d.getElementsByTagName(l),f=[],c=0;c<E.length;c++){var i=E[c],D=i.getAttribute("factory:activator");if(!String.isNullOrEmpty(D)){i.id=String.isNullOrEmpty(i.id)?d.id+"$a"+c:i.id;var a={elem:i,activator:D.split("|"),id:i.id};a.activator[0]=a.activator[0].trim();if(a.activator.length==1)a.activator[1]=c.toString();Array.add(f,a)}}c=1;while(c<f.length){a=f[c];for(var z=0;z<c;z++){var y=f[z];if(y.activator[0]==a.activator[0]&y.activator[1]==a.activator[1]){while(a.elem.childNodes.length>0)y.elem.appendChild(a.elem.childNodes[0]);delete a.elem;Array.removeAt(f,c);a=n;break}}if(a)c++}if(f.length>0){B=h;var j=[],r=h;for(c=0;c<f.length;c++){a=f[c];if(a.activator[0]=="Tab"){if(j.length==0){var o=document.createElement(l);o.className="TabBar";d.insertBefore(o,a.elem)}var J={title:a.activator[1],elementId:a.id,selected:j.length==0,description:a.elem.getAttribute(t),hidden:a.elem.getAttribute(C)};Array.add(j,J);Sys.UI.DomElement.setVisible(a.elem,J.selected);a.elem._activated=h;Sys.UI.DomElement.addCssClass(a.elem,"TabBody TabContainer")}else if(a.activator[0]=="SideBarTask"){if(!g){g=new Sys.StringBuilder;g.appendFormat('<div class="TaskBox TaskList"><div class="Inner"><div class="Header">{0}</div>',Web.DataViewResources.Menu.Tasks)}a.elem._activated=r;if(r)r=m;Sys.UI.DomElement.setVisible(a.elem,a.elem._activated);g.appendFormat("<div class=\"Task{1}\"{4}><a href=\"javascript:\" onclick=\"Web.DataView._activate(this,'{2}','SideBarTask');return false;\" title='{3}'>{0}</a></div>",a.activator[1],!s?" Selected":"",a.id,Web.DataView.htmlAttributeEncode(a.elem.getAttribute(t)),a.elem.getAttribute(C)=="true"?' style="display:none"':"");s=h}else if(a.activator[0]=="SiteAction"&&Web.Menu.get_siteActionsFamily()){var x=new Web.Item(Web.Menu.get_siteActionsFamily(),a.activator[1],a.elem.getAttribute(t));x.set_cssClass(a.elem.getAttribute("factory:cssClass"));x.set_script('Web.DataView._activate(null,"{0}","SiteAction")',a.id);Array.add(u,x);Sys.UI.DomElement.setVisible(a.elem,m)}else Sys.UI.DomElement.setVisible(a.elem,m);a.elem=n}if(j.length>0){$create(Web.Menu,{id:d.id+"$ActivatorMenu",nodes:j},n,n,o);j.length<2&&b==0&&Sys.UI.DomElement.addCssClass(o,"EmptyTabBar")}}}}B&&Web.DataView._performDelayedLoading();if(s&&g){var p=$getSideBar();if(p){g.append("</div></div>");var G=document.createElement(l);G.innerHTML=g.toString();g.clear();p.insertBefore(G,p.childNodes[0]);p._hasActivators=h}}u.length>0&&Web.Menu.set_siteActions(u);var q=v;while(e.length>0&&q>=e[0].rowIndex){var A=0,F=0;for(b=0;b<e.length;b++){lc=e[b];if(lc.rowIndex==q){F++;if(String.isNullOrEmpty(lc.width))A++}}for(b=0;b<e.length;b++){lc=e[b];if(lc.rowIndex==q){lc.peersWithoutWidth=A;if(F==1&&String.isNullOrEmpty(lc.width))lc.width="100%"}}q--}Web.DataView._layoutContainers=e;_body_performResize();$addHandler(window,"resize",_body_resize);$addHandler(window,"scroll",_body_scroll)}Web.DataView._startDelayedLoading();$addHandler(document.body,"keydown",_body_keydown)};Web.DataView._unload=function(){if(this._state){Array.clear(this._state);delete this._state}if(Web.DataView._delayedLoadingTimer){window.clearInterval(Web.DataView._delayedLoadingTimer);Array.clear(Web.DataView._delayedLoadingViews);delete Web.DataView._delayedLoadingViews}if($get("PageContent")){$removeHandler(window,"resize",_body_resize);$removeHandler(window,"scroll",_body_scroll)}$removeHandler(document.body,"keydown",_body_keydown)};Web.DataView._startDelayedLoading=function(){if(Web.DataView._delayedLoadingViews.length>0&&!Web.DataView._delayedLoadingTimer)Web.DataView._delayedLoadingTimer=window.setInterval("Web.DataView._performDelayedLoading()",1e3)};Web.DataView._updateBatchSelectStatus=function(c,e){var b="BatchEditFrame",d=e?"Item":"Cell",a=c.parentNode;while(a!=null&&!Sys.UI.DomElement.containsCssClass(a,d))a=a.parentNode;if(a)if(c.checked)Sys.UI.DomElement.addCssClass(a,b);else Sys.UI.DomElement.removeCssClass(a,b)};Web.DataView.highlightFilterValues=function(a,c,b){while(a&&a.tagName!="TABLE")a=a.parentNode;if(a)if(c&&!a.className.match(b))Sys.UI.DomElement.addCssClass(a,b);else!c&&a.className.match(b)&&Sys.UI.DomElement.removeCssClass(a,b)};Web.DataView.get_commandLine=function(){var b="undefined",a=Web.DataView._commandLine;if(!a){if(typeof __dacl!=b)a=__dacl;if(!a){a=typeof Web.Membership!=b?Web.Membership._instance.get_commandLine():null;a=!a?location.href:location.pathname+"?"+a}Web.DataView._commandLine=a}return a};Web.DataView.DetailsRegex=/\/Details\.aspx\?/i;Web.DataView.LocationRegex=/^(_.+?):(.+)$/;Web.DataView.LEVs=[];Web.DataView.Editors=[];Sys.Application.add_load(Web.DataView._load);Sys.Application.add_unload(Web.DataView._unload);function $createDataView(e,c,a){var d={id:c+"Extender",controller:c,baseUrl:"./",servicePath:"Services/DataControllerService.asmx"};if(a)for(var b=0;b<a.length;b++)d[a[b].name]=a[b].value;$create(Web.DataView,d,null,null,$get(e))}function updateACT(){var a="px";if(Sys.Extended&&typeof AjaxControlToolkit=="undefined")AjaxControlToolkit=Sys.Extended.UI;Web.AutoComplete.registerClass("Web.AutoComplete",AjaxControlToolkit.AutoCompleteBehavior);var b=Sys.CultureInfo.CurrentCulture.dateTimeFormat;Web.DataView.dateFormatStrings={"{0:g}":b.ShortDatePattern+" "+b.ShortTimePattern,"{0:G}":b.ShortDatePattern+" "+b.LongTimePattern,"{0:f}":b.LongDatePattern+" "+b.ShortTimePattern,"{0:u}":b.SortableDateTimePattern,"{0:U}":b.UniversalSortableDateTimePattern};Sys.Browser.WebKit={};if(navigator.userAgent.indexOf("WebKit/")>-1){Sys.Browser.agent=Sys.Browser.WebKit;Sys.Browser.version=parseFloat(navigator.userAgent.match(/WebKit\/(\d+(\.\d+)?)/)[1]);Sys.Browser.name="WebKit"}$common.getScrolling=function(){var a=0,b=0;if(window.pageYOffset){b=window.pageYOffset;a=window.pageXOffset}else if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){b=document.body.scrollTop;a=document.body.scrollLeft}else if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){b=document.documentElement.scrollTop;a=document.documentElement.scrollLeft}return new Sys.UI.Point(a,b)};if(!(Sys.Browser.agent==Sys.Browser.InternetExplorer||Sys.Browser.agent==Sys.Browser.Firefox||Sys.Browser.agent==Sys.Browser.Opera)&&!Sys.Extended){$common.old_getBounds=$common.getBounds;$common.getBounds=function(c){var b=$common.old_getBounds(c),a=$common.getScrolling();if(a.y||a.x){b.x+=a.x;b.y+=a.y}return b}}if(AjaxControlToolkit.CalendarBehavior&&!AjaxControlToolkit.CalendarBehavior.prototype.old_show){AjaxControlToolkit.CalendarBehavior.prototype.old_show=AjaxControlToolkit.CalendarBehavior.prototype.show;AjaxControlToolkit.CalendarBehavior.prototype.show=function(){var c=this;c.old_show();c._container.style.zIndex=100100;var b=c._element;while(b&&b.nodeName!="DIV")b=b.parentNode;b=b.nextSibling;var e=b&&Sys.UI.DomElement.containsCssClass(b,"Error")&&Sys.UI.DomElement.getVisible(b),d=$common.getBounds(c._container),f=$common.getBounds(c._element);if(e)c._container.style.top=f.y-d.height+3+a};AjaxControlToolkit.CalendarBehavior.prototype.old_raiseDateSelectionChanged=AjaxControlToolkit.CalendarBehavior.prototype.raiseDateSelectionChanged;AjaxControlToolkit.CalendarBehavior.prototype.raiseDateSelectionChanged=function(){this.old_raiseDateSelectionChanged();this._element.focus()}}if(AjaxControlToolkit.TabContainer&&!AjaxControlToolkit.TabContainer.prototype.old_set_activeTabIndex){AjaxControlToolkit.TabContainer.prototype.old_set_activeTabIndex=AjaxControlToolkit.TabContainer.prototype.set_activeTabIndex;AjaxControlToolkit.TabContainer.prototype.set_activeTabIndex=function(a){var b=this.get_activeTabIndex();this.old_set_activeTabIndex(a);a!=b&&_body_performResize()}}if(AjaxControlToolkit.AutoCompleteBehavior&&!AjaxControlToolkit.AutoCompleteBehavior.prototype.old_dispose){AjaxControlToolkit.AutoCompleteBehavior.prototype.old_dispose=AjaxControlToolkit.AutoCompleteBehavior.prototype.dispose;AjaxControlToolkit.AutoCompleteBehavior.prototype.dispose=function(){var a=this;a.old_dispose();if(a._completionListElement){a._completionListElement.parentNode.removeChild(a._completionListElement);delete a._completionListElement}};AjaxControlToolkit.AutoCompleteBehavior.prototype.old__handleFlyoutFocus=AjaxControlToolkit.AutoCompleteBehavior.prototype._handleFlyoutFocus;AjaxControlToolkit.AutoCompleteBehavior.prototype._handleFlyoutFocus=function(){if(!this._completionListElement)return;this.old__handleFlyoutFocus()};AjaxControlToolkit.AutoCompleteBehavior.prototype.old_showPopup=AjaxControlToolkit.AutoCompleteBehavior.prototype.showPopup;AjaxControlToolkit.AutoCompleteBehavior.prototype.showPopup=function(){var b=this;b.old_showPopup();if(Sys.UI.DomElement.getVisible(b._completionListElement)){var h=$common.getScrolling();b._completionListElement.style.height="";Sys.UI.DomElement.addCssClass(b._completionListElement,"CompletionList");b._completionListElement.style.width="";b._completionListElement.style.zIndex=200100;var e=$common.getClientBounds(),c=$common.getBounds(b._completionListElement);if(c.width>e.width/3)c.width=e.width/3;var f=b._element;if(Sys.UI.DomElement.containsCssClass(f.parentNode,"Input"))while(!Sys.UI.DomElement.containsCssClass(f.parentNode,"AutoCompleteFrame"))f=f.parentNode;var d=$common.getBounds(f),k=$common.getBorderBox(b._completionListElement),j=$common.getPaddingBox(b._completionListElement);if(c.width<=d.width)b._completionListElement.style.width=d.width-k.horizontal-j.horizontal+a;c=$common.getBounds(b._completionListElement);if(c.x!=d.x){c.x=d.x;b._completionListElement.style.left=c.x+a}if(c.y!=d.y){c.y=d.y+d.height-1;b._completionListElement.style.top=c.y+a}if(c.x+c.width>e.width)b._completionListElement.style.left=e.width-c.width+a;bound=$common.getBounds(b._completionListElement);var g=d.y-h.y,i=e.height-(d.y+d.height-h.y);if(bound.height<=i||i>=g){if(c.y+c.height-h.y>e.height){b._completionListElement.style.height=e.height-(c.y-h.y)-4+a;b._completionListElement.style.overflow="auto"}}else if(g<c.height){b._completionListElement.style.top=d.y-g+a;b._completionListElement.style.height=g+a;b._completionListElement.style.overflow="auto"}else b._completionListElement.style.top=d.y-c.height+3+a}};if(AjaxControlToolkit.ModalPopupBehavior&&!AjaxControlToolkit.ModalPopupBehavior.prototype.old__attachPopup){AjaxControlToolkit.ModalPopupBehavior.prototype.old__attachPopup=AjaxControlToolkit.ModalPopupBehavior.prototype._attachPopup;AjaxControlToolkit.ModalPopupBehavior.prototype._attachPopup=function(){var a=this;a.old__attachPopup();if(a._dropShadowBehavior){a._dropShadowBehavior.set_Width(4);(Sys.Browser.agent!=Sys.Browser.InternetExplorer||Sys.Browser.version>=9)&&a._dropShadowBehavior.set_Rounded(true)}}}}}function $hoverTab(a,b){while(a&&a.tagName!="TD")a=a.parentNode;if(a)if(b){Sys.UI.DomElement.addCssClass(a,"Active");a.focus()}else Sys.UI.DomElement.removeCssClass(a,"Active")}function $getSideBar(){var a=$get("PageContentSideBar");if(!a)return null;for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(c.className=="SideBarBody")return c}return null}function $dvget(d,i,f,j){for(var h=Sys.Application.getComponents(),k="_"+d,b=null,a=0;a<h.length;a++){var c=h[a];if(c._id==d||Web.DataView.isInstanceOfType(c)&&(c._id.endsWith(k)||c._controller==d&&(!i||c.get_viewId()==i))){b=c;break}}if(b)if(f){var e=b.findField(f);if(e){if(j){element=$get(b._id+"_ItemContainer"+e.Index);if(element)for(a=0;a<element.childNodes.length;a++){var g=element.childNodes[a];if(g.className=="Value")return g}}else return $get(b._id+"_Item"+e.Index);return element}else return null}else return b;return null}Sys.UI.DomElement.setFocus=function(a){var b=document.selection;b&&b.type!="Text"&&b.type!="None"&&b.clear();if(a){a.focus();a.select&&a.select()}};Sys.UI.DomElement.getCaretPosition=function(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange();c.moveStart("character",-a.value.length);b=c.text.length}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return b};Sys.UI.DomElement.setCaretPosition=function(a,c){var d="character";if(a.setSelectionRange){a.focus();a.setSelectionRange(c,c)}else if(a.createTextRange){var b=a.createTextRange();b.collapse(true);b.moveEnd(d,c);b.moveStart(d,c);b.select()}};function _field_format(b){var a=this;try{return b==null?"null":a.FormatOnClient&&!String.isNullOrEmpty(a.DataFormatString)?String.localeFormat(a.DataFormatString,b):b.toString()}catch(c){throw new Error(String.format("\nField: {0}\nData Format String: {1}\n{2}",a.Name,a.DataFormatString,c.message));}}function _field_isReadOnly(){return this.TextMode==4||this.ReadOnly}function _field_isNumber(){return Array.indexOf(["SByte","Byte","Int16","Int32","UInt32","Int64","Single","Double","Decimal","Currency"],this.Type)}Array.indexOfCaseInsensitive=function(c,b){b=b.toLowerCase();for(var a=0;a<c.length;a++)if(c[a].toLowerCase()==b)return a;return-1};Number.tryParse=function(a){var d=null;if(typeof a!="string")return d;if(String.isNullOrEmpty(a))return d;var b=Number.parseLocale(a);if(isNaN(b)){var c=Sys.CultureInfo.CurrentCulture.numberFormat;if(!c._simplifyRegex)c._simplifyRegex=new RegExp(String.format("({0}|\\{1})",c.CurrencySymbol.replace(/(\W)/g,"\\$1"),c.CurrencyGroupSeparator),"gi");var e=a.match(/\(/)!=d;a=a.replace(c._simplifyRegex,"").replace(/\(|\)/g,"");a=a.replace(c.CurrencyDecimalSeparator,c.NumberDecimalSeparator);b=Number.parseLocale(a);if(isNaN(b)){b=Number.parseLocale(a.replace(c.PercentSymbol,""));if(!isNaN(b))b/=100}}if(!isNaN(b)){if(e)b*=-1;return b}return d};Date.tryParseFuzzyDate=function(e,n){var f=null;if(String.isNullOrEmpty(e))return f;var b=Sys.CultureInfo.CurrentCulture.dateTimeFormat,a=Date.parseLocale(e,b.ShortDatePattern);if(a==f)a=Date.parseLocale(e,b.LongDatePattern);if(a==f&&!String.isNullOrEmpty(n)){var o=n.match(/\{0:([\s\S]*?)\}/);if(o)a=Date.parseLocale(e,o[1])}if(a)return a;a=new Date;var c=e.match(/^\s*(\w+)\s*$/);if(c){var d=Array.indexOfCaseInsensitive(b.DayNames,c[1]);if(d==-1)d=Array.indexOfCaseInsensitive(b.AbbreviatedDayNames,c[1]);if(d==-1)d=Array.indexOfCaseInsensitive(b.ShortestDayNames,c[1]);if(d>=0){while(a.getDay()!=d)a.setDate(a.getDate()+1);return a}}c=e.match(/^\s*(\w+|\d+)[^\w\d]*(\w+|\d+)\s*$/);if(c){var k=c[1],h=c[2];if(k.match(/\d+/)){k=h;h=c[1]}c=h.match(/\d+/);h=c?c[0]:1;d=Array.indexOfCaseInsensitive(b.MonthNames,k);if(d==-1)d=Array.indexOfCaseInsensitive(b.AbbreviatedMonthNames,k);if(d>=0){a.setDate(1);while(a.getMonth()!=d)a.setMonth(a.getMonth()+1);a.setDate(h);return a}}c=e.match(/^\s*(\d\d?)(\D*(\d\d?))?(\D*(\d+))?\s*$/);if(!c)return f;try{if(!b.LogicalYearPosition){var m=b.ShortDatePattern.indexOf("m");if(m<0)m=b.ShortDatePattern.indexOf("M");var l=b.ShortDatePattern.indexOf("d");if(l<0)l=b.ShortDatePattern.indexOf("D");b.LogicalYearPosition=5;b.LogicalMonthPosition=m<l?1:3;b.LogicalDayPosition=m<l?3:1}var j=c[b.LogicalYearPosition];if(String.isNullOrEmpty(j))j=a.getFullYear();else j=Number.parseLocale(j);var g=c[b.LogicalMonthPosition];if(String.isNullOrEmpty(g))g=a.getMonth();else{g=Number.parseLocale(g);g--}var i=c[b.LogicalDayPosition];if(String.isNullOrEmpty(i))i=a.getDay();else i=Number.parseLocale(i);a=new Date(j,g,i)}catch(p){return f}return a};Date.tryParseFuzzyTime=function(d){if(String.isNullOrEmpty(d))return null;var c=null,f=Sys.CultureInfo.CurrentCulture.dateTimeFormat,a=d.match(/^\s*(\d\d?)(\D*(\d\d?))?(\s*(\w+))?\s*$/);if(!a)a=d.match(/^\s*(\d\d?)(\D*(\d\d?))?(\D*(\d\d?))?(\D*(\d+))?(\s*(\S+))?\s*$/);if(a){c=new Date;var b=a[1],g=a[3],i=a.length==10?a[5]:"",h=a.length==10?a[7]:"",e=a[a.length-1];if(!String.isNullOrEmpty(b)){b=Number.parseLocale(b);if(!String.isNullOrEmpty(e)){if(e.toLowerCase()==f.PMDesignator.toLowerCase()){if(b!=12)b+=12}else if(b==12)b=0}else if(!String.isNullOrEmpty(f.PMDesignator)&&(new Date).getHours()>=12)b+=12;c.setHours(b)}!String.isNullOrEmpty(g)&&c.setMinutes(Number.parseLocale(g));c.setSeconds(!String.isNullOrEmpty(i)?Number.parseLocale(i):0);c.setMilliseconds(!String.isNullOrEmpty(h)?Number.parseLocale(h):0)}return c};Sys.Serialization.JavaScriptSerializer.deserialize=function(e,d){if(Sys.Serialization.JavaScriptSerializer._timeZoneOffset==null){Sys.Serialization.JavaScriptSerializer._timeZoneOffset="$1new Date($2)";if(typeof __timeZoneUtcOffset!="undefined"){var a=((new Date).getTimezoneOffset()+__timeZoneUtcOffset)*60*1e3;if(a!=0)Sys.Serialization.JavaScriptSerializer._timeZoneOffset=String.format("$1new Date($2{0}{1})",a<0?"-":"+",a<0?a*-1:a)}}var f,b=Sys.Serialization.JavaScriptSerializer._esc;try{var c=e.replace(b.dateRegEx,Sys.Serialization.JavaScriptSerializer._timeZoneOffset);if(d&&b.jsonRegEx.test(c.replace(b.jsonStringRegEx,"")))throw null;return window.eval("("+c+")")}catch(f){throw Error.argument("data",Sys.Res.cannotDeserializeInvalidJson);}};Date.$addDays=function(a,b){return a?new Date(a.setDate(a.getDate()+b)):a};Date.$now=function(){return new Date};Date.$today=function(){var a=new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0)};Date.$endOfDay=function(){var a=new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59)};Date.$within=function(a,b){return a?a<Date.$addDays(Date.$today(),b)&&a>=Date.$today():false};Date.$pastDue=function(b,a){if(a==null)a=new Date;if(a.getHours()==0)a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59);if(b==null)b=new Date;return b>a};Web.DataView._blankRegex=/^\s*$/;Web.DataView._fieldFilterRegex=/(\w+):([\s\S]*)/;Web.DataView._filterRegex=/(\*|~|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*?)(\0|$)$/;Web.DataView._filterIteratorRegex=/(\*|~|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*?)(\0|$)/g;Web.DataView._keepCapitalization=/^\$(month|quarter|true|false)/;Web.DataView._listRegex=/\$and\$|\$or\$/;Web.DataView._simpleListRegex=/\s*,\s*/;Web.DataView._htmlTest=/<\w+.*?>/;function __designer(){return typeof __designerMode!="undefined"}typeof Sys!=="undefined"&&Sys.Application.notifyScriptLoaded()